<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>coÂ³.one</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500;1,600&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --orange: #ff6700;
      --orange-dim: rgba(255, 103, 0, 0.7);
      --orange-glow: rgba(255, 103, 0, 0.15);
      --orange-subtle: rgba(255, 103, 0, 0.08);
      --black: #000;
      --near-black: #0a0a0a;
      --dark: #111;
      --dark-mid: #161616;
      --gray-dark: #1a1a1a;
      --gray-mid: #2a2a2a;
      --gray: #444;
      --gray-light: #666;
      --gray-lighter: #888;
      --gray-text: #999;
      --gray-pale: #aaa;
      --gray-bright: #ccc;
      --white: #fff;
      --font-display: 'Cormorant Garamond', Georgia, serif;
      --font-mono: 'JetBrains Mono', 'Courier New', monospace;
      --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-out-quart: cubic-bezier(0.25, 1, 0.5, 1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    ::selection {
      background: var(--orange);
      color: var(--black);
    }
    
    html {
      font-size: 16px;
    }
    
    body {
      background: var(--black);
      overflow-x: hidden;
      font-family: var(--font-display);
      font-weight: 400;
      color: var(--gray-bright);
      line-height: 1.85;
      letter-spacing: 0.01em;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    
    /* Transition overlay */
    #transition-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: transparent;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1.2s ease-in-out;
    }
    
    #transition-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    #transition-logo {
      font-family: var(--font-display);
      font-style: italic;
      font-weight: 300;
      font-size: clamp(80px, 20vmin, 200px);
      color: var(--orange);
      text-shadow: 
        0 0 80px rgba(255, 103, 0, 0.4),
        0 0 120px rgba(255, 103, 0, 0.2);
      transform: scaleY(1.3);
      letter-spacing: -0.03em;
      opacity: 0;
      transition: opacity 1.2s ease-in-out;
      animation: logoPulse 4s ease-in-out infinite;
    }
    
    #transition-overlay.active #transition-logo {
      opacity: 1;
    }
    
    #transition-logo sup {
      font-size: 0.35em;
      vertical-align: super;
      margin-left: 0.1em;
      position: relative;
      top: -0.4em;
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--near-black);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--gray-mid);
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--gray);
    }
    
    /* Three.js container */
    #canvas-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 1;
    }
    
    canvas {
      display: block;
    }
    
    /* Logo - splash screen */
    #logo-text {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scaleY(1.3);
      font-family: var(--font-display);
      font-style: italic;
      font-weight: 300;
      font-size: clamp(80px, 20vmin, 200px);
      color: var(--orange);
      text-shadow: 
        0 0 80px rgba(255, 103, 0, 0.4),
        0 0 120px rgba(255, 103, 0, 0.2);
      user-select: none;
      z-index: 20;
      line-height: 1;
      letter-spacing: -0.03em;
      cursor: pointer;
      transition: opacity 1.4s ease-in-out;
      animation: logoPulse 4s ease-in-out infinite;
    }
    
    @keyframes logoPulse {
      0%, 100% {
        text-shadow: 
          0 0 80px rgba(255, 103, 0, 0.4),
          0 0 120px rgba(255, 103, 0, 0.2);
      }
      50% {
        text-shadow: 
          0 0 100px rgba(255, 171, 115, 0.6),
          0 0 150px rgba(255, 171, 115, 0.35),
          0 0 200px rgba(255, 171, 115, 0.2);
      }
    }
    
    #logo-text.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    #logo-text sup {
      font-size: 0.35em;
      vertical-align: super;
      margin-left: 0.1em;
      position: relative;
      top: -0.4em;
    }
    
    /* Navigation */
    #nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 1.2rem 6vw;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(40px) saturate(180%);
      -webkit-backdrop-filter: blur(40px) saturate(180%);
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      transform: translateY(-100%);
      transition: transform 0.8s ease-in-out;
    }
    
    #nav.visible {
      transform: translateY(0);
    }
    
    #nav .nav-logo {
      color: var(--orange);
      text-decoration: none;
      font-style: italic;
      font-weight: 400;
      font-size: 1.3rem;
      cursor: pointer;
      transition: opacity 0.3s ease-in-out;
      letter-spacing: -0.02em;
    }
    
    #nav .nav-logo:hover {
      opacity: 0.7;
    }
    
    #nav .nav-links {
      display: flex;
      gap: 2.5rem;
    }
    
    #nav .nav-links a {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.85rem;
      font-weight: 400;
      text-decoration: none;
      cursor: pointer;
      transition: color 0.3s ease-in-out;
      letter-spacing: 0.01em;
      text-transform: none;
      position: relative;
    }
    
    #nav .nav-links a:hover,
    #nav .nav-links a.active {
      color: var(--white);
    }
    
    /* Page container */
    .page {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      z-index: 10;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1.4s ease-in-out;
      padding-top: 80px;
    }
    
    .page.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    .page-content {
      max-width: 860px;
      margin: 0 auto;
      padding: 3rem 6vw 6rem;
    }
    
    /* About page */
    #about-page .page-content {
      padding-top: 4rem;
    }
    
    #about-page h2 {
      font-size: clamp(1.8rem, 4.5vw, 2.6rem);
      color: var(--orange);
      font-style: italic;
      font-weight: 400;
      margin-bottom: 2rem;
      cursor: pointer;
      transition: opacity 0.3s ease-in-out;
      user-select: none;
      letter-spacing: -0.02em;
      line-height: 1.25;
    }
    
    #about-page h2:hover {
      opacity: 0.7;
    }
    
    #about-page p {
      margin-bottom: 1.5rem;
      font-size: 1.05rem;
      max-width: 620px;
      color: var(--gray-pale);
      line-height: 1.8;
    }
    
    #about-page a {
      color: var(--orange);
      text-decoration: none;
      border-bottom: none;
      transition: opacity 0.3s ease-in-out;
    }
    
    #about-page a:hover {
      opacity: 0.7;
    }
    
    /* CTA Buttons - Apple style */
    .cta-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin: 3rem 0;
      max-width: 320px;
    }
    
    .cta-button {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.1rem 1.8rem;
      background: rgba(255, 103, 0, 0.1);
      border: none;
      border-radius: 14px;
      color: var(--orange);
      font-family: var(--font-display);
      font-size: 1.05rem;
      font-weight: 500;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      position: relative;
      overflow: hidden;
    }
    
    .cta-button:hover {
      background: rgba(255, 103, 0, 0.18);
      transform: scale(1.02);
    }
    
    .cta-button:active {
      transform: scale(0.98);
    }
    
    .cta-button .arrow {
      font-size: 1.2rem;
      transition: transform 0.3s ease-in-out;
      opacity: 0.7;
    }
    
    .cta-button:hover .arrow {
      transform: translateX(4px);
      opacity: 1;
    }
    
    /* Social links - Apple pill style */
    .social-links {
      display: flex;
      gap: 0.6rem;
      flex-wrap: wrap;
      margin: 2.5rem 0;
    }
    
    .social-link {
      font-size: 0.8rem;
      padding: 0.6rem 1.1rem;
      border: none;
      border-radius: 100px;
      background: rgba(255, 255, 255, 0.06);
      color: var(--gray-lighter);
      text-decoration: none;
      transition: all 0.3s ease-in-out;
      letter-spacing: 0.02em;
    }
    
    .social-link:hover {
      background: rgba(255, 103, 0, 0.15);
      color: var(--orange);
      transform: scale(1.03);
    }
    
    .social-link:active {
      transform: scale(0.97);
    }
    
    /* Contact form - Apple style */
    .contact-section {
      margin-top: 4rem;
      max-width: 420px;
    }
    
    .contact-section h3 {
      font-size: 1.1rem;
      font-style: normal;
      font-weight: 500;
      color: var(--white);
      margin-bottom: 1.5rem;
      letter-spacing: 0.01em;
    }
    
    .form-group {
      margin-bottom: 1rem;
      position: relative;
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 1rem 1.2rem;
      background: rgba(255, 255, 255, 0.05);
      border: none;
      border-radius: 12px;
      color: var(--white);
      font-family: var(--font-display);
      font-size: 1rem;
      transition: all 0.3s ease-in-out;
      outline: none;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(255, 103, 0, 0.2);
    }
    
    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: var(--gray);
      font-style: normal;
    }
    
    .form-group textarea {
      resize: none;
      min-height: 120px;
    }
    
    #contact-form button {
      margin-top: 0.5rem;
      padding: 1rem 2rem;
      background: var(--orange);
      border: none;
      border-radius: 12px;
      color: var(--black);
      font-family: var(--font-display);
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    #contact-form button:hover {
      background: #ff7a1a;
      transform: scale(1.02);
    }
    
    #contact-form button:active {
      transform: scale(0.98);
    }
    
    /* Patent pending badge */
    .patent-badge {
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      color: var(--gray);
      font-size: 0.75rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }
    
    .patent-badge a {
      color: var(--gray);
      text-decoration: none;
      border-bottom: none;
      transition: color 0.3s ease-in-out;
    }
    
    .patent-badge a:hover {
      color: var(--orange);
    }
    
    /* Theory page */
    #rcott-page h1 {
      font-size: clamp(1.6rem, 3.5vw, 2.4rem);
      color: var(--orange);
      font-style: italic;
      font-weight: 400;
      margin-bottom: 0.8rem;
      letter-spacing: -0.02em;
      line-height: 1.3;
    }
    
    #rcott-page .subtitle {
      color: var(--gray);
      margin-bottom: 2rem;
      font-size: 0.95rem;
    }
    
    #rcott-page .gating {
      font-family: var(--font-mono);
      font-size: 1rem;
      font-weight: 400;
      color: var(--orange);
      padding: 1rem 1.5rem;
      border: none;
      border-radius: 10px;
      display: inline-block;
      margin-bottom: 1.5rem;
      background: rgba(255, 103, 0, 0.1);
    }
    
    #rcott-page section {
      margin: 4rem 0;
      padding-top: 2.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    #rcott-page section:first-of-type {
      border-top: none;
      margin-top: 2rem;
      padding-top: 0;
    }
    
    #rcott-page h2 {
      font-size: 1.3rem;
      color: var(--orange);
      font-style: normal;
      font-weight: 500;
      margin-bottom: 1.5rem;
      letter-spacing: -0.01em;
    }
    
    #rcott-page h3 {
      font-size: 1.05rem;
      color: var(--white);
      font-weight: 500;
      margin: 2rem 0 1rem;
    }
    
    #rcott-page p {
      max-width: 680px;
      margin-bottom: 1.2rem;
      color: var(--gray-pale);
    }
    
    .math-block {
      background: rgba(255, 103, 0, 0.06);
      border: none;
      border-radius: 14px;
      padding: 1.8rem 2rem;
      margin: 2.5rem 0;
      font-family: var(--font-mono);
      font-size: 0.9rem;
      overflow-x: auto;
      line-height: 2.2;
    }
    
    .math-block .symbol {
      color: var(--orange);
    }
    
    .symbol-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 0.6rem;
      margin: 2rem 0;
    }
    
    .symbol-item {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      padding: 0.9rem 1.1rem;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 10px;
      transition: background 0.3s ease-in-out;
    }
    
    .symbol-item:hover {
      background: rgba(255, 255, 255, 0.06);
    }
    
    .symbol-item .sym {
      font-family: var(--font-mono);
      color: var(--orange);
      font-size: 0.9rem;
      min-width: 70px;
    }
    
    .symbol-item .def {
      color: var(--gray-pale);
      font-size: 0.9rem;
    }
    
    /* Invariant list - Apple toggle style */
    .invariant-list {
      margin: 2rem 0;
    }
    
    .invariant-item {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      padding: 1rem 1.2rem;
      margin: 0.5rem 0;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    .invariant-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .invariant-item .toggle {
      width: 48px;
      height: 28px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 14px;
      position: relative;
      transition: background 0.3s ease-in-out;
      flex-shrink: 0;
    }
    
    .invariant-item .toggle::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 22px;
      height: 22px;
      background: var(--white);
      border-radius: 50%;
      transition: all 0.3s ease-in-out;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .invariant-item.checked .toggle {
      background: var(--orange);
    }
    
    .invariant-item.checked .toggle::after {
      left: 23px;
    }
    
    .invariant-item .label {
      font-size: 0.95rem;
      color: var(--gray-bright);
    }
    
    .gate-result {
      font-family: var(--font-mono);
      font-size: 1rem;
      text-align: center;
      padding: 1.5rem;
      margin: 2.5rem 0;
      border: none;
      border-radius: 14px;
      transition: all 0.4s ease-in-out;
    }
    
    .gate-result.pass {
      background: rgba(255, 103, 0, 0.12);
      color: var(--orange);
    }
    
    .gate-result.fail {
      background: rgba(255, 255, 255, 0.05);
      color: var(--gray);
    }
    
    /* Domain selector - Apple segmented control style */
    .domain-selector {
      margin: 2.5rem 0 1.5rem;
    }
    
    .domain-pills {
      display: inline-flex;
      gap: 0;
      flex-wrap: wrap;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 4px;
    }
    
    .domain-pill {
      padding: 0.7rem 1.3rem;
      background: transparent;
      border: none;
      border-radius: 10px;
      color: var(--gray-lighter);
      font-family: var(--font-display);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    .domain-pill:hover {
      color: var(--white);
    }
    
    .domain-pill.active {
      background: rgba(255, 103, 0, 0.2);
      color: var(--orange);
    }
    
    .domain-content {
      display: none;
      padding: 1.8rem;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 16px;
      margin-top: 1rem;
    }
    
    .domain-content.active {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .domain-content h4 {
      color: var(--orange);
      font-weight: 500;
      font-style: normal;
      font-size: 1rem;
      margin-bottom: 1.2rem;
    }
    
    .domain-content table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .domain-content td {
      padding: 0.9rem 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 0.95rem;
      vertical-align: top;
    }
    
    .domain-content tr:last-child td {
      border-bottom: none;
    }
    
    .domain-content td:first-child {
      color: var(--orange);
      font-family: var(--font-mono);
      font-size: 0.85rem;
      width: 100px;
      padding-right: 1.5rem;
      opacity: 0.9;
    }
    
    /* Failure modes - Apple card style */
    .failure-modes {
      margin-top: 2rem;
    }
    
    .failure-item {
      padding: 1.3rem 1.5rem;
      background: rgba(255, 100, 100, 0.06);
      border: none;
      border-radius: 12px;
      margin-bottom: 0.6rem;
    }
    
    .failure-item h4 {
      color: #ff9999;
      font-weight: 500;
      font-size: 0.95rem;
      margin-bottom: 0.3rem;
    }
    
    .failure-item p {
      color: var(--gray-lighter);
      font-size: 0.9rem;
      margin: 0;
    }
    
    /* Translate page */
    #translate-page .page-content {
      padding-top: 4rem;
    }
    
    #translate-page h1 {
      font-size: clamp(1.6rem, 3.5vw, 2.2rem);
      color: var(--orange);
      font-style: italic;
      font-weight: 400;
      margin-bottom: 0.4rem;
      letter-spacing: -0.02em;
    }
    
    #translate-page .tagline {
      color: var(--gray);
      font-size: 1rem;
      margin-bottom: 2.5rem;
    }
    
    /* Custom field selector - Apple dropdown style */
    .field-selector {
      margin-bottom: 3rem;
    }
    
    .field-selector-label {
      display: block;
      margin-bottom: 0.8rem;
      color: var(--gray-lighter);
      font-size: 0.85rem;
      letter-spacing: 0.02em;
      text-transform: none;
    }
    
    .field-dropdown {
      position: relative;
      max-width: 380px;
    }
    
    .field-dropdown-trigger {
      width: 100%;
      padding: 1rem 1.4rem;
      background: rgba(255, 255, 255, 0.05);
      border: none;
      border-radius: 12px;
      color: var(--white);
      font-family: var(--font-display);
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease-in-out;
    }
    
    .field-dropdown-trigger:hover,
    .field-dropdown-trigger.open {
      background: rgba(255, 255, 255, 0.08);
    }
    
    .field-dropdown-trigger .chevron {
      transition: transform 0.3s ease-in-out;
      color: var(--gray-lighter);
      font-size: 0.8rem;
    }
    
    .field-dropdown-trigger.open .chevron {
      transform: rotate(180deg);
    }
    
    .field-dropdown-menu {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      width: 100%;
      background: rgba(30, 30, 30, 0.98);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border: none;
      border-radius: 14px;
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: all 0.4s ease-in-out;
      z-index: 50;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
    }
    
    .field-dropdown-menu.open {
      max-height: 400px;
      overflow-y: auto;
      opacity: 1;
    }
    
    .field-dropdown-item {
      padding: 0.9rem 1.4rem;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .field-dropdown-item:last-child {
      border-bottom: none;
    }
    
    .field-dropdown-item:hover {
      background: rgba(255, 103, 0, 0.1);
    }
    
    .field-dropdown-item.selected {
      color: var(--orange);
    }
    
    .translation-container {
      opacity: 0;
      transform: translateY(16px);
      transition: all 0.6s ease-in-out;
    }
    
    .translation-container.visible {
      opacity: 1;
      transform: translateY(0);
    }
    
    .field-context {
      background: rgba(255, 103, 0, 0.08);
      border: none;
      border-radius: 16px;
      padding: 1.6rem 1.8rem;
      margin-bottom: 2rem;
    }
    
    .field-context h2 {
      color: var(--orange);
      font-size: 1.1rem;
      font-weight: 500;
      font-style: normal;
      margin-bottom: 0.4rem;
    }
    
    .field-context p {
      color: var(--gray-pale);
      margin: 0;
      font-size: 0.95rem;
    }
    
    .big-idea {
      background: rgba(255, 103, 0, 0.06);
      border: none;
      border-radius: 20px;
      padding: 2.5rem;
      margin: 2rem 0;
      text-align: center;
    }
    
    .big-idea h3 {
      color: var(--orange);
      font-size: 0.75rem;
      font-weight: 600;
      font-style: normal;
      margin-bottom: 1rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      opacity: 0.8;
    }
    
    .big-idea p {
      font-size: 1.15rem;
      color: var(--white);
      line-height: 1.7;
      margin: 0;
      max-width: 560px;
      margin: 0 auto;
    }
    
    .concept-card {
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 14px;
      padding: 1.5rem 1.6rem;
      margin-bottom: 0.8rem;
      transition: background 0.3s ease-in-out;
    }
    
    .concept-card:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .concept-card .formal {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.8rem;
      flex-wrap: wrap;
    }
    
    .concept-card .symbol {
      font-family: var(--font-mono);
      font-size: 0.9rem;
      color: var(--orange);
      background: rgba(255, 103, 0, 0.12);
      padding: 0.25rem 0.7rem;
      border-radius: 6px;
    }
    
    .concept-card .arrow {
      color: var(--gray);
    }
    
    .concept-card .translated-term {
      font-size: 1.05rem;
      color: var(--white);
      font-weight: 500;
    }
    
    .concept-card .explanation {
      color: var(--gray-text);
      font-size: 0.95rem;
      margin-bottom: 0.8rem;
    }
    
    .concept-card .example {
      padding: 0.9rem 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      font-size: 0.9rem;
      color: var(--gray-lighter);
      border: none;
    }
    
    .concept-card .example strong {
      color: var(--orange);
      font-weight: 500;
    }
    
    .failure-modes h3 {
      color: var(--white);
      font-size: 0.95rem;
      font-style: normal;
      font-weight: 500;
      margin: 2.5rem 0 1rem;
    }
    
    .failure-card {
      background: rgba(255, 100, 100, 0.06);
      border: none;
      border-radius: 12px;
      padding: 1.2rem 1.4rem;
      margin-bottom: 0.6rem;
    }
    
    .failure-card h4 {
      color: #ff9999;
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 0.3rem;
    }
    
    .failure-card p {
      color: var(--gray-lighter);
      font-size: 0.9rem;
      margin: 0;
    }
    
    .placeholder {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--gray);
    }
    
    .placeholder .icon {
      font-size: 1.5rem;
      margin-bottom: 0.8rem;
      opacity: 0.4;
    }
    
    /* Patent page */
    #patent-page .page-content {
      padding-top: 4rem;
    }
    
    .patent-header {
      margin-bottom: 3rem;
    }
    
    .patent-header .label {
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--gray);
      margin-bottom: 0.8rem;
    }
    
    .patent-header h1 {
      font-size: clamp(1.5rem, 4vw, 2.2rem);
      color: var(--white);
      font-weight: 500;
      line-height: 1.35;
      margin-bottom: 2rem;
      max-width: 680px;
    }
    
    .patent-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 1rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 16px;
    }
    
    .patent-meta-item .key {
      font-size: 0.65rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--gray);
      margin-bottom: 0.3rem;
    }
    
    .patent-meta-item .value {
      font-family: var(--font-mono);
      font-size: 0.9rem;
      color: var(--orange);
    }
    
    .patent-section {
      margin: 3rem 0;
      padding-top: 2.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .patent-section h2 {
      font-size: 1.2rem;
      color: var(--orange);
      font-style: normal;
      font-weight: 500;
      margin-bottom: 1.5rem;
    }
    
    .patent-section h3 {
      font-size: 1rem;
      color: var(--white);
      font-weight: 500;
      margin: 1.8rem 0 0.8rem;
    }
    
    .patent-text {
      color: var(--gray-bright);
      line-height: 1.85;
      margin-bottom: 1.2rem;
    }
    
    /* Claims section */
    .claims-list {
      counter-reset: claim;
    }
    
    .claim-item {
      padding: 1.4rem;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 14px;
      margin-bottom: 0.6rem;
      position: relative;
      padding-left: 3.8rem;
    }
    
    .claim-item::before {
      counter-increment: claim;
      content: counter(claim) ".";
      position: absolute;
      left: 1.4rem;
      top: 1.4rem;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      color: var(--orange);
      opacity: 0.8;
    }
    
    .claim-item p {
      margin: 0;
      color: var(--gray-bright);
      line-height: 1.75;
    }
    
    .claim-item .dependent {
      color: var(--gray-lighter);
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    /* Patent notice and figures */
    .patent-notice {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      padding: 0.85rem 1.2rem;
      background: rgba(255, 255, 255, 0.04);
      border: none;
      border-radius: 10px;
      margin-bottom: 2.5rem;
      font-size: 0.8rem;
      color: var(--gray-lighter);
    }
    
    .patent-notice .notice-icon {
      color: var(--orange);
      font-size: 0.85rem;
    }
    
    /* Figures */
    .figure-full {
      margin: 2rem 0;
      padding: 1.8rem;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 16px;
    }
    
    .figure-full .figure-label {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--orange);
      letter-spacing: 0.08em;
      margin-bottom: 0.25rem;
      opacity: 0.85;
    }
    
    .figure-full .figure-title {
      font-size: 0.95rem;
      color: var(--white);
      margin-bottom: 1.3rem;
      font-weight: 500;
    }
    
    .patent-figure {
      width: 100%;
      max-width: 100%;
      height: auto;
      margin-bottom: 1.3rem;
    }
    
    .figure-full .figure-desc {
      font-size: 0.85rem;
      color: var(--gray-lighter);
      font-style: normal;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    /* Claims - additional styles */
    .claim-item.claim-independent {
      background: rgba(255, 103, 0, 0.06);
    }
    
    .claim-item p {
      margin: 0 0 0.6rem 0;
    }
    
    .claim-item p:last-child {
      margin-bottom: 0;
    }
    
    .claim-element {
      padding-left: 1.2rem;
      color: var(--gray-pale) !important;
      font-size: 0.92rem;
    }
    
    /* Page link */
    .page-link {
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .page-link a {
      color: var(--orange);
      text-decoration: none;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: opacity 0.3s ease-in-out;
    }
    
    .page-link a:hover {
      opacity: 0.7;
    }
    
    /* Lab page - hidden/protected */
    .lab-gate {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      min-height: calc(100vh - 120px);
      padding: 2rem 1rem;
      padding-top: 3rem;
    }
    
    .lab-gate.hidden {
      display: none;
    }
    
    .lab-prompt {
      text-align: center;
      width: 100%;
      max-width: 400px;
      padding: 2.5rem 2rem;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 24px;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .lab-prompt#key-prompt {
      max-width: 380px;
    }
    
    .lab-prompt .lab-icon {
      font-size: 2.5rem;
      color: var(--orange);
      margin-bottom: 1.5rem;
      opacity: 0.9;
    }
    
    .lab-prompt h2 {
      font-size: 1.5rem;
      color: var(--white);
      font-weight: 600;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
    }
    
    .lab-prompt p {
      color: var(--gray);
      font-size: 0.95rem;
      margin-bottom: 2rem;
      line-height: 1.5;
    }
    
    .key-input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }
    
    .key-input-wrapper input {
      width: 100%;
      padding: 1rem 1.2rem;
      background: rgba(255, 255, 255, 0.06);
      border: none;
      border-radius: 14px;
      color: var(--white);
      font-family: var(--font-mono);
      font-size: 0.95rem;
      letter-spacing: 0.05em;
      outline: none;
      transition: all 0.3s ease-in-out;
      text-align: center;
    }
    
    .key-input-wrapper input:focus {
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 4px rgba(255, 103, 0, 0.15);
    }
    
    .key-input-wrapper input::placeholder {
      color: var(--gray);
      font-family: var(--font-display);
      letter-spacing: 0;
    }
    
    .key-input-wrapper button {
      width: 100%;
      padding: 1rem 1.5rem;
      background: var(--orange);
      border: none;
      border-radius: 14px;
      color: var(--black);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    .key-input-wrapper button:hover {
      background: #ff7a1a;
      transform: scale(1.02);
    }
    
    .key-input-wrapper button:active {
      transform: scale(0.98);
    }
    
    .key-error {
      margin-top: 1rem;
      color: #ff6b6b;
      font-size: 0.85rem;
      min-height: 1.2em;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    
    .key-error.visible {
      opacity: 1;
    }
    
    /* Disclaimer styles - Apple aesthetic - unified card */
    .disclaimer-prompt {
      width: 100%;
      max-width: 500px;
      padding: 2rem;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 24px;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .disclaimer-prompt.hidden {
      display: none;
    }
    
    .disclaimer-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    
    .disclaimer-header .lab-icon {
      font-size: 1.8rem;
      color: var(--orange);
      margin-bottom: 1rem;
      opacity: 0.9;
    }
    
    .disclaimer-header h2 {
      font-size: 1.4rem;
      color: var(--white);
      font-weight: 600;
      margin-bottom: 0.4rem;
      letter-spacing: -0.02em;
    }
    
    .disclaimer-header p {
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    .disclaimer-scroll {
      height: 280px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 16px;
      margin-bottom: 1.2rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
      -webkit-overflow-scrolling: touch;
    }
    
    .disclaimer-scroll::-webkit-scrollbar {
      width: 6px;
    }
    
    .disclaimer-scroll::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .disclaimer-scroll::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 3px;
    }
    
    .disclaimer-scroll::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.25);
    }
    
    .disclaimer-content {
      padding: 1.5rem;
      font-size: 0.8rem;
      line-height: 1.75;
      color: var(--gray-pale);
    }
    
    .disclaimer-content h3 {
      font-size: 0.95rem;
      color: var(--white);
      font-weight: 600;
      margin-bottom: 0.4rem;
      text-align: center;
      letter-spacing: -0.01em;
    }
    
    .disclaimer-content .disclaimer-date {
      text-align: center;
      color: var(--gray);
      font-size: 0.75rem;
      margin-bottom: 1.5rem;
    }
    
    .disclaimer-content h4 {
      font-size: 0.85rem;
      color: var(--orange);
      font-weight: 600;
      margin: 1.5rem 0 0.8rem;
    }
    
    .disclaimer-content p {
      margin-bottom: 0.8rem;
    }
    
    .disclaimer-content strong {
      color: var(--white);
      font-weight: 500;
    }
    
    .disclaimer-end-marker {
      text-align: center;
      padding: 2rem 0 0.5rem;
      color: var(--gray);
      font-size: 0.75rem;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      margin-top: 1.5rem;
    }
    
    .disclaimer-accept-section {
      padding: 0;
    }
    
    .accept-checkbox-wrapper {
      display: flex;
      align-items: flex-start;
      gap: 0.8rem;
      margin-bottom: 1rem;
      text-align: left;
    }
    
    .accept-checkbox {
      width: 24px;
      height: 24px;
      min-width: 24px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 7px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      margin-top: 2px;
    }
    
    .accept-checkbox .checkmark {
      color: var(--black);
      font-size: 0.9rem;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    
    .accept-checkbox.checked {
      background: var(--orange);
    }
    
    .accept-checkbox.checked .checkmark {
      opacity: 1;
    }
    
    .accept-checkbox-wrapper label {
      font-size: 0.85rem;
      color: var(--gray-lighter);
      line-height: 1.5;
      cursor: pointer;
    }
    
    .user-name-display {
      color: var(--orange);
      font-weight: 600;
    }
    
    .name-confirm-wrapper {
      margin-bottom: 1rem;
    }
    
    .name-confirm-wrapper input {
      width: 100%;
      padding: 0.9rem 1rem;
      background: rgba(255, 255, 255, 0.06);
      border: none;
      border-radius: 12px;
      color: var(--white);
      font-family: var(--font-display);
      font-size: 0.9rem;
      outline: none;
      transition: all 0.3s ease-in-out;
      text-align: center;
    }
    
    .name-confirm-wrapper input:focus {
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 3px rgba(255, 103, 0, 0.15);
    }
    
    .name-confirm-wrapper input::placeholder {
      color: var(--gray);
    }
    
    #accept-btn {
      width: 100%;
      padding: 1rem;
      font-size: 0.95rem;
      font-weight: 600;
      border-radius: 12px;
      letter-spacing: -0.01em;
      margin-top: 0;
    }
    
    #accept-btn:disabled {
      background: rgba(255, 255, 255, 0.06);
      color: var(--gray);
      cursor: not-allowed;
      transform: none;
    }
    
    #accept-btn:disabled:hover {
      background: rgba(255, 255, 255, 0.06);
      transform: none;
    }
    
    .lab-content {
      display: none;
      opacity: 0;
      transition: opacity 0.6s ease-in-out;
    }
    
    .lab-content.visible {
      display: block;
      opacity: 1;
    }
    
    .lab-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.4rem;
      background: rgba(255, 103, 0, 0.08);
      border-radius: 12px;
      margin-bottom: 3rem;
    }
    
    .lab-status {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 0.85rem;
      color: var(--orange);
    }
    
    .lab-status .status-dot {
      width: 8px;
      height: 8px;
      background: var(--orange);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
    
    .lab-logout {
      padding: 0.5rem 1rem;
      background: rgba(255, 255, 255, 0.06);
      border: none;
      border-radius: 8px;
      color: var(--gray-lighter);
      font-family: var(--font-display);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    .lab-logout:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--white);
    }
    
    #lab-page h1 {
      font-size: clamp(1.6rem, 3.5vw, 2.2rem);
      color: var(--orange);
      font-style: italic;
      font-weight: 400;
      margin-bottom: 0.5rem;
    }
    
    .lab-intro {
      color: var(--gray);
      font-size: 1rem;
      margin-bottom: 3rem;
    }
    
    .lab-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 5rem 2rem;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 20px;
      border: 1px dashed rgba(255, 255, 255, 0.1);
    }
    
    .lab-placeholder .placeholder-icon {
      font-size: 2.5rem;
      color: var(--orange);
      opacity: 0.3;
      margin-bottom: 1rem;
    }
    
    .lab-placeholder p {
      color: var(--gray);
      font-size: 0.95rem;
    }
    
    /* Demo key banner */
    #demo-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 90;
      padding: 0.9rem 2rem;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(20px) saturate(150%);
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      border-top: 1px solid rgba(255, 255, 255, 0.04);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 1;
      transform: translateY(0);
      transition: all 0.6s ease-in-out;
    }
    
    #demo-banner.hidden {
      opacity: 0;
      transform: translateY(100%);
      pointer-events: none;
    }
    
    #demo-banner-link {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      color: var(--gray-lighter);
      font-size: 0.85rem;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      padding: 0.5rem 1rem;
      border-radius: 100px;
      background: rgba(255, 255, 255, 0.04);
    }
    
    #demo-banner-link:hover {
      color: var(--orange);
      background: rgba(255, 103, 0, 0.1);
    }
    
    #demo-banner-link .banner-icon {
      font-size: 0.9rem;
      opacity: 0.7;
    }
    
    #demo-banner-link .banner-arrow {
      font-size: 0.75rem;
      opacity: 0.5;
      transition: transform 0.3s ease-in-out;
    }
    
    #demo-banner-link:hover .banner-arrow {
      transform: translateX(3px);
      opacity: 1;
    }
    
    /* Pyodide loading */
    .pyodide-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
      color: var(--gray);
    }
    
    .pyodide-loading.hidden {
      display: none;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 103, 0, 0.2);
      border-top-color: var(--orange);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1.5rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Lab interface */
    .lab-interface {
      display: none;
    }
    
    .lab-interface.visible {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    /* Structured Input Form */
    .input-form-section {
      margin-bottom: 2.5rem;
    }
    
    .input-form-section h3 {
      color: var(--white);
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .form-intro {
      color: var(--gray);
      font-size: 0.9rem;
      margin-bottom: 1.5rem;
    }
    
    .input-form {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      margin-bottom: 1.5rem;
    }
    
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .input-group label {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }
    
    .input-label {
      color: var(--white);
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .input-hint {
      color: var(--gray);
      font-size: 0.75rem;
    }
    
    .optional {
      color: var(--gray);
      font-weight: 400;
    }
    
    .input-with-prefix,
    .input-with-suffix {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s ease-in-out;
    }
    
    .input-with-prefix:focus-within,
    .input-with-suffix:focus-within {
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(255, 103, 0, 0.15);
    }
    
    .input-prefix {
      padding: 0.9rem 0 0.9rem 1rem;
      color: var(--gray);
      font-size: 0.95rem;
      font-family: var(--font-mono);
    }
    
    .input-suffix {
      padding: 0.9rem 1rem 0.9rem 0.5rem;
      color: var(--gray);
      font-size: 0.85rem;
      white-space: nowrap;
    }
    
    .input-with-prefix input,
    .input-with-suffix input {
      flex: 1;
      padding: 0.9rem 0.5rem;
      background: transparent;
      border: none;
      color: var(--white);
      font-size: 0.95rem;
      font-family: var(--font-mono);
      outline: none;
      min-width: 0;
    }
    
    .input-with-prefix input::placeholder,
    .input-with-suffix input::placeholder {
      color: var(--gray);
    }
    
    .input-group select {
      padding: 0.9rem 1rem;
      background: rgba(255, 255, 255, 0.05);
      border: none;
      border-radius: 12px;
      color: var(--white);
      font-size: 0.9rem;
      font-family: var(--font-display);
      outline: none;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23888' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      padding-right: 2.5rem;
    }
    
    .input-group select:focus {
      background-color: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(255, 103, 0, 0.15);
    }
    
    .input-group select option {
      background: #1a1a1a;
      color: var(--white);
    }
    
    /* Section headers */
    .section-header {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .section-icon {
      font-size: 1.5rem;
      color: var(--orange);
      line-height: 1;
    }
    
    .section-header h3 {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--white);
      margin: 0;
      letter-spacing: -0.02em;
    }
    
    .section-subtitle {
      color: var(--gray);
      font-size: 0.9rem;
      margin: 0.2rem 0 0 0;
    }
    
    /* Large primary button */
    .lab-btn.large {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      padding: 1.1rem 2rem;
      font-size: 1.05rem;
      font-weight: 600;
      border-radius: 14px;
      width: 100%;
      margin-top: 0.5rem;
    }
    
    .lab-btn .btn-icon {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }
    
    .lab-btn:hover .btn-icon {
      transform: translateX(4px);
    }
    
    /* Phase containers */
    .phase-container {
      animation: fadeIn 0.5s ease-out;
    }
    
    .phase-container.hidden {
      display: none;
    }
    
    /* ========== GENERATING SPLASH ========== */
    .generating-splash {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      text-align: center;
      padding: 3rem 2rem;
    }
    
    .generating-visual {
      margin-bottom: 2.5rem;
    }
    
    .generating-grid {
      width: 180px;
      height: 180px;
    }
    
    .constraint-viz {
      width: 100%;
      height: 100%;
      opacity: 0.9;
    }
    
    .constraint-viz path {
      stroke-dasharray: 200;
    }
    
    .generating-text h2 {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--white);
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
      font-family: var(--font-mono);
    }
    
    .generating-text p {
      color: var(--gray);
      font-size: 0.9rem;
      font-family: var(--font-mono);
    }
    
    .generating-progress {
      width: 100%;
      max-width: 280px;
      margin-top: 2rem;
    }
    
    .progress-track {
      height: 3px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ff6700, #ff8533);
      border-radius: 2px;
      transition: width 0.3s ease-out;
    }
    
    /* ========== REPORT STYLES ========== */
    .report-header {
      text-align: center;
      margin-bottom: 2.5rem;
      padding-top: 1rem;
    }
    
    .report-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(255, 103, 0, 0.1);
      border: 1px solid rgba(255, 103, 0, 0.2);
      border-radius: 100px;
      margin-bottom: 1rem;
    }
    
    .badge-icon {
      color: #ff6700;
      font-size: 0.9rem;
    }
    
    .badge-text {
      color: #ff8533;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-family: var(--font-mono);
    }
    
    .report-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--white);
      margin-bottom: 0.5rem;
      letter-spacing: -0.03em;
    }
    
    .report-timestamp {
      color: var(--gray);
      font-size: 0.85rem;
    }
    
    /* Report Cards */
    .report-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 20px;
      margin-bottom: 1.5rem;
      overflow: hidden;
    }
    
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.2rem 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .card-header h3 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--white);
      margin: 0;
    }
    
    /* Status indicator */
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 100px;
    }
    
    .status-indicator .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--gray);
    }
    
    .status-indicator.good .status-dot { background: #ff6700; }
    .status-indicator.warning .status-dot { background: #fbbf24; }
    .status-indicator.danger .status-dot { background: #ef4444; }
    
    .status-indicator .status-label {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--gray-lighter);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Summary card */
    .summary-content {
      padding: 1.5rem;
      font-size: 1rem;
      line-height: 1.7;
      color: var(--gray-pale);
    }
    
    .summary-content strong {
      color: var(--white);
      font-weight: 600;
    }
    
    .summary-content .danger {
      color: #f87171;
      font-weight: 600;
    }
    
    .summary-content .warning {
      color: #fbbf24;
      font-weight: 600;
    }
    
    /* Premium metrics grid */
    .metrics-grid.premium {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1px;
      background: rgba(255, 255, 255, 0.06);
    }
    
    .metric-tile {
      background: rgba(10, 10, 10, 0.8);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      transition: background 0.3s ease;
    }
    
    .metric-tile:hover {
      background: rgba(20, 20, 20, 0.9);
    }
    
    .metric-tile.good { border-top: 3px solid #ff6700; }
    .metric-tile.warning { border-top: 3px solid #fbbf24; }
    .metric-tile.danger { border-top: 3px solid #ef4444; }
    
    .metric-icon {
      font-size: 1.2rem;
      color: var(--gray);
      margin-bottom: 0.8rem;
      opacity: 0.6;
    }
    
    .metric-data {
      display: flex;
      align-items: baseline;
      gap: 0.3rem;
      margin-bottom: 0.5rem;
    }
    
    .metric-tile .metric-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--white);
      font-family: var(--font-mono);
      letter-spacing: -0.02em;
    }
    
    .metric-tile .metric-unit {
      font-size: 0.75rem;
      color: var(--gray);
      font-weight: 400;
    }
    
    .metric-tile .metric-label {
      font-size: 0.7rem;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    
    /* Visualization card */
    .viz-card .card-header {
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .viz-controls-inline {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .control-btn {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.06);
      border: none;
      border-radius: 10px;
      color: var(--gray-lighter);
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .control-btn:hover {
      background: rgba(255, 255, 255, 0.12);
      color: var(--white);
    }
    
    .control-btn:active {
      transform: scale(0.95);
    }
    
    .time-badge {
      padding: 0.4rem 0.8rem;
      background: rgba(255, 103, 0, 0.1);
      border-radius: 8px;
      font-size: 0.75rem;
      font-family: var(--font-mono);
      color: #ff8533;
      font-weight: 500;
    }
    
    .canvas-container {
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
    }
    
    .canvas-container canvas {
      width: 100%;
      height: auto;
      border-radius: 12px;
    }
    
    .viz-legend-inline {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      padding: 1rem;
      font-size: 0.75rem;
      color: var(--gray);
      font-family: var(--font-mono);
    }
    
    .viz-legend-inline span {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    
    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .legend-dot.current { background: #ff6700; }
    .legend-dot.boundary { background: #f87171; }
    .legend-dot.projected { background: var(--gray); }
    
    /* Analysis card */
    .analysis-content {
      padding: 1.5rem;
      font-size: 0.95rem;
      line-height: 1.8;
      color: var(--gray-pale);
    }
    
    .analysis-content strong {
      color: var(--white);
    }
    
    .analysis-content .danger {
      color: #f87171;
    }
    
    .analysis-content .warning {
      color: #fbbf24;
    }
    
    /* Recommendations grid */
    .recommendations-grid {
      display: grid;
      gap: 1px;
      background: rgba(255, 255, 255, 0.06);
    }
    
    .reco-item {
      background: rgba(10, 10, 10, 0.8);
      padding: 1.2rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      transition: background 0.2s ease;
      cursor: pointer;
    }
    
    .reco-item:hover {
      background: rgba(20, 20, 20, 0.9);
    }
    
    .reco-item-content {
      flex: 1;
    }
    
    .reco-item-title {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--white);
      margin-bottom: 0.3rem;
    }
    
    .reco-item-impact {
      font-size: 0.8rem;
      color: var(--gray);
    }
    
    .reco-item-delta {
      font-size: 0.9rem;
      font-weight: 600;
      font-family: var(--font-mono);
      padding: 0.4rem 0.8rem;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
    }
    
    .reco-item-delta.positive {
      color: #4ade80;
      background: rgba(74, 222, 128, 0.1);
    }
    
    .reco-item-delta.negative {
      color: #f87171;
      background: rgba(248, 113, 113, 0.1);
    }
    
    /* Report footer */
    .report-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 2rem 0;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      margin-top: 1rem;
    }
    
    .report-branding {
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    
    .brand-mark {
      font-family: var(--font-mono);
      font-size: 0.9rem;
      font-weight: 600;
      color: #ff6700;
      letter-spacing: 0.05em;
    }
    
    .brand-tagline {
      font-size: 0.7rem;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-family: var(--font-mono);
    }
    
    .lab-btn.secondary {
      background: rgba(255, 255, 255, 0.06);
      color: var(--gray-lighter);
    }
    
    .lab-btn.secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--white);
    }
    
    /* Two-column layout for larger screens */
    @media (min-width: 640px) {
      .input-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem 1.5rem;
      }
      
      .metrics-grid.premium {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    /* Natural language input (kept for legacy/context field) */
    .nl-input-section {
      margin-bottom: 2rem;
    }
    
    .nl-input-section label {
      display: block;
      color: var(--gray-lighter);
      font-size: 0.9rem;
      margin-bottom: 0.8rem;
    }
    
    .nl-input-section textarea {
      width: 100%;
      min-height: 120px;
      padding: 1.2rem;
      background: rgba(255, 255, 255, 0.05);
      border: none;
      border-radius: 14px;
      color: var(--white);
      font-family: var(--font-display);
      font-size: 1rem;
      line-height: 1.7;
      resize: vertical;
      outline: none;
      transition: all 0.3s ease-in-out;
    }
    
    .nl-input-section textarea:focus {
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(255, 103, 0, 0.2);
    }
    
    .nl-input-section textarea::placeholder {
      color: var(--gray);
    }
    
    /* Lab buttons */
    .lab-btn {
      padding: 0.9rem 1.8rem;
      background: rgba(255, 103, 0, 0.15);
      border: none;
      border-radius: 10px;
      color: var(--orange);
      font-family: var(--font-display);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      margin-top: 1rem;
    }
    
    .lab-btn:hover {
      background: rgba(255, 103, 0, 0.25);
      transform: scale(1.02);
    }
    
    .lab-btn:active {
      transform: scale(0.98);
    }
    
    .lab-btn.primary {
      background: var(--orange);
      color: var(--black);
    }
    
    .lab-btn.primary:hover {
      background: #ff7a1a;
    }
    
    .lab-btn.secondary {
      background: rgba(255, 255, 255, 0.08);
      color: var(--gray-lighter);
    }
    
    .lab-btn.small {
      padding: 0.6rem 1.2rem;
      font-size: 0.85rem;
      margin-top: 0;
      margin-right: 0.5rem;
    }
    
    /* Parsed variables */
    .parsed-section,
    .viz-section,
    .metrics-section,
    .output-section,
    .reco-section {
      margin-top: 2.5rem;
      padding-top: 2rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .parsed-section.hidden,
    .viz-section.hidden,
    .metrics-section.hidden,
    .output-section.hidden,
    .reco-section.hidden {
      display: none;
    }
    
    .parsed-section h3,
    .viz-section h3,
    .metrics-section h3,
    .output-section h3,
    .reco-section h3 {
      color: var(--orange);
      font-size: 1rem;
      font-weight: 500;
      margin-bottom: 1.2rem;
    }
    
    .parsed-vars {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 0.8rem;
      margin-bottom: 1rem;
    }
    
    .parsed-var {
      padding: 1rem 1.2rem;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 10px;
    }
    
    .parsed-var .var-name {
      font-family: var(--font-mono);
      font-size: 0.8rem;
      color: var(--orange);
      margin-bottom: 0.3rem;
    }
    
    .parsed-var .var-value {
      font-size: 1.1rem;
      color: var(--white);
      font-weight: 500;
    }
    
    .parsed-var .var-source {
      font-size: 0.75rem;
      color: var(--gray);
      margin-top: 0.3rem;
      font-style: italic;
    }
    
    /* Visualization */
    .viz-controls {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .time-display {
      font-family: var(--font-mono);
      font-size: 0.9rem;
      color: var(--orange);
      margin-left: 1rem;
    }
    
    #grid-canvas {
      width: 100%;
      max-width: 600px;
      height: auto;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .viz-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-top: 1rem;
      font-size: 0.8rem;
      color: var(--gray-lighter);
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .legend-item .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .legend-item .dot.current {
      background: var(--orange);
      box-shadow: 0 0 8px var(--orange);
    }
    
    .legend-item .dot.boundary {
      background: #ff4444;
    }
    
    .legend-item .dot.trajectory {
      background: #888;
    }
    
    .legend-item .dot.safe {
      background: rgba(255, 103, 0, 0.3);
    }
    
    /* Metrics grid */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
    }
    
    .metric-card {
      padding: 1.3rem;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 14px;
      text-align: center;
    }
    
    .metric-label {
      font-size: 0.75rem;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }
    
    .metric-value {
      font-family: var(--font-mono);
      font-size: 1.6rem;
      color: var(--orange);
      font-weight: 500;
    }
    
    .metric-value.warning {
      color: #ffaa00;
    }
    
    .metric-value.danger {
      color: #ff4444;
    }
    
    .metric-value.good {
      color: #44cc88;
    }
    
    .metric-unit {
      font-size: 0.7rem;
      color: var(--gray);
      font-family: var(--font-mono);
      margin-top: 0.3rem;
    }
    
    /* Natural language output */
    .nl-output {
      padding: 1.5rem;
      background: rgba(255, 103, 0, 0.06);
      border-radius: 14px;
      line-height: 1.8;
      color: var(--gray-pale);
    }
    
    .nl-output strong {
      color: var(--orange);
      font-weight: 500;
    }
    
    .nl-output .warning {
      color: #ffaa00;
    }
    
    .nl-output .danger {
      color: #ff4444;
    }
    
    /* Recommendations */
    .recommendations {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }
    
    .reco-card {
      padding: 1.2rem 1.4rem;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 12px;
      border-left: 3px solid var(--orange);
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    .reco-card:hover {
      background: rgba(255, 255, 255, 0.06);
      transform: translateX(4px);
    }
    
    .reco-card.selected {
      background: rgba(255, 103, 0, 0.1);
      border-left-color: #44cc88;
    }
    
    .reco-card .reco-title {
      font-weight: 500;
      color: var(--white);
      margin-bottom: 0.4rem;
    }
    
    .reco-card .reco-impact {
      font-size: 0.85rem;
      color: var(--gray-lighter);
    }
    
    .reco-card .reco-metrics {
      display: flex;
      gap: 1.5rem;
      margin-top: 0.8rem;
      font-family: var(--font-mono);
      font-size: 0.8rem;
    }
    
    .reco-card .reco-metrics span {
      color: var(--gray);
    }
    
    .reco-card .reco-metrics .better {
      color: #44cc88;
    }
    
    .reco-card .reco-metrics .worse {
      color: #ff6666;
    }

    /* Responsive */
    /* ============ RESPONSIVE DESIGN ============ */
    
    /* Large desktop (1200px+) */
    @media (min-width: 1200px) {
      .page-content {
        padding: 3rem 8vw 5rem;
        max-width: 1400px;
        margin: 0 auto;
      }
      
      #about-page h2 {
        font-size: 2.8rem;
      }
      
      .big-idea {
        padding: 3rem 4rem;
      }
      
      .disclaimer-scroll {
        height: 450px;
      }
    }
    
    /* Tablet and small desktop (768px - 1199px) */
    @media (max-width: 1199px) {
      .page-content {
        padding: 2.5rem 6vw 4rem;
      }
      
      .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .parsed-vars {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    /* Tablet (768px - 1023px) */
    @media (max-width: 1023px) {
      #nav {
        padding: 1rem 5vw;
      }
      
      #nav .nav-links {
        gap: 2rem;
      }
      
      #nav .nav-links a {
        font-size: 0.8rem;
      }
      
      .symbol-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .concept-card .formal {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .concept-card .arrow {
        display: none;
      }
      
      #grid-canvas {
        height: 300px;
      }
    }
    
    /* Mobile landscape and small tablet (576px - 767px) */
    @media (max-width: 767px) {
      :root {
        --font-scale: 0.95;
      }
      
      #nav {
        padding: 1rem 4vw;
      }
      
      #nav .nav-logo {
        font-size: 1.1rem;
      }
      
      #nav .nav-links {
        gap: 1.2rem;
      }
      
      #nav .nav-links a {
        font-size: 0.75rem;
      }
      
      .page-content {
        padding: 2rem 5vw 6rem;
      }
      
      #about-page h2 {
        font-size: 1.6rem;
      }
      
      #about-page p {
        font-size: 1rem;
      }
      
      .cta-buttons {
        max-width: 100%;
      }
      
      .cta-button {
        padding: 1rem 1.4rem;
        font-size: 0.95rem;
      }
      
      .social-links {
        justify-content: center;
      }
      
      .symbol-grid {
        grid-template-columns: 1fr;
      }
      
      .domain-pills {
        flex-wrap: wrap;
        justify-content: flex-start;
      }
      
      .domain-pill {
        padding: 0.6rem 1rem;
        font-size: 0.85rem;
      }
      
      .math-block {
        padding: 1.2rem 1rem;
        font-size: 0.8rem;
        line-height: 2;
      }
      
      .patent-meta {
        grid-template-columns: 1fr 1fr;
        padding: 1.2rem;
        gap: 1rem;
      }
      
      .figure-full {
        padding: 1.2rem;
      }
      
      .claim-item {
        padding: 1.2rem;
        padding-left: 3rem;
      }
      
      .claim-item::before {
        left: 1rem;
      }
      
      /* Lab page mobile */
      .lab-prompt {
        max-width: 100%;
        padding: 0 1rem;
      }
      
      .key-input-wrapper {
        flex-direction: column;
      }
      
      .key-input-wrapper button {
        padding: 1rem;
      }
      
      .disclaimer-prompt {
        padding: 1.5rem;
        border-radius: 20px;
      }
      
      .disclaimer-scroll {
        height: 220px;
      }
      
      .disclaimer-content {
        padding: 1.2rem;
        font-size: 0.75rem;
      }
      
      .disclaimer-content h3 {
        font-size: 0.85rem;
      }
      
      .disclaimer-content h4 {
        font-size: 0.8rem;
      }
      
      .accept-checkbox-wrapper label {
        font-size: 0.8rem;
      }
      
      .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.6rem;
      }
      
      .metric-card {
        padding: 1rem;
      }
      
      .metric-value {
        font-size: 1.3rem;
      }
      
      .parsed-vars {
        grid-template-columns: 1fr;
      }
      
      .nl-input-section textarea {
        min-height: 100px;
        font-size: 0.95rem;
      }
      
      .viz-controls {
        flex-wrap: wrap;
      }
      
      .lab-btn.small {
        flex: 1;
        min-width: calc(50% - 0.5rem);
        text-align: center;
        justify-content: center;
      }
      
      .time-display {
        width: 100%;
        text-align: center;
        margin-top: 0.5rem;
        margin-left: 0;
      }
      
      #grid-canvas {
        height: 250px;
      }
      
      .viz-legend {
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
      }
      
      .nl-output {
        padding: 1.2rem;
        font-size: 0.9rem;
      }
      
      .reco-card {
        padding: 1rem 1.2rem;
      }
      
      .reco-card .reco-metrics {
        flex-direction: column;
        gap: 0.3rem;
      }
      
      /* Demo banner mobile */
      #demo-banner {
        padding: 0.8rem 1rem;
      }
      
      #demo-banner-link {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
      }
      
      /* Contact form mobile */
      .contact-section {
        max-width: 100%;
      }
      
      /* Field selector mobile */
      .field-dropdown {
        max-width: 100%;
      }
      
      .big-idea {
        padding: 1.8rem 1.5rem;
      }
      
      .big-idea p {
        font-size: 1rem;
      }
    }
    
    /* Mobile portrait (max 575px) */
    @media (max-width: 575px) {
      #nav {
        padding: 0.9rem 4vw;
      }
      
      #nav .nav-logo {
        font-size: 1rem;
      }
      
      #nav .nav-links {
        gap: 0.8rem;
      }
      
      #nav .nav-links a {
        font-size: 0.7rem;
      }
      
      .page-content {
        padding: 1.5rem 4vw 5rem;
      }
      
      #about-page h2 {
        font-size: 1.4rem;
      }
      
      #rcott-page h1,
      #translate-page h1,
      #lab-page h1 {
        font-size: 1.4rem;
      }
      
      .patent-header h1 {
        font-size: 1.3rem;
      }
      
      .patent-meta {
        grid-template-columns: 1fr;
      }
      
      .patent-section h2 {
        font-size: 1.1rem;
      }
      
      .domain-pills {
        padding: 3px;
        border-radius: 10px;
      }
      
      .domain-pill {
        padding: 0.5rem 0.8rem;
        font-size: 0.8rem;
        border-radius: 8px;
      }
      
      .domain-content {
        padding: 1.2rem;
        border-radius: 12px;
      }
      
      .invariant-item {
        padding: 0.9rem 1rem;
        gap: 1rem;
      }
      
      .invariant-item .toggle {
        width: 42px;
        height: 26px;
      }
      
      .invariant-item .toggle::after {
        width: 20px;
        height: 20px;
      }
      
      .invariant-item.checked .toggle::after {
        left: 19px;
      }
      
      .invariant-item .label {
        font-size: 0.85rem;
      }
      
      .gate-result {
        padding: 1.2rem;
        font-size: 0.9rem;
      }
      
      /* Lab mobile small */
      .lab-prompt .lab-icon {
        font-size: 1.5rem;
      }
      
      .lab-prompt h2 {
        font-size: 1.2rem;
      }
      
      .lab-prompt p {
        font-size: 0.9rem;
      }
      
      .disclaimer-prompt {
        padding: 1.2rem;
        border-radius: 18px;
      }
      
      .disclaimer-header .lab-icon {
        font-size: 1.4rem;
        margin-bottom: 0.8rem;
      }
      
      .disclaimer-header h2 {
        font-size: 1.15rem;
      }
      
      .disclaimer-header p {
        font-size: 0.85rem;
      }
      
      .disclaimer-scroll {
        height: 200px;
        border-radius: 12px;
      }
      
      .disclaimer-content {
        padding: 1rem;
        font-size: 0.7rem;
        line-height: 1.65;
      }
      
      .disclaimer-content h3 {
        font-size: 0.8rem;
      }
      
      .disclaimer-content h4 {
        font-size: 0.75rem;
        margin: 1.2rem 0 0.6rem;
      }
      
      .accept-checkbox-wrapper label {
        font-size: 0.75rem;
        line-height: 1.4;
      }
      
      .name-confirm-wrapper input {
        padding: 0.8rem;
        font-size: 0.85rem;
      }
      
      #accept-btn {
        font-size: 0.85rem;
        padding: 0.9rem;
      }
      
      .lab-header {
        flex-direction: column;
        gap: 0.8rem;
        padding: 1rem;
      }
      
      .lab-status {
        font-size: 0.8rem;
      }
      
      .lab-intro {
        font-size: 0.9rem;
      }
      
      .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }
      
      .metric-card {
        padding: 0.9rem 0.6rem;
        border-radius: 12px;
      }
      
      .metric-label {
        font-size: 0.65rem;
      }
      
      .metric-value {
        font-size: 1.2rem;
      }
      
      .metric-unit {
        font-size: 0.6rem;
      }
      
      #grid-canvas {
        height: 200px;
        border-radius: 12px;
      }
      
      .lab-btn {
        padding: 0.8rem 1.4rem;
        font-size: 0.9rem;
        border-radius: 10px;
      }
      
      .lab-btn.small {
        padding: 0.6rem 1rem;
        font-size: 0.8rem;
      }
      
      .concept-card {
        padding: 1.2rem;
        border-radius: 12px;
      }
      
      .failure-card,
      .failure-item {
        padding: 1rem 1.2rem;
        border-radius: 10px;
      }
    }
    
    /* Very small screens (max 374px) */
    @media (max-width: 374px) {
      #nav .nav-links {
        gap: 0.5rem;
      }
      
      #nav .nav-links a {
        font-size: 0.65rem;
      }
      
      .metrics-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .metric-card {
        padding: 0.8rem 0.5rem;
      }
      
      .metric-value {
        font-size: 1rem;
      }
    }
    
    /* Touch device optimizations */
    @media (hover: none) and (pointer: coarse) {
      .cta-button:hover,
      .social-link:hover,
      .domain-pill:hover,
      .lab-btn:hover,
      #demo-banner-link:hover {
        transform: none;
      }
      
      .cta-button:active,
      .social-link:active,
      .domain-pill:active,
      .lab-btn:active {
        transform: scale(0.98);
      }
      
      /* Larger touch targets */
      .domain-pill {
        min-height: 44px;
        display: flex;
        align-items: center;
      }
      
      .invariant-item {
        min-height: 48px;
      }
      
      #demo-banner-link {
        min-height: 44px;
      }
    }
    
    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* High contrast mode support */
    @media (prefers-contrast: high) {
      :root {
        --gray: #888;
        --gray-light: #aaa;
      }
      
      .key-input-wrapper input,
      .name-confirm-wrapper input,
      .form-group input,
      .form-group textarea,
      .nl-input-section textarea {
        border: 1px solid var(--gray);
      }
    }
    
    /* Dark mode is default, but ensure consistency */
    @media (prefers-color-scheme: light) {
      /* Site is dark-themed, maintain dark even in light mode preference */
    }
    
    /* Landscape orientation adjustments for mobile */
    @media (max-height: 500px) and (orientation: landscape) {
      .lab-gate {
        min-height: auto;
        padding: 1rem;
        padding-top: 1rem;
        align-items: flex-start;
      }
      
      .lab-prompt {
        padding: 1.5rem;
      }
      
      .disclaimer-prompt {
        padding: 1rem;
      }
      
      .disclaimer-scroll {
        height: 150px;
      }
      
      .disclaimer-header {
        margin-bottom: 0.8rem;
      }
      
      .lab-prompt .lab-icon,
      .disclaimer-header .lab-icon {
        margin-bottom: 0.5rem;
        font-size: 1.2rem;
      }
      
      .lab-prompt h2,
      .disclaimer-header h2 {
        font-size: 1.1rem;
        margin-bottom: 0.3rem;
      }
      
      .lab-prompt p,
      .disclaimer-header p {
        margin-bottom: 1rem;
        font-size: 0.85rem;
      }
      
      .accept-checkbox-wrapper {
        margin-bottom: 0.8rem;
      }
      
      .name-confirm-wrapper {
        margin-bottom: 0.8rem;
      }
    }
    
    /* Safe area insets for notched devices */
    @supports (padding: max(0px)) {
      #nav {
        padding-left: max(1.2rem, env(safe-area-inset-left));
        padding-right: max(1.2rem, env(safe-area-inset-right));
      }
      
      #demo-banner {
        padding-bottom: max(0.9rem, env(safe-area-inset-bottom));
        padding-left: max(2rem, env(safe-area-inset-left));
        padding-right: max(2rem, env(safe-area-inset-right));
      }
      
      .page-content {
        padding-left: max(5vw, env(safe-area-inset-left));
        padding-right: max(5vw, env(safe-area-inset-right));
      }
    }
  </style>
</head>
<body>
  <!-- Transition overlay -->
  <div id="transition-overlay">
    <div id="transition-logo">Co<sup>3</sup></div>
  </div>
  
  <!-- Three.js background -->
  <div id="canvas-container"></div>
  
  <!-- Logo for splash -->
  <div id="logo-text">Co<sup>3</sup></div>
  
  <!-- Lab Page (Hidden) -->
  <div id="lab-page" class="page">
    <div class="page-content">
      <div class="lab-gate" id="lab-gate">
        <!-- Step 1: Key Entry -->
        <div class="lab-prompt" id="key-prompt">
          <div class="lab-icon">â</div>
          <h2>Private Access</h2>
          <p>This area requires authorization.</p>
          <div class="key-input-wrapper">
            <input type="text" id="lab-key-input" placeholder="Enter access key" autocomplete="off" spellcheck="false">
            <button id="lab-key-submit">â</button>
          </div>
          <div class="key-error" id="key-error"></div>
        </div>
        
        <!-- Step 2: Disclaimer -->
        <div class="disclaimer-prompt hidden" id="disclaimer-prompt">
          <div class="disclaimer-header">
            <div class="lab-icon">â</div>
            <h2>Terms of Access</h2>
            <p>Please review and accept the following terms to continue.</p>
          </div>
          
          <div class="disclaimer-scroll" id="disclaimer-scroll">
            <div class="disclaimer-content">
              <h3>PROTOTYPE ACCESS AGREEMENT AND DISCLAIMER</h3>
              <p class="disclaimer-date">Effective Date: January 2026</p>
              
              <p>This Prototype Access Agreement and Disclaimer ("Agreement") is entered into by and between CO3 ONE LLC, a Delaware limited liability company ("Company," "we," "us," or "our"), and the individual accessing this prototype environment ("User," "you," or "your").</p>
              
              <p><strong>BY ACCESSING THIS PROTOTYPE, YOU ACKNOWLEDGE THAT YOU HAVE READ, UNDERSTOOD, AND AGREE TO BE BOUND BY THIS AGREEMENT. IF YOU DO NOT AGREE TO THESE TERMS, DO NOT ACCESS OR USE THIS PROTOTYPE.</strong></p>
              
              <h4>1. EXPERIMENTAL NATURE OF PROTOTYPE</h4>
              <p>1.1. The software, tools, demonstrations, and materials accessible through this portal (collectively, the "Prototype") are experimental, developmental, and provided solely for testing, evaluation, and demonstration purposes.</p>
              <p>1.2. The Prototype is provided "AS IS" and "AS AVAILABLE" without any warranties of any kind, whether express, implied, statutory, or otherwise, including but not limited to warranties of merchantability, fitness for a particular purpose, title, non-infringement, accuracy, reliability, or availability.</p>
              <p>1.3. The Prototype may contain errors, bugs, defects, or inaccuracies. Outputs, calculations, analyses, recommendations, or other results generated by the Prototype should not be relied upon for any purpose and do not constitute professional, legal, financial, medical, or other advice.</p>
              
              <h4>2. NO CONFIDENTIALITY OF USER INPUTS</h4>
              <p><strong>2.1. IMPORTANT NOTICE: ANY AND ALL INFORMATION, DATA, TEXT, OR OTHER CONTENT YOU ENTER INTO, SUBMIT TO, OR TRANSMIT THROUGH THIS PROTOTYPE ("USER INPUTS") IS NOT CONFIDENTIAL AND SHALL NOT BE TREATED AS CONFIDENTIAL BY THE COMPANY.</strong></p>
              <p>2.2. By submitting User Inputs, you acknowledge and agree that: (a) User Inputs may be stored, logged, analyzed, reviewed, or retained by the Company without limitation; (b) User Inputs may be used by the Company for any purpose, including but not limited to improving, developing, or training systems and models; (c) you have no expectation of privacy or confidentiality with respect to User Inputs; (d) you shall not submit any information that you consider confidential, proprietary, sensitive, or private.</p>
              <p>2.3. You represent and warrant that you have all necessary rights to submit User Inputs and that such submission does not violate any third-party rights, confidentiality obligations, or applicable laws.</p>
              
              <h4>3. INTELLECTUAL PROPERTY</h4>
              <p>3.1. The Prototype, including but not limited to its underlying code, algorithms, methodologies, frameworks, theories, documentation, and user interface (collectively, "Company IP"), is the exclusive property of the Company and is protected by intellectual property laws, including patent-pending technologies.</p>
              <p>3.2. This Agreement grants you a limited, non-exclusive, non-transferable, revocable license to access and use the Prototype solely for personal, non-commercial evaluation purposes during your authorized session.</p>
              <p>3.3. You shall not: (a) copy, reproduce, modify, or create derivative works of the Prototype or Company IP; (b) reverse engineer, decompile, disassemble, or attempt to derive source code; (c) sublicense, sell, distribute, or transfer access to the Prototype; (d) use the Prototype for any commercial purpose; (e) remove or alter any proprietary notices or markings.</p>
              
              <h4>4. LIMITATION OF LIABILITY</h4>
              <p><strong>4.1. TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, IN NO EVENT SHALL THE COMPANY, ITS OFFICERS, DIRECTORS, MEMBERS, EMPLOYEES, AGENTS, AFFILIATES, SUCCESSORS, OR ASSIGNS BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, PUNITIVE, OR EXEMPLARY DAMAGES, INCLUDING BUT NOT LIMITED TO DAMAGES FOR LOSS OF PROFITS, GOODWILL, USE, DATA, OR OTHER INTANGIBLE LOSSES, ARISING OUT OF OR RELATING TO YOUR ACCESS TO OR USE OF (OR INABILITY TO ACCESS OR USE) THE PROTOTYPE.</strong></p>
              <p><strong>4.2. TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, THE COMPANY'S TOTAL AGGREGATE LIABILITY ARISING OUT OF OR RELATING TO THIS AGREEMENT OR THE PROTOTYPE SHALL NOT EXCEED ONE HUNDRED UNITED STATES DOLLARS ($100.00).</strong></p>
              <p>4.3. THE LIMITATIONS IN THIS SECTION SHALL APPLY REGARDLESS OF THE THEORY OF LIABILITY, WHETHER BASED ON WARRANTY, CONTRACT, STATUTE, TORT (INCLUDING NEGLIGENCE), STRICT LIABILITY, OR ANY OTHER LEGAL OR EQUITABLE THEORY, AND WHETHER OR NOT THE COMPANY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p>
              
              <h4>5. INDEMNIFICATION</h4>
              <p>5.1. You agree to indemnify, defend, and hold harmless the Company and its officers, directors, members, employees, agents, and affiliates from and against any and all claims, damages, losses, liabilities, costs, and expenses (including reasonable attorneys' fees) arising out of or relating to: (a) your access to or use of the Prototype; (b) your User Inputs; (c) your violation of this Agreement; (d) your violation of any rights of any third party.</p>
              
              <h4>6. ACCESS REVOCATION</h4>
              <p>6.1. Your access to the Prototype is granted at the sole discretion of the Company and may be revoked, suspended, or terminated at any time, for any reason or no reason, without notice or liability.</p>
              <p>6.2. The access key provided to you is personal and non-transferable. You shall not share, distribute, or disclose your access key to any third party.</p>
              
              <h4>7. GOVERNING LAW AND DISPUTE RESOLUTION</h4>
              <p>7.1. This Agreement shall be governed by and construed in accordance with the laws of the State of Delaware, without regard to its conflict of laws principles.</p>
              <p>7.2. Any dispute arising out of or relating to this Agreement or the Prototype shall be resolved exclusively through binding arbitration in accordance with the rules of the American Arbitration Association. The arbitration shall be conducted in English, and the seat of arbitration shall be Wilmington, Delaware.</p>
              <p>7.3. You waive any right to participate in a class action lawsuit or class-wide arbitration against the Company.</p>
              
              <h4>8. MISCELLANEOUS</h4>
              <p>8.1. This Agreement constitutes the entire agreement between you and the Company regarding the Prototype and supersedes all prior agreements and understandings.</p>
              <p>8.2. If any provision of this Agreement is found to be unenforceable, the remaining provisions shall continue in full force and effect.</p>
              <p>8.3. The Company's failure to enforce any right or provision of this Agreement shall not constitute a waiver of such right or provision.</p>
              <p>8.4. This Agreement may be modified by the Company at any time. Continued access to the Prototype following any modification constitutes acceptance of the modified terms.</p>
              
              <div class="disclaimer-end-marker">
                <span>â End of Agreement â</span>
              </div>
            </div>
          </div>
          
          <div class="disclaimer-accept-section">
            <div class="accept-checkbox-wrapper">
              <div class="accept-checkbox" id="accept-checkbox">
                <span class="checkmark">â</span>
              </div>
              <label>I, <span id="user-full-name" class="user-name-display">[Authorized User]</span>, have read, understand, and agree to be bound by the terms of this Agreement.</label>
            </div>
            <div class="name-confirm-wrapper">
              <input type="text" id="name-confirm-input" placeholder="Type your full name to confirm" autocomplete="off" spellcheck="false">
            </div>
            <button id="accept-btn" class="lab-btn primary" disabled>
              <span id="accept-btn-text">Please scroll to read (30s)</span>
            </button>
          </div>
        </div>
      </div>
      
      <div class="lab-content" id="lab-content">
        <!-- Protected content loads here -->
        <div class="lab-header">
          <div class="lab-status">
            <span class="status-dot"></span>
            <span>Session Active</span>
          </div>
          <button id="lab-logout" class="lab-logout">End Session</button>
        </div>
        
        <h1>Constraint Interpreter</h1>
        <p class="lab-intro">Visualize how systems persist under boundaries. An interpretability tool.</p>
        
        <!-- Loading state -->
        <div id="pyodide-loading" class="pyodide-loading">
          <div class="loading-spinner"></div>
          <p>Initializing...</p>
        </div>
        
        <!-- Main lab interface -->
        <div id="lab-interface" class="lab-interface">
          
          <!-- ========== INPUT PHASE ========== -->
          <div id="input-phase" class="phase-container">
            
            <!-- Structured Input Form -->
            <div class="input-form-section">
              <div class="section-header">
                <span class="section-icon">â¬¡</span>
                <div>
                  <h3>System State</h3>
                  <p class="section-subtitle">Define the constraint geometry for analysis</p>
                </div>
              </div>
              
              <div class="input-form">
                <!-- Resources -->
                <div class="input-group">
                  <label for="input-resources">
                    <span class="input-label">Resource Budget</span>
                    <span class="input-hint">Available capacity or runway</span>
                  </label>
                  <div class="input-with-prefix">
                    <span class="input-prefix">R =</span>
                    <input type="number" id="input-resources" placeholder="100000" min="0" step="1000">
                  </div>
                </div>
                
                <!-- Burn Rate -->
                <div class="input-group">
                  <label for="input-burn">
                    <span class="input-label">Depletion Rate</span>
                    <span class="input-hint">Resource consumption per timestep</span>
                  </label>
                  <div class="input-with-prefix">
                    <span class="input-prefix">Î´R =</span>
                    <input type="number" id="input-burn" placeholder="10000" min="0" step="500">
                    <span class="input-suffix">/t</span>
                  </div>
                </div>
                
                <!-- Growth Rate -->
                <div class="input-group">
                  <label for="input-growth">
                    <span class="input-label">Depletion Acceleration</span>
                    <span class="input-hint">Rate of change in consumption</span>
                  </label>
                  <div class="input-with-suffix">
                    <input type="number" id="input-growth" placeholder="0" step="0.5" min="-50" max="50">
                    <span class="input-suffix">%</span>
                  </div>
                </div>
                
                <!-- Minimum Reserve -->
                <div class="input-group">
                  <label for="input-reserve">
                    <span class="input-label">Boundary Threshold</span>
                    <span class="input-hint">Hard constraint floor (âð½)</span>
                  </label>
                  <div class="input-with-prefix">
                    <span class="input-prefix">âð½ =</span>
                    <input type="number" id="input-reserve" placeholder="10000" min="0" step="1000">
                  </div>
                </div>
                
                <!-- Coherence -->
                <div class="input-group">
                  <label for="input-coherence">
                    <span class="input-label">Coherence Level</span>
                    <span class="input-hint">Internal consistency measure C<sub>Î</sub></span>
                  </label>
                  <select id="input-coherence">
                    <option value="0.95">0.95 (High)</option>
                    <option value="0.85">0.85</option>
                    <option value="0.70" selected>0.70 (Moderate)</option>
                    <option value="0.50">0.50</option>
                    <option value="0.30">0.30 (Low)</option>
                    <option value="0.15">0.15 (Critical)</option>
                  </select>
                </div>
                
                <!-- Coherence Trend -->
                <div class="input-group">
                  <label for="input-coherence-trend">
                    <span class="input-label">Coherence Derivative</span>
                    <span class="input-hint">âC<sub>Î</sub>/ât direction</span>
                  </label>
                  <select id="input-coherence-trend">
                    <option value="0.03">+0.03/t (Stabilizing)</option>
                    <option value="0.01">+0.01/t</option>
                    <option value="0" selected>0 (Stable)</option>
                    <option value="-0.01">-0.01/t</option>
                    <option value="-0.03">-0.03/t (Destabilizing)</option>
                  </select>
                </div>
              </div>
              
              <button id="analyze-btn" class="lab-btn primary large">
                <span>Compute Trajectory</span>
                <span class="btn-icon">â</span>
              </button>
            </div>
          </div>
          
          <!-- ========== GENERATING PHASE (SPLASH) ========== -->
          <div id="generating-phase" class="phase-container hidden">
            <div class="generating-splash">
              <div class="generating-visual">
                <div class="generating-grid">
                  <svg viewBox="0 0 100 100" class="constraint-viz">
                    <defs>
                      <linearGradient id="feasibleGrad" x1="0%" y1="100%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:rgba(99,102,241,0.1)"/>
                        <stop offset="100%" style="stop-color:rgba(99,102,241,0.3)"/>
                      </linearGradient>
                    </defs>
                    <!-- Feasible region -->
                    <path id="feasible-region" d="M20,80 L20,30 Q50,20 80,35 L80,80 Z" fill="url(#feasibleGrad)" stroke="rgba(99,102,241,0.5)" stroke-width="0.5">
                      <animate attributeName="d" 
                        values="M20,80 L20,30 Q50,20 80,35 L80,80 Z;M25,80 L25,35 Q50,25 75,40 L75,80 Z;M20,80 L20,30 Q50,20 80,35 L80,80 Z" 
                        dur="3s" repeatCount="indefinite"/>
                    </path>
                    <!-- Boundary -->
                    <line x1="15" y1="80" x2="85" y2="80" stroke="rgba(239,68,68,0.6)" stroke-width="1" stroke-dasharray="2,2"/>
                    <!-- Trajectory -->
                    <path id="traj-path" d="M30,50 Q45,45 55,55 Q65,65 75,70" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="1.5" stroke-linecap="round">
                      <animate attributeName="stroke-dashoffset" from="100" to="0" dur="2s" repeatCount="indefinite"/>
                    </path>
                    <!-- Current state -->
                    <circle id="state-dot" cx="30" cy="50" r="3" fill="#ff6700">
                      <animate attributeName="cx" values="30;75;30" dur="3s" repeatCount="indefinite"/>
                      <animate attributeName="cy" values="50;70;50" dur="3s" repeatCount="indefinite"/>
                    </circle>
                  </svg>
                </div>
              </div>
              <div class="generating-text">
                <h2 id="generating-title">Mapping feasible set</h2>
                <p id="generating-status">Enumerating admissible continuations...</p>
              </div>
              <div class="generating-progress">
                <div class="progress-track">
                  <div class="progress-fill" id="progress-fill"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ========== REPORT PHASE ========== -->
          <div id="report-phase" class="phase-container hidden">
            
            <!-- Report Header -->
            <div class="report-header">
              <div class="report-badge">
                <span class="badge-icon">â¬¡</span>
                <span class="badge-text">Constraint Analysis</span>
              </div>
              <h2 class="report-title">Trajectory Assessment</h2>
              <p class="report-timestamp" id="report-timestamp">Computed January 14, 2026</p>
            </div>
            
            <!-- State Summary Card -->
            <div class="report-card summary-card" id="summary-card">
              <div class="card-header">
                <h3>System Assessment</h3>
                <div class="status-indicator" id="overall-status">
                  <span class="status-dot"></span>
                  <span class="status-label">Computing...</span>
                </div>
              </div>
              <div class="summary-content" id="summary-content">
                <!-- Generated content -->
              </div>
            </div>
            
            <!-- Key Metrics Grid -->
            <div class="report-card metrics-card">
              <div class="card-header">
                <h3>Constraint Metrics</h3>
              </div>
              <div class="metrics-grid premium">
                <div class="metric-tile" id="tile-ttb">
                  <div class="metric-icon">t<sub>â</sub></div>
                  <div class="metric-data">
                    <span class="metric-value" id="metric-ttb">--</span>
                    <span class="metric-unit">steps</span>
                  </div>
                  <div class="metric-label">Time to Boundary</div>
                </div>
                <div class="metric-tile" id="tile-margin">
                  <div class="metric-icon">d</div>
                  <div class="metric-data">
                    <span class="metric-value" id="metric-margin">--</span>
                    <span class="metric-unit">margin</span>
                  </div>
                  <div class="metric-label">d(x, âð½)</div>
                </div>
                <div class="metric-tile" id="tile-coherence">
                  <div class="metric-icon">C<sub>Î</sub></div>
                  <div class="metric-data">
                    <span class="metric-value" id="metric-coherence">--</span>
                    <span class="metric-unit"></span>
                  </div>
                  <div class="metric-label">Coherence</div>
                </div>
                <div class="metric-tile" id="tile-trend">
                  <div class="metric-icon">âC</div>
                  <div class="metric-data">
                    <span class="metric-value" id="metric-trend">--</span>
                    <span class="metric-unit">/t</span>
                  </div>
                  <div class="metric-label">Coherence Trend</div>
                </div>
              </div>
            </div>
            
            <!-- Trajectory Visualization -->
            <div class="report-card viz-card">
              <div class="card-header">
                <h3>State Space Trajectory</h3>
                <div class="viz-controls-inline">
                  <button id="step-btn" class="control-btn" title="Step Forward">
                    <span>+1</span>
                  </button>
                  <button id="play-btn" class="control-btn" title="Play/Pause">
                    <span>â¶</span>
                  </button>
                  <button id="reset-btn" class="control-btn" title="Reset">
                    <span>âº</span>
                  </button>
                  <span id="time-display" class="time-badge">t = 0</span>
                </div>
              </div>
              <div class="canvas-container">
                <canvas id="grid-canvas" width="600" height="350"></canvas>
              </div>
              <div class="viz-legend-inline">
                <span><span class="legend-dot current"></span>x(t)</span>
                <span><span class="legend-dot boundary"></span>âð½</span>
                <span><span class="legend-dot projected"></span>Projected</span>
              </div>
            </div>
            
            <!-- Analysis -->
            <div class="report-card analysis-card">
              <div class="card-header">
                <h3>Interpretation</h3>
              </div>
              <div class="analysis-content" id="nl-output">
                <!-- Generated analysis -->
              </div>
            </div>
            
            <!-- Alternative Continuations -->
            <div class="report-card reco-card">
              <div class="card-header">
                <h3>Alternative Continuations</h3>
              </div>
              <div class="recommendations-grid" id="recommendations">
                <!-- Generated recommendations -->
              </div>
            </div>
            
            <!-- Report Footer -->
            <div class="report-footer">
              <button id="new-analysis-btn" class="lab-btn secondary">
                <span>â New Analysis</span>
              </button>
              <div class="report-branding">
                <span class="brand-mark">RCOT</span>
                <span class="brand-tagline">Constraint Geometry</span>
              </div>
            </div>
            
          </div>
          
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <nav id="nav">
    <span class="nav-logo" data-page="splash">CoÂ³</span>
    <div class="nav-links">
      <a data-page="about">About</a>
      <a data-page="rcott">Theory</a>
      <a data-page="translate">Translate</a>
      <a data-page="patent">Patent</a>
    </div>
  </nav>
  
  <!-- Demo Key Banner -->
  <div id="demo-banner" class="hidden">
    <a id="demo-banner-link">
      <span class="banner-icon">â</span>
      <span>Have a demo key?</span>
      <span class="banner-arrow">â</span>
    </a>
  </div>
  
  <!-- About Page -->
  <div id="about-page" class="page">
    <div class="page-content">
      <h2 data-page="splash">Coherence Consulting Company</h2>
      
      <p>
        CoÂ³ ONE explores the mathematics of persistence. The focus is on how systems maintain coherence 
        by optimizing distance from failure boundaries while preserving internal structure.
      </p>
      
      <p>
        The framework applies across domains, including risk management, organizational design, 
        AI alignment, and personal decision-making. The pattern is consistent throughout. Sustainable 
        systems do not maximize gains. They maximize the probability of continued existence.
      </p>
      
      <p>
        This is the home of RCOTT (Restraint Continuity Observation Translation Theory) and related work.
      </p>
      
      <div class="cta-buttons">
        <a href="#" class="cta-button" data-page="rcott">
          <span>Explore the Theory</span>
          <span class="arrow">â</span>
        </a>
        <a href="#" class="cta-button" data-page="translate">
          <span>See it in Your Field</span>
          <span class="arrow">â</span>
        </a>
      </div>
      
      <div class="social-links">
        <a href="https://substack.com/@co3one" target="_blank" class="social-link">Substack</a>
        <a href="https://github.com/rickymp3" target="_blank" class="social-link">GitHub</a>
        <a href="https://www.instagram.com/co3.one" target="_blank" class="social-link">Instagram</a>
        <a href="https://www.youtube.com/@CO3ONE" target="_blank" class="social-link">YouTube</a>
      </div>
      
      <div class="contact-section">
        <h3>Contact</h3>
        <form id="contact-form" action="https://formsubmit.co/founder@co3.one" method="POST">
          <input type="hidden" name="_captcha" value="true">
          <input type="hidden" name="_subject" value="CoÂ³ ONE Contact Form">
          <input type="hidden" name="_template" value="table">
          <input type="hidden" name="_next" value="https://co3.one">
          <div class="form-group">
            <input type="text" name="name" placeholder="Name" required>
          </div>
          <div class="form-group">
            <input type="email" name="email" placeholder="Email" required>
          </div>
          <div class="form-group">
            <textarea name="message" placeholder="Message" rows="4" required></textarea>
          </div>
          <button type="submit">Send</button>
        </form>
      </div>
      
      <div class="patent-badge">
        <a href="#" data-page="patent">Patent Pending Â· Application No. 19/448,772</a>
      </div>
    </div>
  </div>
  
  <!-- Theory Page -->
  <div id="rcott-page" class="page">
    <div class="page-content">
      <h1>Restraint Continuity Observation Translation Theory</h1>
      <p class="subtitle">A 0â1 Pass / "Understood" Gating Framework</p>
      <div class="gating">G := â<sub>m</sub> I<sub>m</sub> â {0, 1}</div>
      <p style="color: var(--gray-light);">
        "1" denotes a binary pass/understood condition. The artifact is internally coherent 
        under a strict 0â1 rule, without partial credit or hedged scoring.
      </p>
      
      <section>
        <h2>Foundational Claim</h2>
        <p>
          Observed system behavior and its translations are governed by the persistence of 
          admissible continuations under accumulating restraints. What remains continuous 
          determines what can move and what can be consistently represented.
        </p>
        <p style="color: var(--orange); font-style: italic; font-size: 1.15rem;">
          Motion and meaning are secondary.
        </p>
        
        <h3>Informal Statement</h3>
        <p>
          What happens next, and how it can be described, are whatever stays allowed, 
          remains stable, and continues to stabilize, while maintaining distance from failure.
        </p>
      </section>
      
      <section>
        <h2>Binary Invariants</h2>
        <p>
          Validity is structural rather than interpretive. Each invariant is encoded as a binary 
          indicator I<sub>m</sub> â {0,1}. Toggle to test the gate.
        </p>
        
        <div class="invariant-list">
          <div class="invariant-item checked" data-inv="1">
            <div class="toggle"></div>
            <div class="label">Sign coherence between prose and optimization direction</div>
          </div>
          <div class="invariant-item checked" data-inv="2">
            <div class="toggle"></div>
            <div class="label">Nonempty-domain requirements for infimum or argmin</div>
          </div>
          <div class="invariant-item checked" data-inv="3">
            <div class="toggle"></div>
            <div class="label">Explicit declaration and typing of the projection/translation map Î </div>
          </div>
          <div class="invariant-item checked" data-inv="4">
            <div class="toggle"></div>
            <div class="label">Sufficient definition of coherence functional C<sub>Î</sub></div>
          </div>
          <div class="invariant-item checked" data-inv="5">
            <div class="toggle"></div>
            <div class="label">Stated convention for boundary edge cases involving âð½</div>
          </div>
        </div>
        
        <div class="gate-result pass" id="gate-result">
          G = 1 Ã 1 Ã 1 Ã 1 Ã 1 = <strong>1</strong> (PASS)
        </div>
      </section>
      
      <section>
        <h2>Mathematical Formulation</h2>
        
        <h3>Symbolic Key</h3>
        <div class="symbol-grid">
          <div class="symbol-item"><span class="sym">X</span><span class="def">state space</span></div>
          <div class="symbol-item"><span class="sym">x</span><span class="def">current state</span></div>
          <div class="symbol-item"><span class="sym">ð½(t,x)</span><span class="def">feasible continuation set</span></div>
          <div class="symbol-item"><span class="sym">âð½(t,x)</span><span class="def">feasibility boundary</span></div>
          <div class="symbol-item"><span class="sym">d(y,âð½)</span><span class="def">margin to violation</span></div>
          <div class="symbol-item"><span class="sym">C<sub>Î</sub>(t,y)</span><span class="def">coherence over window Î</span></div>
          <div class="symbol-item"><span class="sym">ÄC<sub>Î</sub>(t,y)</span><span class="def">coherence trend</span></div>
          <div class="symbol-item"><span class="sym">Î </span><span class="def">projection/translation map</span></div>
        </div>
        
        <h3>Trajectory Rule</h3>
        <div class="math-block">
          <span class="symbol">Ï</span><sub>t+Ît</sub>(x) = <span class="symbol">Î </span>(<br>
          &nbsp;&nbsp;<span class="symbol">argmin</span><sub>y â ð½(t,x)</sub> [<br>
          &nbsp;&nbsp;&nbsp;&nbsp;d(y, âð½) â Î»Â·C<sub>Î</sub>(t,y) â Î¼Â·ÄC<sub>Î</sub>(t,y)<br>
          &nbsp;&nbsp;]<br>
          )
        </div>
      </section>
      
      <section>
        <h2>Cross-Domain Applications</h2>
        <p>
          The framework generalizes by re-instantiating primitives rather than altering the update logic.
        </p>
        
        <div class="domain-selector">
          <div class="domain-pills">
            <button class="domain-pill active" data-domain="physics">Physics</button>
            <button class="domain-pill" data-domain="biology">Biology</button>
            <button class="domain-pill" data-domain="organizations">Organizations</button>
            <button class="domain-pill" data-domain="cognition">Cognition</button>
          </div>
        </div>
        
        <div class="domain-content active" data-domain="physics">
          <h4>Quantum / Classical Systems</h4>
          <table>
            <tr><td>ð½(t,x)</td><td>Admissible quantum states under environmental coupling</td></tr>
            <tr><td>âð½</td><td>Decoherence boundary</td></tr>
            <tr><td>C<sub>Î</sub></td><td>Persistence of interference-capable correlations</td></tr>
            <tr><td>Î </td><td>Coarse-graining map producing classical observables</td></tr>
          </table>
        </div>
        
        <div class="domain-content" data-domain="biology">
          <h4>Biological Systems</h4>
          <table>
            <tr><td>ð½(t,x)</td><td>Metabolically viable organism states</td></tr>
            <tr><td>âð½</td><td>Mortality boundary, homeostatic failure</td></tr>
            <tr><td>C<sub>Î</sub></td><td>Integrated physiological coherence</td></tr>
            <tr><td>Î </td><td>Phenotypic expression</td></tr>
          </table>
        </div>
        
        <div class="domain-content" data-domain="organizations">
          <h4>Organizational Systems</h4>
          <table>
            <tr><td>ð½(t,x)</td><td>Financially viable configurations</td></tr>
            <tr><td>âð½</td><td>Insolvency, regulatory violation</td></tr>
            <tr><td>C<sub>Î</sub></td><td>Strategic coherence, cultural alignment</td></tr>
            <tr><td>Î </td><td>External reporting</td></tr>
          </table>
        </div>
        
        <div class="domain-content" data-domain="cognition">
          <h4>Cognitive Systems</h4>
          <table>
            <tr><td>ð½(t,x)</td><td>Belief states consistent with evidence</td></tr>
            <tr><td>âð½</td><td>Logical contradiction threshold</td></tr>
            <tr><td>C<sub>Î</sub></td><td>Epistemic integration</td></tr>
            <tr><td>Î </td><td>Linguistic expression</td></tr>
          </table>
        </div>
      </section>
      
      <section>
        <h2>Failure Modes</h2>
        <div class="failure-modes">
          <div class="failure-item">
            <h4>Early Failure</h4>
            <p>Actions locally acceptable yet too close to the boundary or exhibiting negative coherence trend.</p>
          </div>
          <div class="failure-item">
            <h4>Hindsight Suddenness</h4>
            <p>Small parameter changes flip the argmin, making discontinuities appear abrupt.</p>
          </div>
        </div>
      </section>
      
      <div class="page-link">
        <a href="#" data-page="translate">See this in your field's language â</a>
      </div>
    </div>
  </div>
  
  <!-- Translate Page -->
  <div id="translate-page" class="page">
    <div class="page-content">
      <h1>RCOTT Translate</h1>
      <p class="tagline">The same framework, in terms you already use.</p>
      
      <div class="field-selector">
        <span class="field-selector-label">I work in</span>
        <div class="field-dropdown">
          <div class="field-dropdown-trigger" id="field-trigger">
            <span id="field-selected">Select your field</span>
            <span class="chevron">â¼</span>
          </div>
          <div class="field-dropdown-menu" id="field-menu">
            <div class="field-dropdown-item" data-field="startup">Startups / Entrepreneurship</div>
            <div class="field-dropdown-item" data-field="therapy">Therapy / Mental Health</div>
            <div class="field-dropdown-item" data-field="finance">Finance / Investing</div>
            <div class="field-dropdown-item" data-field="engineering">Engineering / Systems Design</div>
            <div class="field-dropdown-item" data-field="medicine">Medicine / Healthcare</div>
            <div class="field-dropdown-item" data-field="education">Education / Teaching</div>
            <div class="field-dropdown-item" data-field="creative">Creative / Arts</div>
            <div class="field-dropdown-item" data-field="sports">Sports / Athletics</div>
            <div class="field-dropdown-item" data-field="parenting">Parenting / Caregiving</div>
            <div class="field-dropdown-item" data-field="management">Management / Leadership</div>
            <div class="field-dropdown-item" data-field="relationships">Relationships / Social</div>
            <div class="field-dropdown-item" data-field="everyday">Everyday Life</div>
          </div>
        </div>
      </div>
      
      <div id="placeholder" class="placeholder">
        <div class="icon">â</div>
        <p>Choose your field to see RCOTT in your language</p>
      </div>
      
      <div id="translation" class="translation-container"></div>
    </div>
  </div>
  
  <!-- Patent Page -->
  <div id="patent-page" class="page">
    <div class="page-content patent-protected">
      <div class="patent-header">
        <div class="label">United States Patent Application</div>
        <h1>System and Method for Constraint-Aware Trajectory Optimization</h1>
        <div class="patent-meta">
          <div class="patent-meta-item">
            <div class="key">Application No.</div>
            <div class="value">19/448,772</div>
          </div>
          <div class="patent-meta-item">
            <div class="key">Filing Date</div>
            <div class="value">January 14, 2026</div>
          </div>
          <div class="patent-meta-item">
            <div class="key">Inventor</div>
            <div class="value">Ricardo Cruz Orozco</div>
          </div>
          <div class="patent-meta-item">
            <div class="key">Status</div>
            <div class="value">Patent Pending</div>
          </div>
        </div>
      </div>
      
      <div class="patent-notice">
        <span class="notice-icon">â</span>
        <span>This document is provided for reference only. Content is protected.</span>
      </div>
      
      <div class="patent-section">
        <h2>Abstract</h2>
        <p class="patent-text">A computer-implemented method for selecting trajectories within constrained systems is disclosed. The method generates a finite set of candidate trajectories, predicts time-to-boundary-crossing values for each candidate relative to a failure boundary, and selects a trajectory by comparative ordering that maximizes a minimum temporal margin over a future evaluation horizon. The approach preserves continued system operability and is applicable across physical, computational, and organizational domains.</p>
      </div>
      
      <div class="patent-section">
        <h2>Background of the Invention</h2>
        <h3>Field of the Invention</h3>
        <p class="patent-text">[0003] The present invention relates to computational decision systems and, more particularly, to methods for selecting trajectories within constrained systems to preserve operability over time.</p>
        
        <h3>Description of Related Art</h3>
        <p class="patent-text">[0004] Existing trajectory planning and optimization techniques typically focus on minimizing cost or maximizing performance while satisfying constraints. Such methods may include model predictive control, safety filtering, and clearance-based planning. These approaches generally emphasize constraint satisfaction or spatial clearance and may not account for comparative temporal margins to system failure boundaries when selecting among multiple candidate trajectories. As a result, such systems may remain technically feasible while operating near failure boundaries with limited predictive robustness.</p>
      </div>
      
      <div class="patent-section">
        <h2>Summary of the Invention</h2>
        <p class="patent-text">[0005] The invention provides a computer-implemented method and system for selecting trajectories within constrained systems by generating a finite plurality of candidate trajectories, computing for each candidate a predicted time-to-boundary-crossing relative to a failure boundary, and selecting a trajectory by comparative ordering that maximizes a minimum predicted time-to-boundary-crossing over a future evaluation horizon to preserve operability.</p>
        <p class="patent-text">[0006] The selected trajectory may be output in a form usable by an external control, scheduling, or decision process to reduce risk of boundary violation over time.</p>
      </div>
      
      <div class="patent-section">
        <h2>Detailed Description of the Invention</h2>
        <p class="patent-text">[0012] The invention operates by identifying constraints that define a feasible region of operation for a system. These constraints may be physical, computational, logical, policy-based, or organizational in nature, and collectively define conditions under which continued system operability is preserved.</p>
        <p class="patent-text">[0013] Candidate trajectories are generated as discrete or continuous system evolutions computed from a current system state and constrained to remain initially within the feasible region. The set of candidate trajectories represents admissible future system behaviors for evaluation.</p>
        <p class="patent-text">[0014] For each candidate trajectory, a predicted time-to-boundary-crossing (TTBC) value is computed. The TTBC represents an estimated future time at which the candidate trajectory would intersect a failure boundary associated with loss of operability if the trajectory were continued.</p>
        <p class="patent-text">[0015] TTBC computation may be performed using forward simulation of system dynamics, interpolation between sampled trajectory states, or analytical evaluation of constraint functions over time. In discrete or stepwise systems, TTBC may be approximated by identifying the earliest timestep at which a constraint inequality defining the failure boundary is violated.</p>
        <p class="patent-text">[0016] The TTBC metric differs from time-to-collision methods in that it evaluates temporal margin relative to abstract or system-defined boundaries rather than physical object collisions, and is applicable to non-physical domains including computational and organizational systems.</p>
        <p class="patent-text">[0017] Candidate trajectories are comparatively ordered based on their TTBC values. In one embodiment, comparative ordering maximizes a minimum TTBC over a predefined evaluation horizon, thereby prioritizing trajectories that exhibit greater temporal robustness with respect to the failure boundary.</p>
        <p class="patent-text">[0018] The selected trajectory is output in a form usable by an external system or decision process, including control execution, scheduling, or governance action, thereby enabling operational decisions that reduce the likelihood of boundary violation over time.</p>
      </div>
      
      <div class="patent-section">
        <h2>Figures</h2>
        
        <div class="figure-full">
          <div class="figure-label">FIG. 1</div>
          <div class="figure-title">System Architecture</div>
          <svg class="patent-figure" viewBox="0 0 800 120" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#ff6700"/>
              </marker>
            </defs>
            <!-- Boxes -->
            <rect x="20" y="40" width="120" height="40" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="80" y="57" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Constraint</text>
            <text x="80" y="70" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Identification</text>
            
            <rect x="180" y="40" width="120" height="40" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="240" y="57" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Trajectory</text>
            <text x="240" y="70" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Computation</text>
            
            <rect x="340" y="40" width="120" height="40" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="400" y="57" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Boundary</text>
            <text x="400" y="70" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Evaluation</text>
            
            <rect x="500" y="40" width="120" height="40" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="560" y="57" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Selection</text>
            <text x="560" y="70" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Module</text>
            
            <rect x="660" y="40" width="120" height="40" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="720" y="57" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Output</text>
            <text x="720" y="70" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Translation</text>
            
            <!-- Arrows -->
            <line x1="140" y1="60" x2="175" y2="60" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead)"/>
            <line x1="300" y1="60" x2="335" y2="60" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead)"/>
            <line x1="460" y1="60" x2="495" y2="60" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead)"/>
            <line x1="620" y1="60" x2="655" y2="60" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead)"/>
          </svg>
          <p class="figure-desc">Trajectory selection architecture defining a feasible region and an associated failure boundary.</p>
        </div>
        
        <div class="figure-full">
          <div class="figure-label">FIG. 2</div>
          <div class="figure-title">Method Flow</div>
          <svg class="patent-figure" viewBox="0 0 400 420" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#ff6700"/>
              </marker>
            </defs>
            <!-- Step 1 -->
            <rect x="50" y="20" width="300" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="200" y="50" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">Identify constraints defining a feasible region</text>
            
            <!-- Arrow 1 -->
            <line x1="200" y1="70" x2="200" y2="95" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead2)"/>
            
            <!-- Step 2 -->
            <rect x="50" y="100" width="300" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="200" y="122" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">Compute candidate trajectories within</text>
            <text x="200" y="138" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">the feasible region</text>
            
            <!-- Arrow 2 -->
            <line x1="200" y1="150" x2="200" y2="175" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead2)"/>
            
            <!-- Step 3 -->
            <rect x="50" y="180" width="300" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="200" y="202" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">Evaluate proximity of candidate trajectories</text>
            <text x="200" y="218" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">to failure boundary over prediction horizon</text>
            
            <!-- Arrow 3 -->
            <line x1="200" y1="230" x2="200" y2="255" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead2)"/>
            
            <!-- Step 4 -->
            <rect x="50" y="260" width="300" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="200" y="282" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">Select trajectory based on preservation of</text>
            <text x="200" y="298" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">distance from the failure boundary</text>
            
            <!-- Arrow 4 -->
            <line x1="200" y1="310" x2="200" y2="335" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead2)"/>
            
            <!-- Step 5 -->
            <rect x="50" y="340" width="300" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="200" y="362" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">Generate an output representation</text>
            <text x="200" y="378" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">corresponding to the selected trajectory</text>
          </svg>
          <p class="figure-desc">Trajectory generation module producing a finite plurality of candidate trajectories within the feasible region.</p>
        </div>
        
        <div class="figure-full">
          <div class="figure-label">FIG. 3</div>
          <div class="figure-title">Feasible Region and Trajectories</div>
          <svg class="patent-figure" viewBox="0 0 500 350" xmlns="http://www.w3.org/2000/svg">
            <!-- Outer boundary (failure boundary) -->
            <rect x="30" y="30" width="440" height="280" rx="30" ry="30" fill="none" stroke="#444" stroke-width="2"/>
            <text x="60" y="55" fill="#666" font-size="10" font-family="JetBrains Mono, monospace">Failure Boundary</text>
            
            <!-- Feasible region -->
            <path d="M100,200 Q80,120 150,100 Q250,70 350,120 Q420,160 380,220 Q340,280 250,270 Q160,260 120,230 Q90,210 100,200" fill="rgba(255,103,0,0.05)" stroke="#ff6700" stroke-width="1"/>
            <text x="230" y="190" fill="#ff6700" font-size="11" font-family="Cormorant Garamond, serif" font-style="italic">FEASIBLE REGION</text>
            
            <!-- Current state -->
            <circle cx="120" cy="180" r="25" fill="none" stroke="#666" stroke-width="1"/>
            <circle cx="120" cy="180" r="3" fill="#ff6700"/>
            <text x="90" y="220" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">CURRENT</text>
            <text x="98" y="232" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">STATE</text>
            
            <!-- Trajectory 1 (approaches boundary) -->
            <path d="M120,180 Q200,140 280,100 Q340,70 390,85" fill="none" stroke="#888" stroke-width="1" stroke-dasharray="4,2"/>
            <circle cx="390" cy="85" r="4" fill="#888"/>
            <text x="320" y="75" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">CANDIDATE</text>
            <text x="320" y="87" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">TRAJECTORY 1</text>
            
            <!-- Trajectory 2 (stays in feasible region) -->
            <path d="M120,180 Q180,190 250,200 Q320,210 370,190" fill="none" stroke="#ff6700" stroke-width="1.5"/>
            <circle cx="370" cy="190" r="4" fill="#ff6700"/>
            <text x="375" y="175" fill="#ff6700" font-size="9" font-family="JetBrains Mono, monospace">CANDIDATE</text>
            <text x="375" y="187" fill="#ff6700" font-size="9" font-family="JetBrains Mono, monospace">TRAJECTORY 2</text>
          </svg>
          <p class="figure-desc">Trajectory evaluation module computing predicted time-to-boundary-crossing values for candidate trajectories relative to the failure boundary.</p>
        </div>
        
        <div class="figure-full">
          <div class="figure-label">FIG. 4</div>
          <div class="figure-title">Selection Module</div>
          <svg class="patent-figure" viewBox="0 0 700 140" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <marker id="arrowhead4" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#ff6700"/>
              </marker>
            </defs>
            <!-- Input trajectories -->
            <rect x="20" y="15" width="130" height="30" fill="none" stroke="#666" stroke-width="1"/>
            <text x="85" y="35" text-anchor="middle" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">Candidate Traj. 1</text>
            
            <rect x="20" y="55" width="130" height="30" fill="none" stroke="#666" stroke-width="1"/>
            <text x="85" y="75" text-anchor="middle" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">Candidate Traj. 2</text>
            
            <rect x="20" y="95" width="130" height="30" fill="none" stroke="#666" stroke-width="1"/>
            <text x="85" y="115" text-anchor="middle" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">Candidate Traj. N</text>
            
            <!-- Converging lines -->
            <line x1="150" y1="30" x2="220" y2="70" stroke="#666" stroke-width="1"/>
            <line x1="150" y1="70" x2="220" y2="70" stroke="#666" stroke-width="1"/>
            <line x1="150" y1="110" x2="220" y2="70" stroke="#666" stroke-width="1"/>
            
            <!-- Selection module -->
            <rect x="230" y="45" width="130" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="295" y="75" text-anchor="middle" fill="#ff6700" font-size="10" font-family="JetBrains Mono, monospace">Selection Module</text>
            
            <!-- Arrow to output -->
            <line x1="360" y1="70" x2="410" y2="70" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead4)"/>
            
            <!-- Output module -->
            <rect x="420" y="45" width="130" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="485" y="68" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Output /</text>
            <text x="485" y="82" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Translation Module</text>
            
            <!-- Arrow to representation -->
            <line x1="550" y1="70" x2="600" y2="70" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead4)"/>
            
            <!-- Output representation -->
            <rect x="610" y="45" width="70" height="50" fill="rgba(255,103,0,0.1)" stroke="#ff6700" stroke-width="1"/>
            <text x="645" y="68" text-anchor="middle" fill="#ff6700" font-size="8" font-family="JetBrains Mono, monospace">Output</text>
            <text x="645" y="80" text-anchor="middle" fill="#ff6700" font-size="8" font-family="JetBrains Mono, monospace">Repr.</text>
          </svg>
          <p class="figure-desc">Trajectory selection module comparatively ordering candidate trajectories based on predicted time-to-boundary-crossing values.</p>
        </div>
        
        <div class="figure-full">
          <div class="figure-label">FIG. 5</div>
          <div class="figure-title">Computing System</div>
          <svg class="patent-figure" viewBox="0 0 700 200" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <marker id="arrowhead5" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#ff6700"/>
              </marker>
            </defs>
            <!-- System boundary -->
            <rect x="20" y="20" width="660" height="160" fill="none" stroke="#333" stroke-width="1"/>
            <text x="350" y="170" text-anchor="middle" fill="#666" font-size="10" font-family="JetBrains Mono, monospace">Computing System</text>
            
            <!-- Processor -->
            <rect x="40" y="40" width="100" height="35" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="90" y="62" text-anchor="middle" fill="#ff6700" font-size="10" font-family="JetBrains Mono, monospace">Processor</text>
            
            <!-- Memory -->
            <rect x="560" y="40" width="100" height="35" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="610" y="62" text-anchor="middle" fill="#ff6700" font-size="10" font-family="JetBrains Mono, monospace">Memory</text>
            
            <!-- Connection line -->
            <line x1="140" y1="57" x2="560" y2="57" stroke="#444" stroke-width="1"/>
            
            <!-- Vertical lines -->
            <line x1="90" y1="75" x2="90" y2="95" stroke="#444" stroke-width="1"/>
            
            <!-- Module boxes -->
            <rect x="40" y="100" width="95" height="45" fill="none" stroke="#666" stroke-width="1"/>
            <text x="87" y="120" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Constraint</text>
            <text x="87" y="132" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Identification</text>
            
            <rect x="155" y="100" width="95" height="45" fill="none" stroke="#666" stroke-width="1"/>
            <text x="202" y="120" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Trajectory</text>
            <text x="202" y="132" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Computation</text>
            
            <rect x="270" y="100" width="95" height="45" fill="none" stroke="#666" stroke-width="1"/>
            <text x="317" y="120" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Boundary</text>
            <text x="317" y="132" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Evaluation</text>
            
            <rect x="385" y="100" width="95" height="45" fill="none" stroke="#666" stroke-width="1"/>
            <text x="432" y="120" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Selection</text>
            <text x="432" y="132" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Module</text>
            
            <rect x="500" y="100" width="95" height="45" fill="none" stroke="#666" stroke-width="1"/>
            <text x="547" y="120" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Output /</text>
            <text x="547" y="132" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Translation</text>
            
            <!-- Module arrows -->
            <line x1="135" y1="122" x2="150" y2="122" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead5)"/>
            <line x1="250" y1="122" x2="265" y2="122" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead5)"/>
            <line x1="365" y1="122" x2="380" y2="122" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead5)"/>
            <line x1="480" y1="122" x2="495" y2="122" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead5)"/>
          </svg>
          <p class="figure-desc">Output interface providing an output representation of the selected trajectory for use by an external system or decision process.</p>
        </div>
      </div>
      
      <div class="patent-section">
        <h2>Claims</h2>
        <div class="claims-list">
          <div class="claim-item claim-independent">
            <p>A computer-implemented method for selecting a trajectory within a constrained system, comprising:</p>
            <p class="claim-element">(i) identifying constraints defining a feasible region of system operation;</p>
            <p class="claim-element">(ii) computing, by a trajectory generation module, a finite plurality of candidate trajectories extending from a current system state and admissible within the feasible region;</p>
            <p class="claim-element">(iii) evaluating, by a trajectory evaluation module, each candidate trajectory by computing a predicted time-to-boundary-crossing value representing a predicted time until the candidate trajectory intersects a failure boundary associated with loss of system operability;</p>
            <p class="claim-element">(iv) selecting, by a trajectory selection module, one of the candidate trajectories based on a comparative ordering that maximizes a minimum predicted time-to-boundary-crossing across the candidate trajectories over a future evaluation horizon; and</p>
            <p class="claim-element">(v) generating, by an output interface, an output representation corresponding to the selected trajectory for use by an external system or decision process.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein evaluating each candidate trajectory comprises forward simulating the constrained system under the candidate trajectory across the future evaluation horizon to identify an earliest time at which a constraint defining the failure boundary is violated.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the constraints comprise one or more inequality constraints, and wherein the predicted time-to-boundary-crossing value is computed by detecting a threshold crossing or sign change of a constraint function evaluated along the candidate trajectory.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the constrained system is modeled in discrete time, and wherein the predicted time-to-boundary-crossing value is approximated by identifying a first discrete timestep within the future evaluation horizon at which a constraint inequality is violated.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein generating the finite plurality of candidate trajectories comprises selecting trajectory primitives from a predefined library or sampling admissible trajectories from a trajectory generator.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the comparative ordering further accounts for at least one secondary criterion selected from:</p>
            <p class="claim-element">(i) a rate of decrease of temporal margin relative to the failure boundary,</p>
            <p class="claim-element">(ii) a stability metric,</p>
            <p class="claim-element">(iii) an energy or resource expenditure metric, or</p>
            <p class="claim-element">(iv) a priority weighting applied to subsets of the constraints.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the failure boundary corresponds to a boundary of the feasible region, and wherein the predicted time-to-boundary-crossing represents a predicted time until the candidate trajectory exits the feasible region.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the future evaluation horizon comprises a fixed temporal duration, a fixed number of discrete timesteps, or a dynamically selected horizon determined based on at least one of system state, constraint tightness, or computational budget.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the output representation comprises at least one of:</p>
            <p class="claim-element">(i) a control sequence,</p>
            <p class="claim-element">(ii) a schedule,</p>
            <p class="claim-element">(iii) a recommendation,</p>
            <p class="claim-element">(iv) a governance action,</p>
            <p class="claim-element">(v) a plan, or</p>
            <p class="claim-element">(vi) a machine-readable instruction set consumable by the external system or decision process.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the constrained system corresponds to a physical system subject to one or more physical, mechanical, or environmental constraints.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the constrained system corresponds to a computational system subject to one or more logical, computational, or resource-based constraints.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the constrained system corresponds to an organizational or institutional system subject to one or more policy, regulatory, operational, or governance constraints.</p>
          </div>
          
          <div class="claim-item claim-independent">
            <p>A computer-implemented system comprising one or more processors and one or more memories storing instructions that, when executed, cause the one or more processors to perform the method of any one of claims 1â12.</p>
          </div>
          
          <div class="claim-item claim-independent">
            <p>A non-transitory computer-readable medium storing instructions that, when executed by one or more processors, cause the one or more processors to perform the method of any one of claims 1â12.</p>
          </div>
        </div>
      </div>
      
      <div class="page-link">
        <a href="#" data-page="rcott">â Back to Theory</a>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // ============ THREE.JS BACKGROUND ============
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);
    
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 12, 0.01);
    camera.lookAt(0, 0, 0);
    
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    container.appendChild(renderer.domElement);
    
    const gridColor = 0x4a4a4a;
    const gridRadius = 5;
    const wellDepth = 3;
    const wellSharpness = 1.4;
    
    let speedMultiplier = 1;
    let targetSpeed = 1;
    
    function calculateWellZ(r) {
      const normalizedR = r / gridRadius;
      const z = -wellDepth * Math.pow(1 - normalizedR, wellSharpness) / (normalizedR + 0.1);
      return Math.max(z, -wellDepth * 3.5);
    }
    
    const numRings = 28;
    const ringLifespans = [];
    const ringsGroup = new THREE.Group();
    
    for (let i = 0; i < numRings; i++) {
      ringLifespans.push({
        progress: i / numRings,
        baseSpeed: 0.12 + Math.random() * 0.04
      });
      
      const geometry = new THREE.BufferGeometry();
      const segments = 72;
      const positions = new Float32Array((segments + 1) * 3);
      geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      
      const material = new THREE.LineBasicMaterial({ 
        color: gridColor,
        transparent: true,
        opacity: 0.7
      });
      
      const ring = new THREE.Line(geometry, material);
      ringsGroup.add(ring);
    }
    scene.add(ringsGroup);
    
    const numSpokes = 32;
    const particlesPerSpoke = 6;
    const spokeParticles = [];
    const spokesGroup = new THREE.Group();
    
    for (let i = 0; i < numSpokes; i++) {
      const angle = (i / numSpokes) * Math.PI * 2;
      
      for (let j = 0; j < particlesPerSpoke; j++) {
        spokeParticles.push({
          angle: angle,
          progress: j / particlesPerSpoke,
          baseSpeed: 0.1 + Math.random() * 0.06
        });
        
        const geometry = new THREE.BufferGeometry();
        const positions = new Float32Array(2 * 3);
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        
        const material = new THREE.LineBasicMaterial({
          color: gridColor,
          transparent: true,
          opacity: 0.5
        });
        
        const segment = new THREE.Line(geometry, material);
        spokesGroup.add(segment);
      }
    }
    scene.add(spokesGroup);
    
    const rimGeometry = new THREE.RingGeometry(gridRadius - 0.05, gridRadius + 0.05, 72);
    const rimMaterial = new THREE.MeshBasicMaterial({ 
      color: gridColor, 
      side: THREE.DoubleSide,
      transparent: true,
      opacity: 0.9
    });
    const rim = new THREE.Mesh(rimGeometry, rimMaterial);
    rim.rotation.x = -Math.PI / 2;
    rim.position.y = 0.01;
    scene.add(rim);
    
    function updateRings(delta) {
      ringsGroup.children.forEach((ring, i) => {
        const life = ringLifespans[i];
        life.progress += delta * life.baseSpeed * speedMultiplier;
        
        if (life.progress >= 1) {
          life.progress = 0;
          life.baseSpeed = 0.12 + Math.random() * 0.04;
        }
        
        const currentRadius = gridRadius * (1 - life.progress);
        const fadeStart = 0.65;
        ring.material.opacity = life.progress > fadeStart 
          ? 0.7 * (1 - (life.progress - fadeStart) / (1 - fadeStart))
          : 0.7;
        
        const positions = ring.geometry.attributes.position.array;
        for (let j = 0; j <= 72; j++) {
          const angle = (j / 72) * Math.PI * 2;
          positions[j * 3] = Math.cos(angle) * currentRadius;
          positions[j * 3 + 1] = calculateWellZ(currentRadius);
          positions[j * 3 + 2] = Math.sin(angle) * currentRadius;
        }
        ring.geometry.attributes.position.needsUpdate = true;
      });
    }
    
    function updateSpokes(delta) {
      spokesGroup.children.forEach((segment, i) => {
        const particle = spokeParticles[i];
        particle.progress += delta * particle.baseSpeed * speedMultiplier;
        
        if (particle.progress >= 1) {
          particle.progress = 0;
          particle.baseSpeed = 0.1 + Math.random() * 0.06;
        }
        
        const segmentLength = 0.1;
        const startR = gridRadius * (1 - particle.progress);
        const endR = gridRadius * (1 - Math.min(particle.progress + segmentLength, 1));
        
        const fadeStart = 0.55;
        segment.material.opacity = particle.progress > fadeStart
          ? 0.5 * (1 - (particle.progress - fadeStart) / (1 - fadeStart))
          : 0.5;
        
        const positions = segment.geometry.attributes.position.array;
        positions[0] = Math.cos(particle.angle) * startR;
        positions[1] = calculateWellZ(startR);
        positions[2] = Math.sin(particle.angle) * startR;
        positions[3] = Math.cos(particle.angle) * endR;
        positions[4] = calculateWellZ(endR);
        positions[5] = Math.sin(particle.angle) * endR;
        segment.geometry.attributes.position.needsUpdate = true;
      });
    }
    
    function animate() {
      requestAnimationFrame(animate);
      speedMultiplier += (targetSpeed - speedMultiplier) * 0.05;
      updateRings(0.016);
      updateSpokes(0.016);
      renderer.render(scene, camera);
    }
    animate();
    
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
    
    // ============ NAVIGATION ============
    const logoText = document.getElementById('logo-text');
    const nav = document.getElementById('nav');
    const pages = document.querySelectorAll('.page');
    const navLinks = document.querySelectorAll('[data-page]');
    const transitionOverlay = document.getElementById('transition-overlay');
    
    let currentPage = 'splash';
    let isTransitioning = false;
    let autoReturnTimer = null;
    const AUTO_RETURN_MS = 5 * 60 * 1000;
    
    function resetAutoReturn() {
      if (autoReturnTimer) clearTimeout(autoReturnTimer);
      if (currentPage !== 'splash') {
        autoReturnTimer = setTimeout(() => navigateTo('splash'), AUTO_RETURN_MS);
      }
    }
    
    document.addEventListener('mousemove', resetAutoReturn);
    document.addEventListener('touchstart', resetAutoReturn);
    document.addEventListener('scroll', resetAutoReturn);
    
    function navigateTo(page) {
      if (page === currentPage || isTransitioning) return;
      
      isTransitioning = true;
      
      // Fade out current content smoothly
      pages.forEach(p => p.classList.remove('active'));
      nav.classList.remove('visible');
      logoText.classList.add('hidden');
      
      // Fade in transition logo
      transitionOverlay.classList.add('active');
      
      // Gentle slowdown
      targetSpeed = 0.4;
      
      // Brief pause, then hyperdrive
      setTimeout(() => {
        targetSpeed = 25;
      }, 600);
      
      // Start fading out logo and fading in new content
      setTimeout(() => {
        transitionOverlay.classList.remove('active');
        
        // Ease out of hyperdrive
        targetSpeed = 8;
        
        // Fade in new content
        if (page === 'splash') {
          logoText.classList.remove('hidden');
          if (autoReturnTimer) clearTimeout(autoReturnTimer);
        } else {
          nav.classList.add('visible');
          document.getElementById(page + '-page').classList.add('active');
          resetAutoReturn();
        }
        
        navLinks.forEach(link => {
          link.classList.toggle('active', link.dataset.page === page);
        });
        
        currentPage = page;
        
        // Update demo banner visibility
        if (typeof updateDemoBanner === 'function') {
          updateDemoBanner();
        }
        
        const activePage = document.querySelector('.page.active');
        if (activePage) activePage.scrollTop = 0;
        
      }, 1400);
      
      // Settle to normal speed
      setTimeout(() => {
        targetSpeed = page === 'splash' ? 1 : 0.8;
        isTransitioning = false;
      }, 2400);
    }
    
    logoText.addEventListener('click', () => navigateTo('about'));
    
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        navigateTo(link.dataset.page);
      });
    });
    
    // ============ INVARIANT TOGGLE ============
    const invariantItems = document.querySelectorAll('.invariant-item');
    const gateResult = document.getElementById('gate-result');
    
    function updateGate() {
      const values = Array.from(invariantItems).map(item => item.classList.contains('checked') ? 1 : 0);
      const product = values.reduce((a, b) => a * b, 1);
      gateResult.innerHTML = `G = ${values.join(' Ã ')} = <strong>${product}</strong> (${product === 1 ? 'PASS' : 'FAIL'})`;
      gateResult.className = 'gate-result ' + (product === 1 ? 'pass' : 'fail');
    }
    
    invariantItems.forEach(item => {
      item.addEventListener('click', () => {
        item.classList.toggle('checked');
        updateGate();
      });
    });
    
    // ============ DOMAIN PILLS ============
    const domainPills = document.querySelectorAll('.domain-pill');
    const domainContents = document.querySelectorAll('.domain-content');
    
    domainPills.forEach(pill => {
      pill.addEventListener('click', () => {
        const domain = pill.dataset.domain;
        domainPills.forEach(p => p.classList.remove('active'));
        domainContents.forEach(c => c.classList.remove('active'));
        pill.classList.add('active');
        document.querySelector(`.domain-content[data-domain="${domain}"]`).classList.add('active');
      });
    });
    
    // ============ CUSTOM FIELD DROPDOWN ============
    const fieldTrigger = document.getElementById('field-trigger');
    const fieldMenu = document.getElementById('field-menu');
    const fieldSelected = document.getElementById('field-selected');
    const fieldItems = document.querySelectorAll('.field-dropdown-item');
    const placeholder = document.getElementById('placeholder');
    const translationContainer = document.getElementById('translation');
    
    let dropdownOpen = false;
    
    fieldTrigger.addEventListener('click', () => {
      dropdownOpen = !dropdownOpen;
      fieldTrigger.classList.toggle('open', dropdownOpen);
      fieldMenu.classList.toggle('open', dropdownOpen);
    });
    
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.field-dropdown') && dropdownOpen) {
        dropdownOpen = false;
        fieldTrigger.classList.remove('open');
        fieldMenu.classList.remove('open');
      }
    });
    
    const translations = {
      startup: {
        context: { title: "For Founders & Entrepreneurs", description: "You navigate uncertainty, manage burn rate, and search for product-market fit." },
        bigIdea: "Do not optimize for growth. Optimize for survival long enough to find what works. The startups that win are not the ones that move fastest. They are the ones that stay alive long enough to get lucky.",
        concepts: [
          { symbol: "ð½(t,x)", term: "Your Runway", explanation: "The set of moves you can actually make given your current cash, team, and market position.", example: "At 18 months runway, you can pivot. At 3 months, you are locked in." },
          { symbol: "âð½", term: "The Death Zone", explanation: "Zero cash. Key person quits. Legal shutdown.", example: "Every decision that feels urgent is probably pushing you toward an edge." },
          { symbol: "d(y,âð½)", term: "Margin / Buffer", explanation: "How much room you have before you hit a wall.", example: "The founders who seem lucky usually just maintained enough margin to survive their mistakes." },
          { symbol: "C_Î", term: "Product-Market Coherence", explanation: "How well your product, market, team, and business model fit together.", example: "Retention is a coherence signal." },
          { symbol: "Î ", term: "Your Pitch", explanation: "How you translate your actual state into something investors can understand.", example: "The best founders are great translators." }
        ],
        failures: [
          { title: "Premature Scaling", description: "Growing fast while margins are thin. Feels like winning until one bad quarter." },
          { title: "The Slow Bleed", description: "Small coherence losses that seem fine month-to-month." }
        ]
      },
      therapy: {
        context: { title: "For Therapists & Counselors", description: "You help people navigate emotional complexity and build resilience." },
        bigIdea: "Mental health is not about feeling good. It is about maintaining enough stability to keep moving through whatever comes.",
        concepts: [
          { symbol: "ð½(t,x)", term: "Window of Tolerance", explanation: "The emotional range where someone can still function.", example: "A client in their window can talk about hard things." },
          { symbol: "âð½", term: "Breakdown Threshold", explanation: "The edge where coping fails.", example: "Panic attacks, dissociation, self-harm." },
          { symbol: "d(y,âð½)", term: "Emotional Buffer", explanation: "How much capacity before they hit their limit.", example: "Sleep, support systems, routines all build buffer." },
          { symbol: "C_Î", term: "Internal Coherence", explanation: "How integrated someone's sense of self is.", example: "Trauma fragments coherence." },
          { symbol: "Î ", term: "Narrative", explanation: "How someone makes sense of their experience.", example: "Therapy helps translate chaos into livable narrative." }
        ],
        failures: [
          { title: "Premature Exposure", description: "Processing trauma before enough buffer exists." },
          { title: "Chronic Low Margin", description: "Functioning but always one bad day from crisis." }
        ]
      },
      finance: {
        context: { title: "For Finance & Investing", description: "You manage risk, allocate capital, and try to grow wealth without blowing up." },
        bigIdea: "The best investors stay in the game long enough for compounding to work. Survival is the strategy.",
        concepts: [
          { symbol: "ð½(t,x)", term: "Feasible Positions", explanation: "Portfolio states you can hold given capital and risk limits.", example: "Your feasible set changes with leverage." },
          { symbol: "âð½", term: "Margin Call / Ruin", explanation: "Where you are forced to liquidate.", example: "LTCM, Archegos, FTX all crossed this boundary." },
          { symbol: "d(y,âð½)", term: "Risk Buffer", explanation: "How much you can lose before forced liquidation.", example: "Position sizing is choosing your distance from the edge." },
          { symbol: "C_Î", term: "Portfolio Coherence", explanation: "How well positions work together.", example: "True diversification builds coherence." },
          { symbol: "Î ", term: "Marks", explanation: "How you translate portfolio state into reported numbers.", example: "Illiquid assets are translation problems." }
        ],
        failures: [
          { title: "Leveraged Concentration", description: "Maximizes returns until the one scenario you did not model." },
          { title: "Liquidity Illusion", description: "Positions that look liquid until stress." }
        ]
      },
      engineering: {
        context: { title: "For Engineers", description: "You build things that need to work reliably." },
        bigIdea: "Good engineering is about systems that fail gracefully. Robustness beats performance.",
        concepts: [
          { symbol: "ð½(t,x)", term: "Operating Envelope", explanation: "Conditions where your system functions correctly.", example: "What happens at 10x expected load?" },
          { symbol: "âð½", term: "Failure Boundary", explanation: "Where the system breaks.", example: "Memory exhaustion, deadlock, cascading failures." },
          { symbol: "d(y,âð½)", term: "Safety Margin", explanation: "Headroom before hitting limits.", example: "Running at 50% gives room for surprises." },
          { symbol: "C_Î", term: "System Coherence", explanation: "How well components work together.", example: "Technical debt is accumulated incoherence." },
          { symbol: "Î ", term: "API", explanation: "How internal complexity becomes usable interface.", example: "Good APIs hide internals, expose right controls." }
        ],
        failures: [
          { title: "Capacity Blindness", description: "No graceful degradation, just cliff-edge failure." },
          { title: "Coherence Rot", description: "Each hack adds confusion until nothing is safe to change." }
        ]
      },
      medicine: {
        context: { title: "For Healthcare Providers", description: "You help bodies maintain function and recover from insults." },
        bigIdea: "Health is maintaining enough physiological reserve to handle whatever comes next.",
        concepts: [
          { symbol: "ð½(t,x)", term: "Physiological Reserve", explanation: "The range of states a body can maintain.", example: "Frail patients have almost no reserve." },
          { symbol: "âð½", term: "Decompensation", explanation: "Where compensatory mechanisms fail.", example: "They were compensating until they could not." },
          { symbol: "d(y,âð½)", term: "Physiological Margin", explanation: "How much stress the body can absorb.", example: "Prehabilitation builds margin before surgery." },
          { symbol: "C_Î", term: "Homeostatic Coherence", explanation: "How well organ systems work together.", example: "Multi-organ dysfunction is loss of coherence." },
          { symbol: "Î ", term: "Diagnosis", explanation: "How you translate physiology into categories.", example: "Sepsis collapses complexity into action." }
        ],
        failures: [
          { title: "Occult Decompensation", description: "Patient compensating well until sudden collapse." },
          { title: "Iatrogenic Cascade", description: "Treatment that solves one problem while creating another." }
        ]
      },
      education: {
        context: { title: "For Educators", description: "You help people learn and develop capabilities." },
        bigIdea: "Learning is expanding what is possible while keeping them in a zone where growth can happen.",
        concepts: [
          { symbol: "ð½(t,x)", term: "Zone of Proximal Development", explanation: "What the student can engage with.", example: "Algebra needs arithmetic foundation." },
          { symbol: "âð½", term: "Frustration Point", explanation: "Where learning stops.", example: "Glazed eyes, acting out, feeling stupid." },
          { symbol: "d(y,âð½)", term: "Productive Struggle", explanation: "Challenged but not overwhelmed.", example: "Scaffolding creates margin." },
          { symbol: "C_Î", term: "Conceptual Coherence", explanation: "How well new learning connects.", example: "Formulas without understanding equal low coherence." },
          { symbol: "Î ", term: "Assessment", explanation: "How you translate learning into signals.", example: "Every grade is a translation." }
        ],
        failures: [
          { title: "Teaching to Test", description: "Optimizing grades at expense of understanding." },
          { title: "Premature Advancement", description: "Moving forward before foundations are solid." }
        ]
      },
      creative: {
        context: { title: "For Creatives", description: "You make things that did not exist before." },
        bigIdea: "Creative work is maintaining enough structure to keep working while leaving space for surprise.",
        concepts: [
          { symbol: "ð½(t,x)", term: "Possibility Space", explanation: "What you can make given skills and constraints.", example: "Tools shape possibilities." },
          { symbol: "âð½", term: "Block / Burnout", explanation: "Where making becomes impossible.", example: "Fear, depletion, or loss of meaning." },
          { symbol: "d(y,âð½)", term: "Creative Reserve", explanation: "Capacity for the work.", example: "Day job creates margin for risk." },
          { symbol: "C_Î", term: "Aesthetic Coherence", explanation: "How well elements hold together.", example: "Great albums have coherence." },
          { symbol: "Î ", term: "Release", explanation: "How work becomes receivable.", example: "The final mix is a translation." }
        ],
        failures: [
          { title: "Perfectionist Paralysis", description: "Nothing feels safe to release." },
          { title: "Coherence Drift", description: "Compromising until it is unrecognizable." }
        ]
      },
      sports: {
        context: { title: "For Athletes & Coaches", description: "You develop performance while managing injury risk." },
        bigIdea: "Peak performance is training at the edge of what you can recover from, consistently.",
        concepts: [
          { symbol: "ð½(t,x)", term: "Training Capacity", explanation: "What your body can handle.", example: "Capacity changes with recovery status." },
          { symbol: "âð½", term: "Injury Line", explanation: "Where breakdown happens.", example: "Every injured athlete crossed an edge." },
          { symbol: "d(y,âð½)", term: "Recovery Buffer", explanation: "Room before overtraining.", example: "Athletes who stay healthy recover best." },
          { symbol: "C_Î", term: "Movement Coherence", explanation: "How everything works together.", example: "Compensations are incoherence." },
          { symbol: "Î ", term: "Metrics", explanation: "How you track physical state.", example: "Every metric is partial." }
        ],
        failures: [
          { title: "Overreach Blindness", description: "Cannibalizing recovery for results." },
          { title: "Compensation Cascade", description: "Small imbalance leads to injury." }
        ]
      },
      parenting: {
        context: { title: "For Parents", description: "You are raising humans while keeping them safe." },
        bigIdea: "Good parenting is maintaining a secure base from which kids can explore.",
        concepts: [
          { symbol: "ð½(t,x)", term: "What They Can Handle", explanation: "Challenges given age and support.", example: "A rested, connected kid handles more." },
          { symbol: "âð½", term: "Overwhelm", explanation: "Where they hit their limit.", example: "Meltdowns, withdrawal, regression." },
          { symbol: "d(y,âð½)", term: "Emotional Buffer", explanation: "How much they can absorb.", example: "Hard day at school equals less margin at home." },
          { symbol: "C_Î", term: "Secure Attachment", explanation: "Sense of safety and connection.", example: "Secure kids explore more freely." },
          { symbol: "Î ", term: "Behavior", explanation: "How they show their inner world.", example: "I hate you means I am overwhelmed." }
        ],
        failures: [
          { title: "Overprotection", description: "So much margin they never learn difficulty." },
          { title: "Connection Erosion", description: "Small ruptures that do not get repaired." }
        ]
      },
      management: {
        context: { title: "For Managers", description: "You are responsible for teams and their performance." },
        bigIdea: "Leadership is creating conditions where good results become likely.",
        concepts: [
          { symbol: "ð½(t,x)", term: "Team Capacity", explanation: "What your team can deliver.", example: "Do not promise outside the feasible set." },
          { symbol: "âð½", term: "Burnout Edge", explanation: "Where the team breaks down.", example: "Every sudden resignation was brewing." },
          { symbol: "d(y,âð½)", term: "Slack", explanation: "Buffer for surprises.", example: "100% capacity equals no margin for unexpected." },
          { symbol: "C_Î", term: "Team Coherence", explanation: "How well people work together.", example: "High performers have high coherence." },
          { symbol: "Î ", term: "Metrics", explanation: "How you translate reality into dashboards.", example: "Every metric can be gamed." }
        ],
        failures: [
          { title: "Metric Goodhart", description: "Optimizing dashboards while coherence degrades." },
          { title: "Accumulated Unspoken", description: "Small issues becoming crisis." }
        ]
      },
      relationships: {
        context: { title: "For Relationships", description: "You are building connections with other humans." },
        bigIdea: "Relationships fail from accumulated small ruptures that never get repaired.",
        concepts: [
          { symbol: "ð½(t,x)", term: "What It Can Hold", explanation: "Tensions the relationship can handle.", example: "New friendships cannot hold same weight as old ones." },
          { symbol: "âð½", term: "Breaking Point", explanation: "Where relationship ends.", example: "Some things cannot be taken back." },
          { symbol: "d(y,âð½)", term: "Trust Buffer", explanation: "Goodwill that exists.", example: "You cannot spend trust you have not built." },
          { symbol: "C_Î", term: "Relational Coherence", explanation: "How well you understand each other.", example: "Long couples finish each other's sentences." },
          { symbol: "Î ", term: "Communication", explanation: "How you translate experience.", example: "Most fights are translation failures." }
        ],
        failures: [
          { title: "Accumulated Resentment", description: "Small issues stuffed down." },
          { title: "Model Obsolescence", description: "You know who they were, not are." }
        ]
      },
      everyday: {
        context: { title: "For Everyday Life", description: "You are just trying to live and make decisions." },
        bigIdea: "A good life is staying far enough from catastrophe that you can enjoy what you have.",
        concepts: [
          { symbol: "ð½(t,x)", term: "Your Options", explanation: "What you can actually do.", example: "With savings, you can quit bad job." },
          { symbol: "âð½", term: "Where Things Fall Apart", explanation: "Bankruptcy, health crisis, relationship collapse.", example: "Most do not think about edges until close." },
          { symbol: "d(y,âð½)", term: "Life Buffer", explanation: "Emergency fund, insurance, skills, health.", example: "Boring advice is about building margin." },
          { symbol: "C_Î", term: "Life Coherence", explanation: "How well pieces fit together.", example: "Burnout often comes from incoherence." },
          { symbol: "Î ", term: "Your Story", explanation: "How you make sense of your life.", example: "Depression involves foreclosing possibility." }
        ],
        failures: [
          { title: "Lifestyle Creep", description: "Expenses rising with income, margin constant." },
          { title: "The Drift", description: "Small compromises adding up." }
        ]
      }
    };
    
    fieldItems.forEach(item => {
      item.addEventListener('click', () => {
        const field = item.dataset.field;
        
        fieldItems.forEach(i => i.classList.remove('selected'));
        item.classList.add('selected');
        fieldSelected.textContent = item.textContent;
        
        dropdownOpen = false;
        fieldTrigger.classList.remove('open');
        fieldMenu.classList.remove('open');
        
        const t = translations[field];
        placeholder.style.display = 'none';
        
        let html = `
          <div class="field-context">
            <h2>${t.context.title}</h2>
            <p>${t.context.description}</p>
          </div>
          <div class="big-idea">
            <h3>The Core Insight</h3>
            <p>${t.bigIdea}</p>
          </div>
          <h3 style="color: var(--gray-lighter); margin: 2.5rem 0 1.2rem; font-weight: 400;">Key Concepts</h3>
        `;
        
        t.concepts.forEach(c => {
          html += `
            <div class="concept-card">
              <div class="formal">
                <span class="symbol">${c.symbol}</span>
                <span class="arrow">â</span>
                <span class="translated-term">${c.term}</span>
              </div>
              <p class="explanation">${c.explanation}</p>
              <div class="example"><strong>Example</strong> ${c.example}</div>
            </div>
          `;
        });
        
        html += `<div class="failure-modes"><h3>Failure Patterns</h3>`;
        t.failures.forEach(f => {
          html += `
            <div class="failure-card">
              <h4>${f.title}</h4>
              <p>${f.description}</p>
            </div>
          `;
        });
        html += `</div>`;
        
        translationContainer.innerHTML = html;
        translationContainer.classList.remove('visible');
        setTimeout(() => translationContainer.classList.add('visible'), 50);
      });
    });
    
    // ============ LAB ACCESS CONTROL ============
    // Keys and names are SHA-256 hashed for obfuscation
    // To add a new key: echo -n "YOUR_KEY" | shasum -a 256
    // Names are encoded: btoa(firstName + '|' + lastName)
    const validKeyData = [
      { hash: 'ccea55a3332ba42e92385a86eb1112d9dd89550d54a62e6be696a13538e39c2c', name: 'RGVtb3xBbHBoYQ==' },   // DEMO-ALPHA-2026
      { hash: '6974cd7d586ce9398a2cc7a78eae2676d5c5333949f3d4087cb9be5238690f40', name: 'RGVtb3xCZXRh' },     // DEMO-BETA-2026
      { hash: 'd6dd5dd3982533f2df1f1e9ae290d02453d0eb387eb60927866564800081b1b5', name: 'RGVtb3xHYW1tYQ==' },   // DEMO-GAMMA-2026
      { hash: '11d339caecfb097c5e8161120e85f46697285f738ca65fbc5a3cb31cc8dbe1b1', name: 'RGVtb3xEZWx0YQ==' },   // DEMO-DELTA-2026
      { hash: '3ed499260a1ccb90ffdc6c0aadc05b57f61bea680d7c9f04ef0304544fe79971', name: 'RGVtb3xPbWVnYQ==' }    // DEMO-OMEGA-2026
    ];
    
    async function hashKey(key) {
      const encoder = new TextEncoder();
      const data = encoder.encode(key.toUpperCase().trim());
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }
    
    function decodeName(encoded) {
      try {
        const decoded = atob(encoded);
        const [first, last] = decoded.split('|');
        return { first, last, full: `${first} ${last}` };
      } catch {
        return { first: 'User', last: '', full: 'Authorized User' };
      }
    }
    
    const labGate = document.getElementById('lab-gate');
    const labContent = document.getElementById('lab-content');
    const labKeyInput = document.getElementById('lab-key-input');
    const labKeySubmit = document.getElementById('lab-key-submit');
    const keyError = document.getElementById('key-error');
    const labLogout = document.getElementById('lab-logout');
    
    // Demo banner
    const demoBanner = document.getElementById('demo-banner');
    const demoBannerLink = document.getElementById('demo-banner-link');
    
    // Disclaimer elements
    const keyPrompt = document.getElementById('key-prompt');
    const disclaimerPrompt = document.getElementById('disclaimer-prompt');
    const disclaimerScroll = document.getElementById('disclaimer-scroll');
    const acceptCheckbox = document.getElementById('accept-checkbox');
    const nameConfirmInput = document.getElementById('name-confirm-input');
    const acceptBtn = document.getElementById('accept-btn');
    const acceptBtnText = document.getElementById('accept-btn-text');
    const userFullNameDisplay = document.getElementById('user-full-name');
    
    let currentUserData = null;
    let disclaimerTimer = null;
    let countdownRemaining = 30;
    let hasScrolledToBottom = false;
    let checkboxChecked = false;
    
    // Demo banner click - navigate to lab
    demoBannerLink.addEventListener('click', (e) => {
      e.preventDefault();
      navigateTo('lab');
    });
    
    // Show/hide demo banner based on current page
    function updateDemoBanner() {
      if (currentPage === 'splash' || currentPage === 'lab') {
        demoBanner.classList.add('hidden');
      } else {
        demoBanner.classList.remove('hidden');
      }
    }
    
    // Check for existing session
    function checkSession() {
      const session = sessionStorage.getItem('lab_session');
      if (session) {
        labGate.classList.add('hidden');
        labContent.classList.add('visible');
      }
    }
    
    // Validate key - Step 1
    async function validateKey() {
      const key = labKeyInput.value;
      if (!key) {
        showError('Please enter a key');
        return;
      }
      
      const hash = await hashKey(key);
      const keyData = validKeyData.find(k => k.hash === hash);
      
      if (keyData) {
        currentUserData = decodeName(keyData.name);
        
        // Show disclaimer
        keyPrompt.classList.add('hidden');
        disclaimerPrompt.classList.remove('hidden');
        
        // Set user name in disclaimer
        userFullNameDisplay.textContent = currentUserData.full;
        
        // Start countdown
        startDisclaimerCountdown();
        
        keyError.classList.remove('visible');
      } else {
        showError('Invalid access key');
        labKeyInput.value = '';
      }
    }
    
    function startDisclaimerCountdown() {
      countdownRemaining = 30;
      hasScrolledToBottom = false;
      checkboxChecked = false;
      acceptCheckbox.classList.remove('checked');
      nameConfirmInput.value = '';
      updateAcceptButton();
      
      disclaimerTimer = setInterval(() => {
        countdownRemaining--;
        updateAcceptButton();
        
        if (countdownRemaining <= 0) {
          clearInterval(disclaimerTimer);
        }
      }, 1000);
    }
    
    // Track scrolling to bottom
    disclaimerScroll.addEventListener('scroll', () => {
      const scrollTop = disclaimerScroll.scrollTop;
      const scrollHeight = disclaimerScroll.scrollHeight;
      const clientHeight = disclaimerScroll.clientHeight;
      
      // Check if scrolled to bottom (within 20px)
      if (scrollTop + clientHeight >= scrollHeight - 20) {
        hasScrolledToBottom = true;
        updateAcceptButton();
      }
    });
    
    // Checkbox toggle
    acceptCheckbox.addEventListener('click', () => {
      if (countdownRemaining > 0 || !hasScrolledToBottom) return;
      
      checkboxChecked = !checkboxChecked;
      acceptCheckbox.classList.toggle('checked', checkboxChecked);
      updateAcceptButton();
    });
    
    // Name confirmation input
    nameConfirmInput.addEventListener('input', () => {
      updateAcceptButton();
    });
    
    function updateAcceptButton() {
      const nameMatches = nameConfirmInput.value.trim().toLowerCase() === currentUserData?.full.toLowerCase();
      const canAccept = countdownRemaining <= 0 && hasScrolledToBottom && checkboxChecked && nameMatches;
      
      acceptBtn.disabled = !canAccept;
      
      if (countdownRemaining > 0) {
        acceptBtnText.textContent = `Please scroll to read (${countdownRemaining}s)`;
      } else if (!hasScrolledToBottom) {
        acceptBtnText.textContent = 'Please scroll to the bottom';
      } else if (!checkboxChecked) {
        acceptBtnText.textContent = 'Please check the box above';
      } else if (!nameMatches) {
        acceptBtnText.textContent = 'Please type your full name';
      } else {
        acceptBtnText.textContent = 'Accept & Continue';
      }
    }
    
    // Accept button - complete access
    acceptBtn.addEventListener('click', () => {
      if (acceptBtn.disabled) return;
      
      sessionStorage.setItem('lab_session', JSON.stringify({
        timestamp: Date.now(),
        user: currentUserData.full
      }));
      
      labGate.classList.add('hidden');
      setTimeout(() => {
        labContent.classList.add('visible');
      }, 100);
      
      if (disclaimerTimer) clearInterval(disclaimerTimer);
    });
    
    function showError(msg) {
      keyError.textContent = msg;
      keyError.classList.add('visible');
      setTimeout(() => keyError.classList.remove('visible'), 3000);
    }
    
    labKeySubmit.addEventListener('click', validateKey);
    labKeyInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') validateKey();
    });
    
    // Logout
    labLogout.addEventListener('click', () => {
      sessionStorage.removeItem('lab_session');
      labContent.classList.remove('visible');
      labGate.classList.remove('hidden');
      
      // Reset to key prompt
      keyPrompt.classList.remove('hidden');
      disclaimerPrompt.classList.add('hidden');
      labKeyInput.value = '';
      
      if (disclaimerTimer) clearInterval(disclaimerTimer);
      currentUserData = null;
    });
    
    // Check session on page load
    checkSession();
    
    // ============ PURE JS RCOT PROTOTYPE ============
    // No Pyodide - works on all devices including iOS
    
    let rcotSystem = null;
    let isInitialized = false;
    
    // RCOT System Class - Pure JavaScript
    class RCOTSystem {
      constructor() {
        this.state = {};
        this.history = [];
        this.t = 0;
      }
      
      parseNaturalLanguage(text) {
        const parsed = {};
        const textLower = text.toLowerCase();
        
        // Currency/money patterns
        const moneyPatterns = [
          { regex: /\$(\d[\d,]*)\s*k?\s*(?:runway|budget|funds|capital|reserves?)/i, key: 'resources' },
          { regex: /\$(\d[\d,]*)\s*k?\s*(?:monthly|per month|\/month)\s*(?:burn|spend|cost)/i, key: 'burn_rate' },
          { regex: /(?:burn|spend|cost)[^$]*\$(\d[\d,]*)\s*k?/i, key: 'burn_rate' },
          { regex: /(?:reserve|emergency|minimum|floor)[^$]*\$(\d[\d,]*)\s*k?/i, key: 'min_reserve' },
          { regex: /\$(\d[\d,]*)\s*k?[^$]*(?:reserve|emergency|minimum|floor)/i, key: 'min_reserve' },
        ];
        
        for (const { regex, key } of moneyPatterns) {
          if (parsed[key]) continue;
          const match = text.match(regex);
          if (match) {
            let val = parseFloat(match[1].replace(/,/g, ''));
            if (match[0].toLowerCase().includes('k')) val *= 1000;
            // Auto-detect if value seems too small (likely in thousands)
            if (val < 1000 && key === 'resources') val *= 1000;
            parsed[key] = val;
            parsed[key + '_source'] = match[0].substring(0, 50);
          }
        }
        
        // Percentage/rate patterns
        const ratePatterns = [
          { regex: /(?:increasing|growing|rising)[^%]*(\d+(?:\.\d+)?)\s*%/i, key: 'growth_rate', sign: 1 },
          { regex: /(\d+(?:\.\d+)?)\s*%[^%]*(?:increase|growth|rise)/i, key: 'growth_rate', sign: 1 },
          { regex: /(?:decreasing|declining|falling)[^%]*(\d+(?:\.\d+)?)\s*%/i, key: 'decline_rate', sign: -1 },
        ];
        
        for (const { regex, key, sign } of ratePatterns) {
          if (parsed[key]) continue;
          const match = text.match(regex);
          if (match) {
            parsed[key] = parseFloat(match[1]) * sign / 100;
            parsed[key + '_source'] = match[0].substring(0, 50);
          }
        }
        
        // Coherence patterns (qualitative)
        const coherenceKeywords = {
          'excellent': 0.95, 'great': 0.9, 'good': 0.8, 'solid': 0.75,
          'okay': 0.6, 'moderate': 0.6, 'fair': 0.5,
          'poor': 0.35, 'bad': 0.25, 'terrible': 0.1, 'failing': 0.1
        };
        
        const coherenceMatch = text.match(/(?:coherence|alignment|coordination|teamwork|morale)[^.]*?(?:is|are)?\s*(\w+)/i);
        if (coherenceMatch) {
          const word = coherenceMatch[1].toLowerCase();
          if (coherenceKeywords[word]) {
            parsed.coherence = coherenceKeywords[word];
            parsed.coherence_source = coherenceMatch[0].substring(0, 50);
          }
        }
        
        // Coherence trend
        if (/(?:coherence|alignment|team)[^.]*(?:declining|decreasing|worsening|dropping)/i.test(text)) {
          parsed.coherence_trend = -0.02;
          parsed.coherence_trend_source = 'declining';
        } else if (/(?:coherence|alignment|team)[^.]*(?:improving|increasing|growing|rising)/i.test(text)) {
          parsed.coherence_trend = 0.02;
          parsed.coherence_trend_source = 'improving';
        } else if (/(?:coherence|alignment|team)[^.]*(?:stable|steady|constant)/i.test(text)) {
          parsed.coherence_trend = 0;
          parsed.coherence_trend_source = 'stable';
        }
        
        // Time horizon
        const timeMatch = text.match(/(\d+)\s*(?:months?|periods?|quarters?|years?)/i);
        if (timeMatch) {
          let val = parseInt(timeMatch[1]);
          const unit = timeMatch[0].toLowerCase();
          if (unit.includes('year')) val *= 12;
          else if (unit.includes('quarter')) val *= 3;
          parsed.time_horizon = val;
          parsed.time_horizon_source = timeMatch[0];
        }
        
        // Set defaults
        if (!parsed.resources) parsed.resources = 100000;
        if (!parsed.burn_rate) parsed.burn_rate = 10000;
        if (!parsed.min_reserve) parsed.min_reserve = parsed.resources * 0.1;
        if (!parsed.coherence) parsed.coherence = 0.7;
        if (!parsed.coherence_trend) parsed.coherence_trend = 0;
        if (!parsed.growth_rate) parsed.growth_rate = 0;
        if (!parsed.time_horizon) parsed.time_horizon = 12;
        
        return parsed;
      }
      
      initialize(parsed) {
        this.state = {
          resources: parsed.resources,
          burn_rate: parsed.burn_rate,
          min_reserve: parsed.min_reserve,
          coherence: parsed.coherence,
          coherence_trend: parsed.coherence_trend || 0,
          growth_rate: parsed.growth_rate || 0,
          time_horizon: parsed.time_horizon || 12,
          initial_resources: parsed.resources
        };
        this.t = 0;
        this.history = [this.getSnapshot()];
        return this.state;
      }
      
      getSnapshot() {
        return {
          t: this.t,
          resources: this.state.resources,
          burn_rate: this.state.burn_rate,
          coherence: this.state.coherence,
          margin: this.computeMargin(),
          ttb: this.computeTTB()
        };
      }
      
      computeMargin() {
        const available = this.state.resources - this.state.min_reserve;
        const maxPossible = this.state.initial_resources;
        return Math.max(0, Math.min(1, available / maxPossible));
      }
      
      computeTTB() {
        if (this.state.burn_rate <= 0) return Infinity;
        
        let resources = this.state.resources;
        let burn = this.state.burn_rate;
        const growth = this.state.growth_rate;
        const reserve = this.state.min_reserve;
        
        for (let t = 1; t <= 120; t++) {
          burn = burn * (1 + growth);
          resources = resources - burn;
          if (resources <= reserve) return t;
        }
        return 120;
      }
      
      step() {
        this.t += 1;
        
        // Update burn rate with growth
        this.state.burn_rate *= (1 + this.state.growth_rate);
        
        // Consume resources
        this.state.resources -= this.state.burn_rate;
        
        // Update coherence
        this.state.coherence += this.state.coherence_trend;
        this.state.coherence = Math.max(0.05, Math.min(1, this.state.coherence));
        
        // Record history
        this.history.push(this.getSnapshot());
        
        return this.getSnapshot();
      }
      
      computeMetrics() {
        const margin = this.computeMargin();
        const ttb = this.computeTTB();
        const coherence = this.state.coherence;
        const trend = this.state.coherence_trend;
        
        const marginStatus = margin > 0.4 ? 'good' : (margin > 0.2 ? 'warning' : 'danger');
        const ttbStatus = ttb > 6 ? 'good' : (ttb > 3 ? 'warning' : 'danger');
        const coherenceStatus = coherence > 0.7 ? 'good' : (coherence > 0.4 ? 'warning' : 'danger');
        const trendStatus = trend > 0 ? 'good' : (trend === 0 ? 'warning' : 'danger');
        
        return {
          margin: Math.round(margin * 1000) / 1000,
          margin_status: marginStatus,
          ttb: ttb < 120 ? Math.round(ttb * 10) / 10 : 'â',
          ttb_status: ttbStatus,
          coherence: Math.round(coherence * 1000) / 1000,
          coherence_status: coherenceStatus,
          trend: Math.round(trend * 10000) / 10000,
          trend_status: trendStatus
        };
      }
      
      generateAnalysis() {
        const m = this.computeMetrics();
        const analysis = [];
        
        // Margin analysis
        if (m.margin_status === 'danger') {
          analysis.push(`<span class='danger'>Critical:</span> Your system is operating dangerously close to the failure boundary with only <strong>${Math.round(m.margin * 100)}%</strong> margin.`);
        } else if (m.margin_status === 'warning') {
          analysis.push(`<span class='warning'>Caution:</span> Your boundary margin of <strong>${Math.round(m.margin * 100)}%</strong> provides limited buffer for unexpected shocks.`);
        } else {
          analysis.push(`Your boundary margin of <strong>${Math.round(m.margin * 100)}%</strong> provides healthy distance from failure conditions.`);
        }
        
        // TTB analysis
        if (m.ttb === 'â') {
          analysis.push(`At current trajectory, you have <strong>indefinite runway</strong> â resources exceed consumption.`);
        } else if (m.ttb <= 3) {
          analysis.push(`<span class='danger'>Urgent:</span> At current burn rate, you will cross the failure boundary in approximately <strong>${m.ttb}</strong> periods.`);
        } else if (m.ttb <= 6) {
          analysis.push(`<span class='warning'>Warning:</span> Time to boundary is <strong>${m.ttb}</strong> periods â intervention window is narrowing.`);
        } else {
          analysis.push(`Time to boundary is <strong>${m.ttb}</strong> periods, providing adequate planning horizon.`);
        }
        
        // Coherence analysis
        if (m.coherence_status === 'danger') {
          analysis.push(`<span class='danger'>System coherence is critically low</span> at <strong>${Math.round(m.coherence * 100)}%</strong>. Internal coordination is breaking down.`);
        } else if (m.coherence_status === 'warning') {
          analysis.push(`System coherence at <strong>${Math.round(m.coherence * 100)}%</strong> indicates moderate internal alignment challenges.`);
        } else {
          analysis.push(`System coherence of <strong>${Math.round(m.coherence * 100)}%</strong> indicates healthy internal alignment.`);
        }
        
        // Trend analysis
        if (m.trend < 0) {
          analysis.push(`<span class='warning'>Coherence is declining</span> at ${Math.abs(m.trend * 100).toFixed(1)}% per period â this compounds over time.`);
        } else if (m.trend > 0) {
          analysis.push(`Coherence is <strong>improving</strong> at ${(m.trend * 100).toFixed(1)}% per period â positive momentum.`);
        }
        
        return analysis.join(' ');
      }
      
      generateRecommendations() {
        const baseTTB = this.computeTTB();
        const recommendations = [];
        
        // Option 1: Reduce burn
        const rec1Burn = this.state.burn_rate * 0.8;
        const rec1TTB = this.simulateTTB(rec1Burn, this.state.growth_rate);
        recommendations.push({
          title: 'Reduce burn rate by 20%',
          impact: 'Extends runway by reducing resource consumption',
          new_ttb: rec1TTB,
          delta_ttb: baseTTB < 120 ? rec1TTB - baseTTB : 0
        });
        
        // Option 2: Halt growth in burn
        const rec2TTB = this.simulateTTB(this.state.burn_rate, 0);
        recommendations.push({
          title: 'Stabilize burn rate (stop growth)',
          impact: 'Prevents accelerating resource depletion',
          new_ttb: rec2TTB,
          delta_ttb: baseTTB < 120 ? rec2TTB - baseTTB : 0
        });
        
        // Option 3: Increase resources
        const rec3TTB = this.simulateTTBWithResources(this.state.resources * 1.5);
        recommendations.push({
          title: 'Increase resources by 50%',
          impact: 'Directly expands feasible region',
          new_ttb: rec3TTB,
          delta_ttb: baseTTB < 120 ? rec3TTB - baseTTB : 0
        });
        
        // Option 4: Improve coherence
        recommendations.push({
          title: 'Invest in coherence improvement',
          impact: 'Better coordination reduces waste and friction',
          new_ttb: baseTTB,
          delta_ttb: 0,
          coherence_delta: 0.15
        });
        
        return recommendations;
      }
      
      simulateTTB(burnRate, growthRate) {
        let resources = this.state.resources;
        let burn = burnRate;
        const reserve = this.state.min_reserve;
        
        for (let t = 1; t <= 120; t++) {
          burn = burn * (1 + growthRate);
          resources = resources - burn;
          if (resources <= reserve) return t;
        }
        return 120;
      }
      
      simulateTTBWithResources(resources) {
        let burn = this.state.burn_rate;
        const growth = this.state.growth_rate;
        const reserve = this.state.min_reserve;
        
        for (let t = 1; t <= 120; t++) {
          burn = burn * (1 + growth);
          resources = resources - burn;
          if (resources <= reserve) return t;
        }
        return 120;
      }
      
      getVisualizationData() {
        const maxR = this.state.initial_resources + this.state.min_reserve;
        return {
          current: {
            x: this.state.resources / maxR,
            y: this.state.coherence
          },
          boundary: {
            x: this.state.min_reserve / maxR
          },
          history: this.history.slice(-20).map(h => [
            h.resources / maxR,
            h.coherence
          ]),
          projected: this.projectTrajectory()
        };
      }
      
      projectTrajectory() {
        const points = [];
        let resources = this.state.resources;
        let burn = this.state.burn_rate;
        let coherence = this.state.coherence;
        const maxR = this.state.initial_resources + this.state.min_reserve;
        
        for (let t = 0; t < 12; t++) {
          burn *= (1 + this.state.growth_rate);
          resources -= burn;
          coherence += this.state.coherence_trend;
          coherence = Math.max(0.05, Math.min(1, coherence));
          
          if (resources > 0) {
            points.push([resources / maxR, coherence]);
          } else {
            break;
          }
        }
        
        return points;
      }
    }
    
    // Initialize system when lab content becomes visible
    function initRCOT() {
      const loadingEl = document.getElementById('pyodide-loading');
      const interfaceEl = document.getElementById('lab-interface');
      
      if (isInitialized) {
        loadingEl.classList.add('hidden');
        interfaceEl.classList.add('visible');
        return;
      }
      
      // Create RCOT system
      rcotSystem = new RCOTSystem();
      isInitialized = true;
      
      // Hide loading, show interface
      loadingEl.classList.add('hidden');
      interfaceEl.classList.add('visible');
    }
    
    // Watch for lab page activation
    const labObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.target.id === 'lab-page' && mutation.target.classList.contains('active')) {
          const labContent = document.getElementById('lab-content');
          if (labContent && labContent.classList.contains('visible')) {
            initRCOT();
          }
        }
      });
    });
    
    labObserver.observe(document.getElementById('lab-page'), { attributes: true, attributeFilter: ['class'] });
    
    // Also watch for lab content becoming visible (after disclaimer acceptance)
    const labContentObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.target.classList.contains('visible')) {
          initRCOT();
        }
      });
    });
    
    labContentObserver.observe(document.getElementById('lab-content'), { attributes: true, attributeFilter: ['class'] });
    
    // Phase elements
    const inputPhase = document.getElementById('input-phase');
    const generatingPhase = document.getElementById('generating-phase');
    const reportPhase = document.getElementById('report-phase');
    const progressFill = document.getElementById('progress-fill');
    const generatingTitle = document.getElementById('generating-title');
    const generatingStatus = document.getElementById('generating-status');
    
    // Loading messages - interpretability framing
    const loadingStages = [
      { title: 'Mapping feasible set', status: 'Enumerating admissible continuations...' },
      { title: 'Computing boundary', status: 'Calculating d(x, âð½) margin...' },
      { title: 'Tracing trajectory', status: 'Projecting state evolution...' },
      { title: 'Evaluating coherence', status: 'Measuring C_Î over window...' },
      { title: 'Rendering interpretation', status: 'Generating human-readable output...' }
    ];
    
    // Analyze button handler - reads from structured form inputs
    document.getElementById('analyze-btn').addEventListener('click', () => {
      if (!rcotSystem) return;
      
      // Read values from structured inputs
      const resources = parseFloat(document.getElementById('input-resources').value) || 100000;
      const burn_rate = parseFloat(document.getElementById('input-burn').value) || 10000;
      const growth_rate = (parseFloat(document.getElementById('input-growth').value) || 0) / 100;
      const min_reserve = parseFloat(document.getElementById('input-reserve').value) || resources * 0.1;
      const coherence = parseFloat(document.getElementById('input-coherence').value) || 0.7;
      const coherence_trend = parseFloat(document.getElementById('input-coherence-trend').value) || 0;
      
      const parsed = {
        resources, burn_rate, growth_rate, min_reserve, coherence, coherence_trend,
        time_horizon: 12
      };
      
      // Initialize system
      rcotSystem.initialize(parsed);
      
      // Transition to generating phase
      inputPhase.classList.add('hidden');
      generatingPhase.classList.remove('hidden');
      
      // Scroll to top
      document.getElementById('lab-content').scrollTo({ top: 0, behavior: 'smooth' });
      
      // Animate loading sequence
      let stage = 0;
      let progress = 0;
      
      const loadingInterval = setInterval(() => {
        progress += 2;
        progressFill.style.width = Math.min(progress, 100) + '%';
        
        // Update stage text
        const currentStage = Math.min(Math.floor(progress / 22), loadingStages.length - 1);
        if (currentStage !== stage) {
          stage = currentStage;
          generatingTitle.textContent = loadingStages[stage].title;
          generatingStatus.textContent = loadingStages[stage].status;
        }
        
        if (progress >= 100) {
          clearInterval(loadingInterval);
          
          // Transition to report phase
          setTimeout(() => {
            generatingPhase.classList.add('hidden');
            reportPhase.classList.remove('hidden');
            
            // Populate report
            populateReport();
          }, 400);
        }
      }, 60);
    });
    
    function populateReport() {
      // Set timestamp
      const now = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('report-timestamp').textContent = 
        'Generated ' + now.toLocaleDateString('en-US', options);
      
      // Update metrics
      updateMetrics();
      
      // Update visualization
      updateVisualization();
      
      // Update analysis
      updateAnalysis();
      
      // Update recommendations
      updateRecommendations();
      
      // Update overall status
      const m = rcotSystem.computeMetrics();
      const overallStatus = document.getElementById('overall-status');
      let statusClass = 'good';
      let statusText = 'Healthy';
      
      if (m.margin_status === 'danger' || m.ttb_status === 'danger') {
        statusClass = 'danger';
        statusText = 'Critical';
      } else if (m.margin_status === 'warning' || m.ttb_status === 'warning') {
        statusClass = 'warning';
        statusText = 'Caution';
      }
      
      overallStatus.className = 'status-indicator ' + statusClass;
      overallStatus.querySelector('.status-label').textContent = statusText;
      
      // Populate executive summary
      document.getElementById('summary-content').innerHTML = rcotSystem.generateAnalysis();
    }
    
    // New analysis button
    document.getElementById('new-analysis-btn').addEventListener('click', () => {
      reportPhase.classList.add('hidden');
      inputPhase.classList.remove('hidden');
      progressFill.style.width = '0%';
      
      // Scroll to top
      document.getElementById('lab-content').scrollTo({ top: 0, behavior: 'smooth' });
    });
    
    // Visualization canvas
    const canvas = document.getElementById('grid-canvas');
    const ctx = canvas.getContext('2d');
    
    function updateVisualization() {
      if (!rcotSystem) return;
      
      const vizData = rcotSystem.getVisualizationData();
      
      // Clear canvas
      ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      const padding = 40;
      const w = canvas.width - padding * 2;
      const h = canvas.height - padding * 2;
      
      // Draw axes
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, canvas.height - padding);
      ctx.lineTo(canvas.width - padding, canvas.height - padding);
      ctx.stroke();
      
      // Axis labels
      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
      ctx.font = '11px JetBrains Mono, monospace';
      ctx.fillText('Resources â', canvas.width / 2, canvas.height - 10);
      ctx.save();
      ctx.translate(12, canvas.height / 2);
      ctx.rotate(-Math.PI / 2);
      ctx.fillText('Coherence â', 0, 0);
      ctx.restore();
      
      // Draw safe zone (high margin area)
      ctx.fillStyle = 'rgba(255, 103, 0, 0.08)';
      ctx.fillRect(
        padding + vizData.boundary.x * w + w * 0.3,
        padding,
        w * 0.6,
        h
      );
      
      // Draw failure boundary
      ctx.strokeStyle = '#ef4444';
      ctx.lineWidth = 2;
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      const boundaryX = padding + vizData.boundary.x * w;
      ctx.moveTo(boundaryX, padding);
      ctx.lineTo(boundaryX, canvas.height - padding);
      ctx.stroke();
      ctx.setLineDash([]);
      
      // Draw projected trajectory
      if (vizData.projected.length > 1) {
        ctx.strokeStyle = 'rgba(136, 136, 136, 0.6)';
        ctx.lineWidth = 2;
        ctx.setLineDash([3, 3]);
        ctx.beginPath();
        vizData.projected.forEach((p, i) => {
          const x = padding + p[0] * w;
          const y = canvas.height - padding - p[1] * h;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.stroke();
        ctx.setLineDash([]);
      }
      
      // Draw history trail
      if (vizData.history.length > 1) {
        ctx.strokeStyle = 'rgba(255, 103, 0, 0.4)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        vizData.history.forEach((p, i) => {
          const x = padding + p[0] * w;
          const y = canvas.height - padding - p[1] * h;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.stroke();
      }
      
      // Draw current state
      const cx = padding + vizData.current.x * w;
      const cy = canvas.height - padding - vizData.current.y * h;
      
      // Glow
      ctx.shadowColor = '#ff6700';
      ctx.shadowBlur = 15;
      ctx.fillStyle = '#ff6700';
      ctx.beginPath();
      ctx.arc(cx, cy, 8, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;
      
      // Update time display
      document.getElementById('time-display').textContent = `t = ${rcotSystem.t}`;
    }
    
    function updateMetrics() {
      if (!rcotSystem) return;
      
      const m = rcotSystem.computeMetrics();
      
      // TTB tile
      const ttbTile = document.getElementById('tile-ttb');
      const ttbEl = document.getElementById('metric-ttb');
      ttbEl.textContent = m.ttb;
      ttbTile.className = 'metric-tile ' + m.ttb_status;
      
      // Margin tile
      const marginTile = document.getElementById('tile-margin');
      const marginEl = document.getElementById('metric-margin');
      marginEl.textContent = (m.margin * 100).toFixed(0) + '%';
      marginTile.className = 'metric-tile ' + m.margin_status;
      
      // Coherence tile
      const cohTile = document.getElementById('tile-coherence');
      const cohEl = document.getElementById('metric-coherence');
      cohEl.textContent = (m.coherence * 100).toFixed(0) + '%';
      cohTile.className = 'metric-tile ' + m.coherence_status;
      
      // Trend tile
      const trendTile = document.getElementById('tile-trend');
      const trendEl = document.getElementById('metric-trend');
      trendEl.textContent = (m.trend >= 0 ? '+' : '') + (m.trend * 100).toFixed(1) + '%';
      trendTile.className = 'metric-tile ' + m.trend_status;
    }
    
    function updateAnalysis() {
      if (!rcotSystem) return;
      document.getElementById('nl-output').innerHTML = rcotSystem.generateAnalysis();
    }
    
    function updateRecommendations() {
      if (!rcotSystem) return;
      
      const recos = rcotSystem.generateRecommendations();
      const container = document.getElementById('recommendations');
      let html = '';
      
      recos.forEach((r, i) => {
        const deltaTTB = r.delta_ttb || 0;
        const deltaClass = deltaTTB > 0 ? 'positive' : (deltaTTB < 0 ? 'negative' : '');
        const deltaStr = deltaTTB > 0 ? `+${Math.round(deltaTTB)}mo` : (deltaTTB < 0 ? `${Math.round(deltaTTB)}mo` : 'â');
        
        html += `
          <div class="reco-item" data-index="${i}">
            <div class="reco-item-content">
              <div class="reco-item-title">${r.title}</div>
              <div class="reco-item-impact">${r.impact}</div>
            </div>
            <div class="reco-item-delta ${deltaClass}">${deltaStr}</div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }
    
    // Step/Play/Reset controls
    document.getElementById('step-btn').addEventListener('click', () => {
      if (!rcotSystem) return;
      rcotSystem.step();
      updateVisualization();
      updateMetrics();
      updateAnalysis();
    });
    
    let playing = false;
    document.getElementById('play-btn').addEventListener('click', () => {
      if (!rcotSystem) return;
      
      const btn = document.getElementById('play-btn');
      playing = !playing;
      btn.innerHTML = playing ? '<span>â¸</span>' : '<span>â¶â¶</span>';
      
      if (playing) {
        playLoop();
      }
    });
    
    function playLoop() {
      if (!playing || !rcotSystem) return;
      
      rcotSystem.step();
      updateVisualization();
      updateMetrics();
      updateAnalysis();
      
      // Check if we've hit the boundary
      const margin = rcotSystem.computeMargin();
      if (margin <= 0) {
        playing = false;
        document.getElementById('play-btn').innerHTML = '<span>â¶â¶</span>';
        return;
      }
      
      setTimeout(playLoop, 500);
    }
    
    document.getElementById('reset-btn').addEventListener('click', () => {
      if (!rcotSystem) return;
      
      playing = false;
      document.getElementById('play-btn').innerHTML = '<span>â¶â¶</span>';
      
      // Re-read from structured inputs and reinitialize
      const resources = parseFloat(document.getElementById('input-resources').value) || 100000;
      const burn_rate = parseFloat(document.getElementById('input-burn').value) || 10000;
      const growth_rate = (parseFloat(document.getElementById('input-growth').value) || 0) / 100;
      const min_reserve = parseFloat(document.getElementById('input-reserve').value) || resources * 0.1;
      const coherence = parseFloat(document.getElementById('input-coherence').value) || 0.7;
      const coherence_trend = parseFloat(document.getElementById('input-coherence-trend').value) || 0;
      
      const parsed = {
        resources, burn_rate, growth_rate, min_reserve, coherence, coherence_trend,
        time_horizon: 12
      };
      
      rcotSystem.initialize(parsed);
      
      updateVisualization();
      updateMetrics();
      updateAnalysis();
    });
  </script>
</body>
</html>
