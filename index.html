<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>co³.one</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23000'/><text x='50%' y='58%' text-anchor='middle' font-family='Georgia,serif' font-size='14' font-style='italic' fill='%23ff6700'>Co³</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500;1,600&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --orange: #ff6700;
      --orange-dim: rgba(255, 103, 0, 0.7);
      --orange-glow: rgba(255, 103, 0, 0.15);
      --orange-subtle: rgba(255, 103, 0, 0.08);
      --black: #000;
      --near-black: #0a0a0a;
      --dark: #111;
      --dark-mid: #161616;
      --gray-dark: #1a1a1a;
      --gray-mid: #2a2a2a;
      --gray: #444;
      --gray-light: #666;
      --gray-lighter: #888;
      --gray-text: #999;
      --gray-pale: #aaa;
      --gray-bright: #ccc;
      --white: #fff;
      --font-display: 'Cormorant Garamond', Georgia, serif;
      --font-mono: 'JetBrains Mono', 'Courier New', monospace;
      --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-out-quart: cubic-bezier(0.25, 1, 0.5, 1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    ::selection {
      background: var(--orange);
      color: var(--black);
    }
    
    html {
      font-size: 16px;
    }
    
    body {
      background: var(--black);
      overflow-x: hidden;
      font-family: var(--font-display);
      font-weight: 400;
      color: var(--gray-bright);
      line-height: 1.85;
      letter-spacing: 0.01em;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    
    /* Transition overlay */
    #transition-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: transparent;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1.2s ease-in-out;
    }
    
    #transition-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    #transition-logo {
      font-family: var(--font-display);
      font-style: italic;
      font-weight: 300;
      font-size: clamp(80px, 20vmin, 200px);
      color: var(--orange);
      text-shadow: 
        0 0 80px rgba(255, 103, 0, 0.4),
        0 0 120px rgba(255, 103, 0, 0.2);
      transform: scaleY(1.3);
      letter-spacing: -0.03em;
      opacity: 0;
      transition: opacity 1.5s ease-in-out;
    }
    
    #transition-overlay.active #transition-logo {
      opacity: 1;
    }
    
    #transition-logo sup {
      font-size: 0.35em;
      vertical-align: super;
      margin-left: 0.1em;
      position: relative;
      top: -0.4em;
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--near-black);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--gray-mid);
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--gray);
    }
    
    /* Three.js container */
    #canvas-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 1;
      pointer-events: none;
      background: #000;
    }
    
    #canvas-container canvas {
      pointer-events: none;
    }
    
    /* Logo - splash screen */
    #logo-text {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scaleY(1.3);
      font-family: var(--font-display);
      font-style: italic;
      font-weight: 300;
      font-size: clamp(80px, 20vmin, 200px);
      color: var(--orange);
      text-shadow: 
        0 0 80px rgba(255, 103, 0, 0.4),
        0 0 120px rgba(255, 103, 0, 0.2);
      user-select: none;
      z-index: 200;
      line-height: 1;
      letter-spacing: -0.03em;
      cursor: pointer;
      transition: text-shadow 0.4s ease, opacity 2s ease-in-out, color 2s ease-in-out;
    }
    
    #logo-text:hover:not(.dimmed) {
      text-shadow: 
        0 0 60px rgba(255, 103, 0, 0.7),
        0 0 100px rgba(255, 103, 0, 0.5),
        0 0 160px rgba(255, 103, 0, 0.3);
    }
    
    #logo-ring,
    #logo-ring-mid,
    #logo-ring-outer {
      position: fixed;
      top: 50%;
      left: 50%;
      border-radius: 50%;
      pointer-events: none;
      box-sizing: border-box;
      opacity: 0;
    }
    
    #logo-ring {
      width: clamp(180px, 45vmin, 450px);
      height: clamp(180px, 45vmin, 450px);
      border: 1.5px solid rgba(255, 103, 0, 0.5);
      z-index: 199;
      animation: ringCascade 6s ease-in-out infinite;
    }
    
    #logo-ring-mid {
      width: clamp(180px, 45vmin, 450px);
      height: clamp(180px, 45vmin, 450px);
      border: 1.25px solid rgba(255, 103, 0, 0.35);
      z-index: 198;
      animation: ringCascade 6s ease-in-out infinite 2s;
    }
    
    #logo-ring-outer {
      width: clamp(180px, 45vmin, 450px);
      height: clamp(180px, 45vmin, 450px);
      border: 1px solid rgba(255, 103, 0, 0.2);
      z-index: 197;
      animation: ringCascade 6s ease-in-out infinite 4s;
    }
    
    #logo-ring.hidden,
    #logo-ring-mid.hidden,
    #logo-ring-outer.hidden {
      opacity: 0 !important;
      animation: none;
      transition: opacity 1s ease-in-out;
    }
    
    @keyframes ringCascade {
      0% {
        transform: translate(-50%, -50%) scale(0.6);
        opacity: 0;
      }
      10% {
        opacity: 0.5;
      }
      80% {
        opacity: 0.1;
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
      }
    }
    
    #logo-text.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    #logo-text.dimmed {
      opacity: 0.12;
      pointer-events: none;
      text-shadow: none;
      color: #444;
      transition: opacity 2s ease-in-out, color 2s ease-in-out, text-shadow 2s ease-in-out;
    }
    
    #logo-text sup {
      font-size: 0.35em;
      vertical-align: super;
      margin-left: 0.1em;
      position: relative;
      top: -0.4em;
    }
    
    /* Navigation */
    #nav {
      position: fixed;
      right: 0;
      top: 50%;
      transform: translateY(-50%) translateX(100%);
      z-index: 100;
      padding: 2rem 1.5rem 2rem 1rem;
      transition: transform 0.8s var(--ease-out-expo), opacity 0.8s ease;
    }
    
    #nav.visible {
      transform: translateY(-50%) translateX(0);
    }
    
    .nav-vertices {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      position: relative;
      align-items: flex-end;
    }
    
    .nav-vertex {
      display: flex;
      align-items: center;
      flex-direction: row-reverse;
      gap: 1rem;
      cursor: pointer;
      text-decoration: none;
      position: relative;
      opacity: 0;
      transform: translateX(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    
    .nav-vertex.revealed {
      opacity: 1;
      transform: translateX(0);
    }
    
    .vertex-node {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: rgba(255, 103, 0, 0.3);
      border: 1px solid rgba(255, 103, 0, 0.5);
      transition: all 0.5s ease;
      flex-shrink: 0;
    }
    
    .nav-vertex:hover .vertex-node {
      background: var(--orange);
      box-shadow: 0 0 10px var(--orange);
    }
    
    .nav-vertex.active .vertex-node {
      background: var(--orange);
      box-shadow: 0 0 12px var(--orange), 0 0 24px rgba(255, 103, 0, 0.4);
    }
    
    .vertex-label {
      font-family: var(--font-display);
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.5);
      transition: all 0.5s ease;
      white-space: nowrap;
    }
    
    .nav-vertex:hover .vertex-label {
      color: var(--white);
    }
    
    .nav-vertex.active .vertex-label {
      color: var(--orange);
    }
    
    .nav-vertex.nav-logo .vertex-node {
      display: none;
    }
    
    .nav-vertex.nav-logo .vertex-label {
      font-style: italic;
      font-weight: 300;
      font-size: 1.1rem;
      color: var(--orange);
      letter-spacing: -0.03em;
      border: 1px solid var(--orange);
      border-radius: 50%;
      width: 2.4rem;
      height: 2.4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.5s ease;
    }
    
    .nav-vertex.nav-logo:hover .vertex-label {
      box-shadow: 0 0 15px rgba(255, 103, 0, 0.4);
      background: rgba(255, 103, 0, 0.1);
    }
    
    .nav-vertex.nav-logo .vertex-label sup {
      font-size: 0.5em;
      vertical-align: super;
    }
    
    /* Page container */
    .page {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      z-index: 10;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1.4s ease-in-out;
      padding-top: 80px;
    }
    
    .page.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    .page-content {
      max-width: 860px;
      margin: 0 auto;
      padding: 3rem 6vw 6rem;
    }
    
    /* About page */
    #about-page .page-content {
      padding-top: 4rem;
    }
    
    #about-page h2 {
      font-size: clamp(1.1rem, 2.8vw, 1.6rem);
      color: var(--orange);
      font-style: italic;
      font-weight: 400;
      margin-bottom: 1.5rem;
      letter-spacing: -0.02em;
      line-height: 1.35;
    }
    
    #about-page p {
      margin-bottom: 1.2rem;
      font-size: 1.05rem;
      max-width: 620px;
      color: var(--gray-pale);
      line-height: 1.7;
    }
    
    #about-page a {
      color: var(--orange);
      text-decoration: none;
      border-bottom: none;
      transition: opacity 0.3s ease-in-out;
    }
    
    #about-page a:hover {
      opacity: 0.7;
    }
    
    /* CTA Buttons - Apple style */
    .cta-buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.8rem;
      margin: 2rem 0 1.5rem;
      width: 100%;
    }
    
    .cta-button {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.1rem 1.8rem;
      background: rgba(255, 103, 0, 0.1);
      border: none;
      border-radius: 14px;
      color: var(--orange);
      font-family: var(--font-display);
      font-size: 1.05rem;
      font-weight: 500;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      position: relative;
      overflow: hidden;
    }
    
    .cta-button:hover {
      background: rgba(255, 103, 0, 0.18);
      transform: scale(1.02);
    }
    
    .cta-button:active {
      transform: scale(0.98);
    }
    
    .cta-button .arrow {
      font-size: 1.2rem;
      transition: transform 0.3s ease-in-out;
      opacity: 0.7;
    }
    
    .cta-button:hover .arrow {
      transform: translateX(4px);
      opacity: 1;
    }
    
    /* Social links - Apple pill style */
    .social-links {
      display: flex;
      gap: 0.6rem;
      flex-wrap: wrap;
      margin: 1.5rem 0 1rem;
    }
    
    .social-link {
      font-size: 0.8rem;
      padding: 0.6rem 1.1rem;
      border: none;
      border-radius: 100px;
      background: rgba(255, 255, 255, 0.06);
      color: var(--gray-lighter);
      text-decoration: none;
      transition: all 0.3s ease-in-out;
      letter-spacing: 0.02em;
    }
    
    .social-link:hover {
      background: rgba(255, 103, 0, 0.15);
      color: var(--orange);
      transform: scale(1.03);
    }
    
    .social-link:active {
      transform: scale(0.97);
    }
    
    /* Contact form - Apple style */
    .contact-section {
      margin-top: 2rem;
      max-width: 420px;
    }
    
    #contact-page h2 {
      font-size: clamp(1.8rem, 4.5vw, 2.6rem);
      color: var(--orange);
      font-style: italic;
      font-weight: 400;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
      line-height: 1.25;
    }
    
    .contact-section h3 {
      font-size: 1.1rem;
      font-style: normal;
      font-weight: 500;
      color: var(--white);
      margin-bottom: 1.5rem;
      letter-spacing: 0.01em;
    }
    
    .form-group {
      margin-bottom: 1rem;
      position: relative;
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 1rem 1.2rem;
      background: rgba(255, 255, 255, 0.05);
      border: none;
      border-radius: 12px;
      color: var(--white);
      font-family: var(--font-display);
      font-size: 1rem;
      transition: all 0.3s ease-in-out;
      outline: none;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(255, 103, 0, 0.2);
    }
    
    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: var(--gray);
      font-style: normal;
    }
    
    .form-group textarea {
      resize: none;
      min-height: 120px;
    }
    
    #contact-form button {
      margin-top: 0.5rem;
      padding: 1rem 2rem;
      background: var(--orange);
      border: none;
      border-radius: 12px;
      color: var(--black);
      font-family: var(--font-display);
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    #contact-form button:hover {
      background: #ff7a1a;
      transform: scale(1.02);
    }
    
    #contact-form button:active {
      transform: scale(0.98);
    }
    
    /* Patent pending badge */
    .patent-badge {
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      color: var(--gray);
      font-size: 0.75rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      text-align: center;
    }
    
    .patent-badge a {
      color: var(--gray);
      text-decoration: none;
      border-bottom: none;
      transition: color 0.3s ease-in-out;
    }
    
    .patent-badge a:hover {
      color: var(--orange);
    }
    
    /* Theory page */
    #rcott-page h1 {
      font-size: clamp(1.6rem, 3.5vw, 2.4rem);
      color: var(--orange);
      font-style: italic;
      font-weight: 400;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
      line-height: 1.3;
    }
    
    #rcott-page .subtitle {
      color: var(--gray);
      margin-bottom: 1rem;
      font-size: 0.95rem;
    }
    
    #rcott-page .gating {
      font-family: var(--font-mono);
      font-size: 1rem;
      font-weight: 400;
      color: var(--orange);
      padding: 0.8rem 1.2rem;
      border: none;
      border-radius: 10px;
      display: inline-block;
      margin-bottom: 1rem;
      background: rgba(255, 103, 0, 0.1);
    }
    
    #rcott-page section {
      margin: 2rem 0;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    #rcott-page section:first-of-type {
      border-top: none;
      margin-top: 1rem;
      padding-top: 0;
    }
    
    #rcott-page h2 {
      font-size: 1.3rem;
      color: var(--orange);
      font-style: normal;
      font-weight: 500;
      margin-bottom: 1rem;
      letter-spacing: -0.01em;
    }
    
    #rcott-page h3 {
      font-size: 1.05rem;
      color: var(--white);
      font-weight: 500;
      margin: 1.2rem 0 0.6rem;
    }
    
    #rcott-page p {
      max-width: 680px;
      margin-bottom: 0.8rem;
      color: var(--gray-pale);
    }
    
    .math-block {
      background: rgba(255, 103, 0, 0.06);
      border: none;
      border-radius: 14px;
      padding: 1.8rem 2rem;
      margin: 2.5rem 0;
      font-family: var(--font-mono);
      font-size: 0.9rem;
      overflow-x: auto;
      line-height: 2.2;
    }
    
    .math-block .symbol {
      color: var(--orange);
    }
    
    .symbol-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 0.6rem;
      margin: 2rem 0;
    }
    
    .symbol-item {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      padding: 0.9rem 1.1rem;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 10px;
      transition: background 0.3s ease-in-out;
    }
    
    .symbol-item:hover {
      background: rgba(255, 255, 255, 0.06);
    }
    
    .symbol-item .sym {
      font-family: var(--font-mono);
      color: var(--orange);
      font-size: 0.9rem;
      min-width: 70px;
    }
    
    .symbol-item .def {
      color: var(--gray-pale);
      font-size: 0.9rem;
    }
    
    /* Invariant list - Apple toggle style */
    .invariant-list {
      margin: 2rem 0;
    }
    
    .invariant-item {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      padding: 1rem 1.2rem;
      margin: 0.5rem 0;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    .invariant-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .invariant-item .toggle {
      width: 48px;
      height: 28px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 14px;
      position: relative;
      transition: background 0.3s ease-in-out;
      flex-shrink: 0;
    }
    
    .invariant-item .toggle::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 22px;
      height: 22px;
      background: var(--white);
      border-radius: 50%;
      transition: all 0.3s ease-in-out;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .invariant-item.checked .toggle {
      background: var(--orange);
    }
    
    .invariant-item.checked .toggle::after {
      left: 23px;
    }
    
    .invariant-item .label {
      font-size: 0.95rem;
      color: var(--gray-bright);
    }
    
    .gate-result {
      font-family: var(--font-mono);
      font-size: 1rem;
      text-align: center;
      padding: 1.5rem;
      margin: 2.5rem 0;
      border: none;
      border-radius: 14px;
      transition: all 0.4s ease-in-out;
    }
    
    .gate-result.pass {
      background: rgba(255, 103, 0, 0.12);
      color: var(--orange);
    }
    
    .gate-result.fail {
      background: rgba(255, 255, 255, 0.05);
      color: var(--gray);
    }
    
    /* Domain selector - Apple segmented control style */
    .domain-selector {
      margin: 2.5rem 0 1.5rem;
    }
    
    .domain-pills {
      display: inline-flex;
      gap: 0;
      flex-wrap: wrap;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 4px;
    }
    
    .domain-pill {
      padding: 0.7rem 1.3rem;
      background: transparent;
      border: none;
      border-radius: 10px;
      color: var(--gray-lighter);
      font-family: var(--font-display);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    .domain-pill:hover {
      color: var(--white);
    }
    
    .domain-pill.active {
      background: rgba(255, 103, 0, 0.2);
      color: var(--orange);
    }
    
    .domain-content {
      display: none;
      padding: 1.8rem;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 16px;
      margin-top: 1rem;
    }
    
    .domain-content.active {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .domain-content h4 {
      color: var(--orange);
      font-weight: 500;
      font-style: normal;
      font-size: 1rem;
      margin-bottom: 1.2rem;
    }
    
    .domain-content table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .domain-content td {
      padding: 0.9rem 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 0.95rem;
      vertical-align: top;
    }
    
    .domain-content tr:last-child td {
      border-bottom: none;
    }
    
    .domain-content td:first-child {
      color: var(--orange);
      font-family: var(--font-mono);
      font-size: 0.85rem;
      width: 100px;
      padding-right: 1.5rem;
      opacity: 0.9;
    }
    
    /* Failure modes - Apple card style */
    .failure-modes {
      margin-top: 2rem;
    }
    
    .failure-item {
      padding: 1.3rem 1.5rem;
      background: rgba(255, 100, 100, 0.06);
      border: none;
      border-radius: 12px;
      margin-bottom: 0.6rem;
    }
    
    .failure-item h4 {
      color: #ff9999;
      font-weight: 500;
      font-size: 0.95rem;
      margin-bottom: 0.3rem;
    }
    
    .failure-item p {
      color: var(--gray-lighter);
      font-size: 0.9rem;
      margin: 0;
    }
    
    /* Patent page */
    #patent-page .page-content {
      padding-top: 4rem;
    }
    
    .patent-header {
      margin-bottom: 3rem;
    }
    
    .patent-header .label {
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--gray);
      margin-bottom: 0.8rem;
    }
    
    .patent-header h1 {
      font-size: clamp(1.5rem, 4vw, 2.2rem);
      color: var(--white);
      font-weight: 500;
      line-height: 1.35;
      margin-bottom: 2rem;
      max-width: 680px;
    }
    
    .patent-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 1rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 16px;
    }
    
    .patent-meta-item .key {
      font-size: 0.65rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--gray);
      margin-bottom: 0.3rem;
    }
    
    .patent-meta-item .value {
      font-family: var(--font-mono);
      font-size: 0.9rem;
      color: var(--orange);
    }
    
    .patent-section {
      margin: 3rem 0;
      padding-top: 2.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .patent-section h2 {
      font-size: 1.2rem;
      color: var(--orange);
      font-style: normal;
      font-weight: 500;
      margin-bottom: 1.5rem;
    }
    
    .patent-section h3 {
      font-size: 1rem;
      color: var(--white);
      font-weight: 500;
      margin: 1.8rem 0 0.8rem;
    }
    
    .patent-text {
      color: var(--gray-bright);
      line-height: 1.85;
      margin-bottom: 1.2rem;
    }
    
    /* Claims section */
    .claims-list {
      counter-reset: claim;
    }
    
    .claim-item {
      padding: 1.4rem;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 14px;
      margin-bottom: 0.6rem;
      position: relative;
      padding-left: 3.8rem;
    }
    
    .claim-item::before {
      counter-increment: claim;
      content: counter(claim) ".";
      position: absolute;
      left: 1.4rem;
      top: 1.4rem;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      color: var(--orange);
      opacity: 0.8;
    }
    
    .claim-item p {
      margin: 0;
      color: var(--gray-bright);
      line-height: 1.75;
    }
    
    .claim-item .dependent {
      color: var(--gray-lighter);
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    /* Patent notice and figures */
    .patent-notice {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      padding: 0.85rem 1.2rem;
      background: rgba(255, 255, 255, 0.04);
      border: none;
      border-radius: 10px;
      margin-bottom: 2.5rem;
      font-size: 0.8rem;
      color: var(--gray-lighter);
    }
    
    .patent-notice .notice-icon {
      color: var(--orange);
      font-size: 0.85rem;
    }
    
    /* Figures */
    .figure-full {
      margin: 2rem 0;
      padding: 1.8rem;
      background: rgba(255, 255, 255, 0.03);
      border: none;
      border-radius: 16px;
    }
    
    .figure-full .figure-label {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--orange);
      letter-spacing: 0.08em;
      margin-bottom: 0.25rem;
      opacity: 0.85;
    }
    
    .figure-full .figure-title {
      font-size: 0.95rem;
      color: var(--white);
      margin-bottom: 1.3rem;
      font-weight: 500;
    }
    
    .patent-figure {
      width: 100%;
      max-width: 100%;
      height: auto;
      margin-bottom: 1.3rem;
    }
    
    .figure-full .figure-desc {
      font-size: 0.85rem;
      color: var(--gray-lighter);
      font-style: normal;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    /* Claims - additional styles */
    .claim-item.claim-independent {
      background: rgba(255, 103, 0, 0.06);
    }
    
    .claim-item p {
      margin: 0 0 0.6rem 0;
    }
    
    .claim-item p:last-child {
      margin-bottom: 0;
    }
    
    .claim-element {
      padding-left: 1.2rem;
      color: var(--gray-pale) !important;
      font-size: 0.92rem;
    }
    
    /* Page link */
    .page-link {
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .page-link a {
      color: var(--orange);
      text-decoration: none;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: opacity 0.3s ease-in-out;
    }
    
    .page-link a:hover {
      opacity: 0.7;
    }
    
    /* Lab page - hidden/protected */
    .lab-gate {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 2rem 1rem;
      background: rgba(0, 0, 0, 0.97);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      z-index: 1000;
      overflow-y: auto;
    }
    
    .lab-gate.hidden {
      display: none;
    }
    
    /* Only show one prompt at a time */
    .lab-gate .lab-prompt,
    .lab-gate .disclaimer-prompt {
      position: absolute;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    
    .lab-gate .lab-prompt.hidden,
    .lab-gate .disclaimer-prompt.hidden {
      opacity: 0;
      pointer-events: none;
      transform: scale(0.95);
    }
    
    .lab-gate .lab-prompt:not(.hidden),
    .lab-gate .disclaimer-prompt:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
      transform: scale(1);
    }
    
    .lab-prompt {
      text-align: center;
      width: 100%;
      max-width: 400px;
      padding: 2.5rem 2rem;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 24px;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .lab-prompt#key-prompt {
      max-width: 380px;
    }
    
    .lab-prompt .lab-icon {
      font-size: 2.5rem;
      color: var(--orange);
      margin-bottom: 1.5rem;
      opacity: 0.9;
    }
    
    .lab-prompt h2 {
      font-size: 1.5rem;
      color: var(--white);
      font-weight: 600;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
    }
    
    .lab-prompt p {
      color: var(--gray);
      font-size: 0.95rem;
      margin-bottom: 2rem;
      line-height: 1.5;
    }
    
    .key-input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }
    
    .key-input-wrapper input {
      width: 100%;
      padding: 1rem 1.2rem;
      background: rgba(255, 255, 255, 0.06);
      border: none;
      border-radius: 14px;
      color: var(--white);
      font-family: var(--font-mono);
      font-size: 0.95rem;
      letter-spacing: 0.05em;
      outline: none;
      transition: all 0.3s ease-in-out;
      text-align: center;
    }
    
    .key-input-wrapper input:focus {
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 4px rgba(255, 103, 0, 0.15);
    }
    
    .key-input-wrapper input::placeholder {
      color: var(--gray);
      font-family: var(--font-display);
      letter-spacing: 0;
    }
    
    .key-input-wrapper button {
      width: 100%;
      padding: 1rem 1.5rem;
      background: var(--orange);
      border: none;
      border-radius: 14px;
      color: var(--black);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    .key-input-wrapper button:hover {
      background: #ff7a1a;
      transform: scale(1.02);
    }
    
    .key-input-wrapper button:active {
      transform: scale(0.98);
    }
    
    .key-error {
      margin-top: 1rem;
      color: #ff6b6b;
      font-size: 0.85rem;
      min-height: 1.2em;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    
    .key-error.visible {
      opacity: 1;
    }
    
    /* Disclaimer styles - Apple aesthetic - unified card */
    .disclaimer-prompt {
      width: calc(100% - 2rem);
      max-width: 500px;
      padding: 2rem;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 24px;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      margin: 1rem;
      box-sizing: border-box;
    }
    
    .disclaimer-prompt.hidden {
      display: none;
    }
    
    .disclaimer-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    
    .disclaimer-header .lab-icon {
      font-size: 1.8rem;
      color: var(--orange);
      margin-bottom: 1rem;
      opacity: 0.9;
    }
    
    .disclaimer-header h2 {
      font-size: 1.4rem;
      color: var(--white);
      font-weight: 600;
      margin-bottom: 0.4rem;
      letter-spacing: -0.02em;
    }
    
    .disclaimer-header p {
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    .disclaimer-scroll {
      height: 280px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 16px;
      margin-bottom: 1.2rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
      -webkit-overflow-scrolling: touch;
    }
    
    .disclaimer-scroll::-webkit-scrollbar {
      width: 6px;
    }
    
    .disclaimer-scroll::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .disclaimer-scroll::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 3px;
    }
    
    .disclaimer-scroll::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.25);
    }
    
    .disclaimer-content {
      padding: 1.5rem;
      font-size: 0.8rem;
      line-height: 1.75;
      color: var(--gray-pale);
    }
    
    .disclaimer-content h3 {
      font-size: 0.95rem;
      color: var(--white);
      font-weight: 600;
      margin-bottom: 0.4rem;
      text-align: center;
      letter-spacing: -0.01em;
    }
    
    .disclaimer-content .disclaimer-date {
      text-align: center;
      color: var(--gray);
      font-size: 0.75rem;
      margin-bottom: 1.5rem;
    }
    
    .disclaimer-content h4 {
      font-size: 0.85rem;
      color: var(--orange);
      font-weight: 600;
      margin: 1.5rem 0 0.8rem;
    }
    
    .disclaimer-content p {
      margin-bottom: 0.8rem;
    }
    
    .disclaimer-content strong {
      color: var(--white);
      font-weight: 500;
    }
    
    .disclaimer-end-marker {
      text-align: center;
      padding: 2rem 0 0.5rem;
      color: var(--gray);
      font-size: 0.75rem;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      margin-top: 1.5rem;
    }
    
    .disclaimer-accept-section {
      padding: 0;
    }
    
    .accept-checkbox-wrapper {
      display: flex;
      align-items: flex-start;
      gap: 0.8rem;
      margin-bottom: 1rem;
      text-align: left;
    }
    
    .accept-checkbox {
      width: 24px;
      height: 24px;
      min-width: 24px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 7px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      margin-top: 2px;
    }
    
    .accept-checkbox .checkmark {
      color: var(--black);
      font-size: 0.9rem;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    
    .accept-checkbox.checked {
      background: var(--orange);
    }
    
    .accept-checkbox.checked .checkmark {
      opacity: 1;
    }
    
    .accept-checkbox-wrapper label {
      font-size: 0.85rem;
      color: var(--gray-lighter);
      line-height: 1.5;
      cursor: pointer;
    }
    
    .user-name-display {
      color: var(--orange);
      font-weight: 600;
    }
    
    .name-confirm-wrapper {
      margin-bottom: 1rem;
    }
    
    .name-confirm-wrapper input {
      width: 100%;
      padding: 0.9rem 1rem;
      background: rgba(255, 255, 255, 0.06);
      border: none;
      border-radius: 12px;
      color: var(--white);
      font-family: var(--font-display);
      font-size: 0.9rem;
      outline: none;
      transition: all 0.3s ease-in-out;
      text-align: center;
    }
    
    .name-confirm-wrapper input:focus {
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 3px rgba(255, 103, 0, 0.15);
    }
    
    .name-confirm-wrapper input::placeholder {
      color: var(--gray);
    }
    
    #accept-btn {
      width: 100%;
      padding: 1rem;
      font-size: 0.95rem;
      font-weight: 600;
      border-radius: 12px;
      letter-spacing: -0.01em;
      margin-top: 0;
    }
    
    #accept-btn:disabled {
      background: rgba(255, 255, 255, 0.06);
      color: var(--gray);
      cursor: not-allowed;
      transform: none;
    }
    
    #accept-btn:disabled:hover {
      background: rgba(255, 255, 255, 0.06);
      transform: none;
    }
    
    .lab-content {
      display: none;
      opacity: 0;
      transition: opacity 0.6s ease-in-out;
    }
    
    .lab-content.visible {
      display: block;
      opacity: 1;
    }
    
    /* Demo toggle - controlled by window.DEMO_ACTIVE */
    .demo-404, .demo-custom {
      display: none;
    }
    
    .demo-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 60vh;
      color: var(--gray);
      font-size: 1.1rem;
    }

    /* DVD-style Boundary Failure */
    .dvd-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #000;
      pointer-events: none;
    }
    
    #noise-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.15;
      pointer-events: none;
    }
    
    .dvd-logo {
      position: absolute;
      padding: 1.5rem 2.5rem;
      border-radius: 8px;
      transition: background-color 0.5s ease;
      pointer-events: none;
    }
    
    .dvd-text {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.2rem;
      text-shadow: 0 0 30px currentColor, 0 0 60px currentColor;
    }
    
    .dvd-boundary {
      font-family: var(--font-display);
      font-size: clamp(3rem, 10vw, 5rem);
      font-weight: 700;
      font-style: italic;
      letter-spacing: -0.02em;
    }
    
    .dvd-title {
      font-family: var(--font-body);
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      font-weight: 800;
      letter-spacing: 0.3em;
      text-transform: uppercase;
    }
    
    .dvd-subtitle {
      font-family: var(--font-body);
      font-size: clamp(0.8rem, 2.5vw, 1.2rem);
      font-weight: 600;
      letter-spacing: 0.5em;
      text-transform: uppercase;
      opacity: 0.8;
    }
    
    .dvd-exit-btn {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      opacity: 0.6;
      transition: opacity 0.3s ease;
      pointer-events: auto;
    }
    
    .dvd-exit-btn:hover {
      opacity: 1;
    }
    
    .lab-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.4rem;
      background: rgba(255, 103, 0, 0.08);
      border-radius: 12px;
      margin-bottom: 3rem;
    }
    
    .lab-status {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 0.85rem;
      color: var(--orange);
    }
    
    .lab-status .status-dot {
      width: 8px;
      height: 8px;
      background: var(--orange);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
    
    .lab-logout {
      padding: 0.5rem 1rem;
      background: rgba(255, 255, 255, 0.06);
      border: none;
      border-radius: 8px;
      color: var(--gray-lighter);
      font-family: var(--font-display);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    .lab-logout:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--white);
    }
    
    #lab-page h1 {
      font-size: clamp(1.6rem, 3.5vw, 2.2rem);
      color: var(--orange);
      font-style: italic;
      font-weight: 400;
      margin-bottom: 0.5rem;
    }
    
    .lab-intro {
      color: var(--gray);
      font-size: 1rem;
      margin-bottom: 3rem;
    }
    
    .lab-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 5rem 2rem;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 20px;
      border: 1px dashed rgba(255, 255, 255, 0.1);
    }
    
    .lab-placeholder .placeholder-icon {
      font-size: 2.5rem;
      color: var(--orange);
      opacity: 0.3;
      margin-bottom: 1rem;
    }
    
    .lab-placeholder p {
      color: var(--gray);
      font-size: 0.95rem;
    }
    
    /* Demo key banner */
    #demo-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 90;
      padding: 0.9rem 2rem;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(20px) saturate(150%);
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      border-top: 1px solid rgba(255, 255, 255, 0.04);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 1;
      transform: translateY(0);
      transition: all 0.6s ease-in-out;
    }
    
    #demo-banner.hidden {
      opacity: 0;
      transform: translateY(100%);
      pointer-events: none;
    }
    
    #demo-banner-link {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      color: var(--gray-lighter);
      font-size: 0.85rem;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      padding: 0.5rem 1rem;
      border-radius: 100px;
      background: rgba(255, 255, 255, 0.04);
    }
    
    #demo-banner-link:hover {
      color: var(--orange);
      background: rgba(255, 103, 0, 0.1);
    }
    
    #demo-banner-link .banner-icon {
      font-size: 0.9rem;
      opacity: 0.7;
    }
    
    #demo-banner-link .banner-arrow {
      font-size: 0.75rem;
      opacity: 0.5;
      transition: transform 0.3s ease-in-out;
    }
    
    #demo-banner-link:hover .banner-arrow {
      transform: translateX(3px);
      opacity: 1;
    }
    
    /* Pyodide loading */
    .pyodide-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
      color: var(--gray);
    }
    
    .pyodide-loading.hidden {
      display: none;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 103, 0, 0.2);
      border-top-color: var(--orange);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1.5rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Lab buttons */
    .lab-btn {
      padding: 0.9rem 1.8rem;
      background: rgba(255, 103, 0, 0.15);
      border: none;
      border-radius: 10px;
      color: var(--orange);
      font-family: var(--font-display);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      margin-top: 1rem;
    }
    
    .lab-btn:hover {
      background: rgba(255, 103, 0, 0.25);
      transform: scale(1.02);
    }
    
    .lab-btn:active {
      transform: scale(0.98);
    }
    
    .lab-btn.primary {
      background: var(--orange);
      color: var(--black);
    }
    
    .lab-btn.primary:hover {
      background: #ff7a1a;
    }
    
    .lab-btn.secondary {
      background: rgba(255, 255, 255, 0.08);
      color: var(--gray-lighter);
    }
    
    .lab-btn.small {
      padding: 0.6rem 1.2rem;
      font-size: 0.85rem;
      margin-top: 0;
      margin-right: 0.5rem;
    }
    
    /* Parsed variables */
    .parsed-section,
    .viz-section,
    .metrics-section,
    .output-section,
    .reco-section {
      margin-top: 2.5rem;
      padding-top: 2rem;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .parsed-section.hidden,
    .viz-section.hidden,
    .metrics-section.hidden,
    .output-section.hidden,
    .reco-section.hidden {
      display: none;
    }
    
    .parsed-section h3,
    .viz-section h3,
    .metrics-section h3,
    .output-section h3,
    .reco-section h3 {
      color: var(--orange);
      font-size: 1rem;
      font-weight: 500;
      margin-bottom: 1.2rem;
    }
    
    .parsed-vars {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 0.8rem;
      margin-bottom: 1rem;
    }
    
    .parsed-var {
      padding: 1rem 1.2rem;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 10px;
    }
    
    .parsed-var .var-name {
      font-family: var(--font-mono);
      font-size: 0.8rem;
      color: var(--orange);
      margin-bottom: 0.3rem;
    }
    
    .parsed-var .var-value {
      font-size: 1.1rem;
      color: var(--white);
      font-weight: 500;
    }
    
    .parsed-var .var-source {
      font-size: 0.75rem;
      color: var(--gray);
      margin-top: 0.3rem;
      font-style: italic;
    }
    
    /* Visualization */
    .viz-controls {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .time-display {
      font-family: var(--font-mono);
      font-size: 0.9rem;
      color: var(--orange);
      margin-left: 1rem;
    }
    
    #grid-canvas {
      width: 100%;
      max-width: 600px;
      height: auto;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .viz-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-top: 1rem;
      font-size: 0.8rem;
      color: var(--gray-lighter);
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .legend-item .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .legend-item .dot.current {
      background: var(--orange);
      box-shadow: 0 0 8px var(--orange);
    }
    
    .legend-item .dot.boundary {
      background: #ff4444;
    }
    
    .legend-item .dot.trajectory {
      background: #888;
    }
    
    .legend-item .dot.safe {
      background: rgba(255, 103, 0, 0.3);
    }
    
    /* Metrics grid */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
    }
    
    .metric-card {
      padding: 1.3rem;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 14px;
      text-align: center;
    }
    
    .metric-label {
      font-size: 0.75rem;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }
    
    .metric-value {
      font-family: var(--font-mono);
      font-size: 1.6rem;
      color: var(--orange);
      font-weight: 500;
    }
    
    .metric-value.warning {
      color: #ffaa00;
    }
    
    .metric-value.danger {
      color: #ff4444;
    }
    
    .metric-value.good {
      color: #44cc88;
    }
    
    .metric-unit {
      font-size: 0.7rem;
      color: var(--gray);
      font-family: var(--font-mono);
      margin-top: 0.3rem;
    }
    
    /* Natural language output */
    .nl-output {
      padding: 1.5rem;
      background: rgba(255, 103, 0, 0.06);
      border-radius: 14px;
      line-height: 1.8;
      color: var(--gray-pale);
    }
    
    .nl-output strong {
      color: var(--orange);
      font-weight: 500;
    }
    
    .nl-output .warning {
      color: #ffaa00;
    }
    
    .nl-output .danger {
      color: #ff4444;
    }
    
    /* Recommendations */
    .recommendations {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }
    
    .reco-card {
      padding: 1.2rem 1.4rem;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 12px;
      border-left: 3px solid var(--orange);
      cursor: pointer;
      transition: all 0.3s ease-in-out;
    }
    
    .reco-card:hover {
      background: rgba(255, 255, 255, 0.06);
      transform: translateX(4px);
    }
    
    .reco-card.selected {
      background: rgba(255, 103, 0, 0.1);
      border-left-color: #44cc88;
    }
    
    .reco-card .reco-title {
      font-weight: 500;
      color: var(--white);
      margin-bottom: 0.4rem;
    }
    
    .reco-card .reco-impact {
      font-size: 0.85rem;
      color: var(--gray-lighter);
    }
    
    .reco-card .reco-metrics {
      display: flex;
      gap: 1.5rem;
      margin-top: 0.8rem;
      font-family: var(--font-mono);
      font-size: 0.8rem;
    }
    
    .reco-card .reco-metrics span {
      color: var(--gray);
    }
    
    .reco-card .reco-metrics .better {
      color: #44cc88;
    }
    
    .reco-card .reco-metrics .worse {
      color: #ff6666;
    }

    /* Responsive */
    /* ============ RESPONSIVE DESIGN ============ */
    
    /* Large desktop (1200px+) */
    @media (min-width: 1200px) {
      .page-content {
        padding: 3rem 8vw 5rem;
        max-width: 1400px;
        margin: 0 auto;
      }
      
      #about-page h2 {
        font-size: 1.6rem;
      }
      
      .big-idea {
        padding: 3rem 4rem;
      }
      
      .disclaimer-scroll {
        height: 450px;
      }
    }
    
    /* Tablet and small desktop (768px - 1199px) */
    @media (max-width: 1199px) {
      .page-content {
        padding: 2.5rem 6vw 4rem;
      }
      
      .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .parsed-vars {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    /* Tablet (768px - 1023px) */
    @media (max-width: 1023px) {
      #nav {
        padding: 1.5rem 1rem 1.5rem 0.8rem;
      }
      
      .nav-vertices {
        gap: 1.5rem;
      }
      
      .vertex-label {
        font-size: 0.8rem;
      }
      
      .symbol-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .concept-card .formal {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .concept-card .arrow {
        display: none;
      }
      
      #grid-canvas {
        height: 300px;
      }
    }
    
    /* Mobile landscape and small tablet (576px - 767px) */
    @media (max-width: 767px) {
      :root {
        --font-scale: 0.95;
      }
      
      #nav {
        padding: 1rem 0.8rem 1rem 0.5rem;
      }
      
      .nav-vertices {
        gap: 1.2rem;
      }
      
      .vertex-label {
        font-size: 0.75rem;
      }
      
      .vertex-node {
        width: 4px;
        height: 4px;
      }
      
      .nav-vertex.nav-logo .vertex-label {
        width: 2rem;
        height: 2rem;
        font-size: 0.9rem;
      }
      
      .page-content {
        padding: 2rem 5vw 6rem;
      }
      
      #about-page h2 {
        font-size: 1.3rem;
      }
      
      #about-page p {
        font-size: 1rem;
      }
      
      .cta-button {
        padding: 1rem 1.4rem;
        font-size: 0.95rem;
      }
      
      .social-links {
        justify-content: center;
      }
      
      .symbol-grid {
        grid-template-columns: 1fr;
      }
      
      .domain-pills {
        flex-wrap: wrap;
        justify-content: flex-start;
      }
      
      .domain-pill {
        padding: 0.6rem 1rem;
        font-size: 0.85rem;
      }
      
      .math-block {
        padding: 1.2rem 1rem;
        font-size: 0.8rem;
        line-height: 2;
      }
      
      .patent-meta {
        grid-template-columns: 1fr 1fr;
        padding: 1.2rem;
        gap: 1rem;
      }
      
      .figure-full {
        padding: 1.2rem;
      }
      
      .claim-item {
        padding: 1.2rem;
        padding-left: 3rem;
      }
      
      .claim-item::before {
        left: 1rem;
      }
      
      /* Lab page mobile */
      .lab-prompt {
        max-width: 100%;
        padding: 0 1rem;
      }
      
      .key-input-wrapper {
        flex-direction: column;
      }
      
      .key-input-wrapper button {
        padding: 1rem;
      }
      
      .disclaimer-prompt {
        width: calc(100% - 2rem);
        max-width: 100%;
        padding: 1.5rem;
        border-radius: 20px;
        margin: 0;
      }
      
      .disclaimer-scroll {
        height: 220px;
      }
      
      .disclaimer-content {
        padding: 1.2rem;
        font-size: 0.75rem;
      }
      
      .disclaimer-content h3 {
        font-size: 0.85rem;
      }
      
      .disclaimer-content h4 {
        font-size: 0.8rem;
      }
      
      .accept-checkbox-wrapper label {
        font-size: 0.8rem;
      }
      
      .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.6rem;
      }
      
      .metric-card {
        padding: 1rem;
      }
      
      .metric-value {
        font-size: 1.3rem;
      }
      
      .parsed-vars {
        grid-template-columns: 1fr;
      }
      
      .nl-input-section textarea {
        min-height: 100px;
        font-size: 0.95rem;
      }
      
      .viz-controls {
        flex-wrap: wrap;
      }
      
      .lab-btn.small {
        flex: 1;
        min-width: calc(50% - 0.5rem);
        text-align: center;
        justify-content: center;
      }
      
      .time-display {
        width: 100%;
        text-align: center;
        margin-top: 0.5rem;
        margin-left: 0;
      }
      
      #grid-canvas {
        height: 250px;
      }
      
      .viz-legend {
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
      }
      
      .nl-output {
        padding: 1.2rem;
        font-size: 0.9rem;
      }
      
      .reco-card {
        padding: 1rem 1.2rem;
      }
      
      .reco-card .reco-metrics {
        flex-direction: column;
        gap: 0.3rem;
      }
      
      /* Demo banner mobile */
      #demo-banner {
        padding: 0.8rem 1rem;
      }
      
      #demo-banner-link {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
      }
      
      /* Contact form mobile */
      .contact-section {
        max-width: 100%;
      }
      
      /* Field selector mobile */
      .field-dropdown {
        max-width: 100%;
      }
      
      .big-idea {
        padding: 1.8rem 1.5rem;
      }
      
      .big-idea p {
        font-size: 1rem;
      }
    }
    
    /* Mobile portrait (max 575px) */
    @media (max-width: 575px) {
      #nav {
        padding: 0.8rem 0.5rem 0.8rem 0.3rem;
        top: auto;
        bottom: 1rem;
        right: 0;
        transform: translateY(0) translateX(100%);
      }
      
      #nav.visible {
        transform: translateY(0) translateX(0);
      }
      
      .nav-vertices {
        gap: 0.8rem;
      }
      
      .vertex-label {
        font-size: 0.65rem;
      }
      
      .nav-vertex.nav-logo .vertex-label {
        width: 1.8rem;
        height: 1.8rem;
        font-size: 0.8rem;
      }
      
      .page-content {
        padding: 1.5rem 4vw 5rem;
      }
      
      #about-page h2 {
        font-size: 1rem;
      }
      
      #rcott-page h1,
      #lab-page h1 {
        font-size: 1.4rem;
      }
      
      .patent-header h1 {
        font-size: 1.3rem;
      }
      
      .patent-meta {
        grid-template-columns: 1fr;
      }
      
      .patent-section h2 {
        font-size: 1.1rem;
      }
      
      .domain-pills {
        padding: 3px;
        border-radius: 10px;
      }
      
      .domain-pill {
        padding: 0.5rem 0.8rem;
        font-size: 0.8rem;
        border-radius: 8px;
      }
      
      .domain-content {
        padding: 1.2rem;
        border-radius: 12px;
      }
      
      .invariant-item {
        padding: 0.9rem 1rem;
        gap: 1rem;
      }
      
      .invariant-item .toggle {
        width: 42px;
        height: 26px;
      }
      
      .invariant-item .toggle::after {
        width: 20px;
        height: 20px;
      }
      
      .invariant-item.checked .toggle::after {
        left: 19px;
      }
      
      .invariant-item .label {
        font-size: 0.85rem;
      }
      
      .gate-result {
        padding: 1.2rem;
        font-size: 0.9rem;
      }
      
      /* Lab mobile small */
      .lab-prompt .lab-icon {
        font-size: 1.5rem;
      }
      
      .lab-prompt h2 {
        font-size: 1.2rem;
      }
      
      .lab-prompt p {
        font-size: 0.9rem;
      }
      
      .disclaimer-prompt {
        width: calc(100% - 1.5rem);
        max-width: 100%;
        padding: 1.2rem;
        border-radius: 18px;
        margin: 0;
      }
      
      .disclaimer-header .lab-icon {
        font-size: 1.4rem;
        margin-bottom: 0.8rem;
      }
      
      .disclaimer-header h2 {
        font-size: 1.15rem;
      }
      
      .disclaimer-header p {
        font-size: 0.85rem;
      }
      
      .disclaimer-scroll {
        height: 200px;
        border-radius: 12px;
      }
      
      .disclaimer-content {
        padding: 1rem;
        font-size: 0.7rem;
        line-height: 1.65;
      }
      
      .disclaimer-content h3 {
        font-size: 0.8rem;
      }
      
      .disclaimer-content h4 {
        font-size: 0.75rem;
        margin: 1.2rem 0 0.6rem;
      }
      
      .accept-checkbox-wrapper label {
        font-size: 0.75rem;
        line-height: 1.4;
      }
      
      .name-confirm-wrapper input {
        padding: 0.8rem;
        font-size: 0.85rem;
      }
      
      #accept-btn {
        font-size: 0.85rem;
        padding: 0.9rem;
      }
      
      .lab-header {
        flex-direction: column;
        gap: 0.8rem;
        padding: 1rem;
      }
      
      .lab-status {
        font-size: 0.8rem;
      }
      
      .lab-intro {
        font-size: 0.9rem;
      }
      
      /* Apple cards mobile */
      .apple-card {
        padding: 1.2rem;
        margin-bottom: 0.8rem;
        border-radius: 16px;
      }
      
      .step-indicator {
        width: 22px;
        height: 22px;
        font-size: 0.75rem;
        top: -10px;
        left: 16px;
      }
      
      .apple-card .section-header h3 {
        font-size: 1rem;
      }
      
      .apple-card .section-subtitle {
        font-size: 0.85rem;
      }
      
      .domain-selector {
        padding: 0.9rem 1rem;
        font-size: 0.9rem;
      }
      
      .user-input {
        min-height: 120px;
        font-size: 0.9rem;
        padding: 1rem;
      }
      
      .apple-btn {
        padding: 1rem 1.5rem;
        font-size: 1rem;
      }
      
      /* Constraint builder mobile */
      .constraint-input {
        padding: 0.9rem 1rem;
        font-size: 0.9rem;
      }
      
      .add-constraint-btn {
        width: 48px;
        height: 48px;
        font-size: 1.5rem;
      }
      
      .constraint-item {
        padding: 0.7rem 0.9rem;
      }
      
      .constraint-suggestions {
        flex-wrap: wrap;
      }
      
      .suggestion-chip {
        font-size: 0.75rem;
        padding: 0.35rem 0.7rem;
      }
      
      /* Report cards mobile */
      .plain-english-summary {
        padding: 1rem;
      }
      
      .plain-english-summary .status-emoji {
        font-size: 2.5rem;
      }
      
      .plain-english-summary .big-takeaway {
        font-size: 1.2rem;
      }
      
      .plain-english-summary .takeaway-detail {
        font-size: 0.9rem;
      }
      
      .geometry-summary {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .geometry-item {
        padding: 1rem 0.8rem;
      }
      
      .geometry-symbol {
        font-size: 1.1rem;
      }
      
      .details-toggle {
        font-size: 0.85rem;
        padding: 0.8rem;
      }
      
      .continuation-item {
        padding: 1rem;
      }
      
      .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }
      
      .metric-card {
        padding: 0.9rem 0.6rem;
        border-radius: 12px;
      }
      
      .metric-label {
        font-size: 0.65rem;
      }
      
      .metric-value {
        font-size: 1.2rem;
      }
      
      .metric-unit {
        font-size: 0.6rem;
      }
      
      #grid-canvas {
        height: 200px;
        border-radius: 12px;
      }
      
      .lab-btn {
        padding: 0.8rem 1.4rem;
        font-size: 0.9rem;
        border-radius: 10px;
      }
      
      .lab-btn.small {
        padding: 0.6rem 1rem;
        font-size: 0.8rem;
      }
      
      .concept-card {
        padding: 1.2rem;
        border-radius: 12px;
      }
      
      .failure-card,
      .failure-item {
        padding: 1rem 1.2rem;
        border-radius: 10px;
      }
    }
    
    /* Very small screens (max 374px) */
    @media (max-width: 374px) {
      .nav-vertices {
        gap: 0.6rem;
      }
      
      .vertex-label {
        font-size: 0.6rem;
      }
      
      .nav-vertex.nav-logo .vertex-label {
        width: 1.6rem;
        height: 1.6rem;
        font-size: 0.7rem;
      }
      
      .metrics-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .metric-card {
        padding: 0.8rem 0.5rem;
      }
      
      .metric-value {
        font-size: 1rem;
      }
    }
    
    /* Touch device optimizations */
    @media (hover: none) and (pointer: coarse) {
      .cta-button:hover,
      .social-link:hover,
      .domain-pill:hover,
      .lab-btn:hover,
      #demo-banner-link:hover {
        transform: none;
      }
      
      .cta-button:active,
      .social-link:active,
      .domain-pill:active,
      .lab-btn:active {
        transform: scale(0.98);
      }
      
      /* Larger touch targets */
      .domain-pill {
        min-height: 44px;
        display: flex;
        align-items: center;
      }
      
      .invariant-item {
        min-height: 48px;
      }
      
      #demo-banner-link {
        min-height: 44px;
      }
    }
    
    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* High contrast mode support */
    @media (prefers-contrast: high) {
      :root {
        --gray: #888;
        --gray-light: #aaa;
      }
      
      .key-input-wrapper input,
      .name-confirm-wrapper input,
      .form-group input,
      .form-group textarea,
      .nl-input-section textarea {
        border: 1px solid var(--gray);
      }
    }
    
    /* Dark mode is default, but ensure consistency */
    @media (prefers-color-scheme: light) {
      /* Site is dark-themed, maintain dark even in light mode preference */
    }
    
    /* Landscape orientation adjustments for mobile */
    @media (max-height: 500px) and (orientation: landscape) {
      .lab-gate {
        min-height: auto;
        padding: 1rem;
        padding-top: 1rem;
        align-items: flex-start;
      }
      
      .lab-prompt {
        padding: 1.5rem;
      }
      
      .disclaimer-prompt {
        width: calc(100% - 2rem);
        max-width: 100%;
        padding: 1rem;
        margin: 0;
      }
      
      .disclaimer-scroll {
        height: 150px;
      }
      
      .disclaimer-header {
        margin-bottom: 0.8rem;
      }
      
      .lab-prompt .lab-icon,
      .disclaimer-header .lab-icon {
        margin-bottom: 0.5rem;
        font-size: 1.2rem;
      }
      
      .lab-prompt h2,
      .disclaimer-header h2 {
        font-size: 1.1rem;
        margin-bottom: 0.3rem;
      }
      
      .lab-prompt p,
      .disclaimer-header p {
        margin-bottom: 1rem;
        font-size: 0.85rem;
      }
      
      .accept-checkbox-wrapper {
        margin-bottom: 0.8rem;
      }
      
      .name-confirm-wrapper {
        margin-bottom: 0.8rem;
      }
    }
    
    /* Safe area insets for notched devices */
    @supports (padding: max(0px)) {
      #nav {
        padding-left: max(1.2rem, env(safe-area-inset-left));
        padding-right: max(1.2rem, env(safe-area-inset-right));
      }
      
      #demo-banner {
        padding-bottom: max(0.9rem, env(safe-area-inset-bottom));
        padding-left: max(2rem, env(safe-area-inset-left));
        padding-right: max(2rem, env(safe-area-inset-right));
      }
      
      .page-content {
        padding-left: max(5vw, env(safe-area-inset-left));
        padding-right: max(5vw, env(safe-area-inset-right));
      }
    }
    
    /* ============ INTERACTIVE FORMULA VISUALIZATION ============ */
    .formula-explorer {
      margin: 1.5rem 0;
      padding: 1.5rem;
      background: rgba(255, 103, 0, 0.04);
      border-radius: 16px;
      border: 1px solid rgba(255, 103, 0, 0.1);
    }
    
    .formula-explorer-title {
      text-align: center;
      margin-bottom: 0.3rem;
    }
    
    .formula-explorer-title h3 {
      color: var(--orange);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin: 0;
    }
    
    .formula-explorer-subtitle {
      text-align: center;
      color: var(--gray);
      font-size: 0.85rem;
      margin-bottom: 1.2rem;
    }
    
    .formula-display {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.3rem;
      font-family: var(--font-mono);
      font-size: clamp(0.9rem, 2.5vw, 1.2rem);
      color: var(--gray-bright);
      margin-bottom: 1rem;
      line-height: 1.8;
    }
    
    .formula-var {
      padding: 0.2rem 0.5rem;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.5s ease-in-out;
      position: relative;
    }
    
    .formula-var:hover {
      transform: scale(1.1);
    }
    
    .formula-var.active {
      transform: scale(1.15);
      box-shadow: 0 0 20px currentColor;
    }
    
    .formula-var.var-F,
    .formula-var.var-dF,
    .formula-var.var-margin,
    .formula-var.var-C,
    .formula-var.var-Pi,
    .formula-var.var-fail { color: var(--orange); background: rgba(255, 103, 0, 0.15); }
    
    .formula-static {
      color: var(--gray-lighter);
    }
    
    .formula-panel {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: all 0.8s var(--ease-out-expo);
      margin-top: 0;
    }
    
    .formula-panel.open {
      max-height: 400px;
      opacity: 1;
      margin-top: 1rem;
    }
    
    .formula-panel-inner {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 12px;
      overflow: hidden;
    }
    
    .panel-nav {
      display: flex;
      gap: 0;
      padding: 3px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px 10px 0 0;
    }
    
    .panel-nav-item {
      flex: 1;
      padding: 0.5rem 0.6rem;
      background: transparent;
      border: none;
      border-radius: 6px;
      color: var(--gray-lighter);
      font-family: var(--font-display);
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.5s ease-in-out;
      text-align: center;
    }
    
    .panel-nav-item:hover {
      color: var(--white);
      background: rgba(255, 255, 255, 0.05);
    }
    
    .panel-nav-item.active {
      background: rgba(255, 103, 0, 0.2);
      color: var(--orange);
    }
    
    .panel-content {
      padding: 1rem;
      min-height: 150px;
    }
    
    .panel-domain {
      display: none;
      animation: panelFadeIn 0.7s ease-out;
    }
    
    .panel-domain.active {
      display: block;
    }
    
    @keyframes panelFadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .panel-domain-header {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 0.6rem;
    }
    
    .panel-domain-icon {
      font-size: 1.2rem;
      color: var(--orange);
      font-family: var(--font-mono);
      width: 1.3rem;
      text-align: center;
    }
    
    .panel-domain-title {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--white);
    }
    
    .panel-var-name {
      font-family: var(--font-mono);
      font-size: 0.85rem;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      display: inline-block;
      margin-bottom: 0.6rem;
    }
    
    .panel-var-name.var-F,
    .panel-var-name.var-dF,
    .panel-var-name.var-margin,
    .panel-var-name.var-C,
    .panel-var-name.var-Pi { color: var(--orange); background: rgba(255, 103, 0, 0.15); }
    
    .panel-interpretation {
      color: var(--gray-pale);
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 0.8rem;
    }
    
    .panel-question {
      background: rgba(255, 103, 0, 0.08);
      border-left: 3px solid var(--orange);
      padding: 0.7rem 1rem;
      border-radius: 0 8px 8px 0;
    }
    
    .panel-question-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--orange);
      margin-bottom: 0.3rem;
    }
    
    .panel-question-text {
      color: var(--white);
      font-size: 0.85rem;
      font-style: italic;
    }
    
    .panel-failure-item {
      margin-bottom: 0.6rem;
      padding: 0.6rem 0.8rem;
      background: rgba(255, 103, 0, 0.05);
      border-radius: 6px;
    }
    
    .panel-failure-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--orange);
      margin-bottom: 0.3rem;
      font-weight: 500;
    }
    
    .panel-failure-text {
      color: var(--gray-pale);
      font-size: 0.85rem;
      line-height: 1.5;
    }
    
    .panel-var-name.var-fail { 
      color: var(--orange); 
      background: rgba(255, 103, 0, 0.15); 
    }
    
    /* Collapsible Technical Details */
    .tech-details-toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.5rem 1rem;
      background: rgba(255, 103, 0, 0.15);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.5s ease-in-out;
      margin: 1rem 0 0;
      font-family: var(--font-display);
      color: var(--orange);
      font-size: 0.95rem;
    }
    
    .tech-details-toggle:hover {
      transform: scale(1.05);
      background: rgba(255, 103, 0, 0.25);
    }
    
    .tech-details-toggle.open {
      box-shadow: 0 0 20px rgba(255, 103, 0, 0.3);
    }
    
    .tech-details-toggle .chevron {
      font-size: 0.7rem;
      transition: transform 0.5s ease-in-out;
    }
    
    .tech-details-toggle.open .chevron {
      transform: rotate(90deg);
    }
    
    .tech-details-content {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: all 0.8s var(--ease-out-expo);
    }
    
    .tech-details-content.open {
      max-height: 2000px;
      opacity: 1;
      margin-top: 1rem;
    }
    
    .tech-details-content section {
      margin: 0 0 1.5rem;
      padding: 0;
      border-top: none;
    }
    
    .tech-details-content section:last-child {
      margin-bottom: 0;
    }
    
    .formula-disclaimer {
      text-align: center;
      margin-top: 1rem;
      padding: 0;
    }
    
    .formula-disclaimer p {
      font-size: 0.7rem;
      color: var(--gray-mid);
      margin: 0;
      line-height: 1.5;
      font-style: italic;
    }
    
    .formula-disclaimer a {
      color: var(--gray);
      text-decoration: underline;
    }
    
    @media (max-width: 767px) {
      .formula-explorer {
        padding: 1.5rem 1rem;
        margin: 2rem -1rem;
        border-radius: 0;
      }
      
      .formula-display {
        font-size: 0.85rem;
        gap: 0.2rem;
      }
      
      .formula-var {
        padding: 0.25rem 0.4rem;
      }
      
      .panel-nav-item {
        font-size: 0.65rem;
        padding: 0.5rem 0.3rem;
      }
      
      .panel-content {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- Transition overlay -->
  <div id="transition-overlay">
    <div id="transition-logo">Co<sup>3</sup></div>
  </div>
  
  <!-- Three.js background -->
  <div id="canvas-container"></div>
  
  <!-- Logo for splash -->
  <div id="logo-ring-outer"></div>
  <div id="logo-ring-mid"></div>
  <div id="logo-ring"></div>
  <div id="logo-text">Co<sup>3</sup></div>
  
  <!-- Lab Page (Hidden) -->
  <div id="lab-page" class="page">
    <div class="page-content">
      <div class="lab-gate" id="lab-gate">
        <!-- Step 1: Key Entry -->
        <div class="lab-prompt" id="key-prompt">
          <div class="lab-icon">◈</div>
          <h2>Private Access</h2>
          <p>This area requires authorization.</p>
          <div class="key-input-wrapper">
            <input type="text" id="lab-key-input" placeholder="Enter access key" autocomplete="off" spellcheck="false">
            <button id="lab-key-submit">→</button>
          </div>
          <div class="key-error" id="key-error"></div>
        </div>
        
        <!-- Step 2: Disclaimer -->
        <div class="disclaimer-prompt hidden" id="disclaimer-prompt">
          <div class="disclaimer-header">
            <div class="lab-icon">◈</div>
            <h2>Terms of Access</h2>
            <p>Please review and accept the following terms to continue.</p>
          </div>
          
          <div class="disclaimer-scroll" id="disclaimer-scroll">
            <div class="disclaimer-content">
              <h3>PROTOTYPE ACCESS AGREEMENT AND DISCLAIMER</h3>
              <p class="disclaimer-date">Effective Date: January 2026</p>
              
              <p>This Prototype Access Agreement and Disclaimer ("Agreement") is entered into by and between CO3 ONE LLC, an Arizona limited liability company ("Company," "we," "us," or "our"), and the individual accessing this prototype environment ("User," "you," or "your").</p>
              
              <p><strong>BY ACCESSING THIS PROTOTYPE, YOU ACKNOWLEDGE THAT YOU HAVE READ, UNDERSTOOD, AND AGREE TO BE BOUND BY THIS AGREEMENT. IF YOU DO NOT AGREE TO THESE TERMS, DO NOT ACCESS OR USE THIS PROTOTYPE.</strong></p>
              
              <h4>1. EXPERIMENTAL NATURE OF PROTOTYPE</h4>
              <p>1.1. The software, tools, demonstrations, and materials accessible through this portal (collectively, the "Prototype") are experimental, developmental, and provided solely for testing, evaluation, and demonstration purposes.</p>
              <p>1.2. The Prototype is provided "AS IS" and "AS AVAILABLE" without any warranties of any kind, whether express, implied, statutory, or otherwise, including but not limited to warranties of merchantability, fitness for a particular purpose, title, non-infringement, accuracy, reliability, or availability.</p>
              <p>1.3. The Prototype may contain errors, bugs, defects, or inaccuracies. Outputs, calculations, analyses, recommendations, or other results generated by the Prototype should not be relied upon for any purpose and do not constitute professional, legal, financial, medical, or other advice.</p>
              
              <h4>2. NO CONFIDENTIALITY OF USER INPUTS</h4>
              <p><strong>2.1. IMPORTANT NOTICE: ANY AND ALL INFORMATION, DATA, TEXT, OR OTHER CONTENT YOU ENTER INTO, SUBMIT TO, OR TRANSMIT THROUGH THIS PROTOTYPE ("USER INPUTS") IS NOT CONFIDENTIAL AND SHALL NOT BE TREATED AS CONFIDENTIAL BY THE COMPANY.</strong></p>
              <p>2.2. By submitting User Inputs, you acknowledge and agree that: (a) User Inputs may be stored, logged, analyzed, reviewed, or retained by the Company without limitation; (b) User Inputs may be used by the Company for any purpose, including but not limited to improving, developing, or training systems and models; (c) you have no expectation of privacy or confidentiality with respect to User Inputs; (d) you shall not submit any information that you consider confidential, proprietary, sensitive, or private.</p>
              <p>2.3. You represent and warrant that you have all necessary rights to submit User Inputs and that such submission does not violate any third-party rights, confidentiality obligations, or applicable laws.</p>
              
              <h4>3. INTELLECTUAL PROPERTY</h4>
              <p>3.1. The Prototype, including but not limited to its underlying code, algorithms, methodologies, frameworks, theories, documentation, and user interface (collectively, "Company IP"), is the exclusive property of the Company and is protected by intellectual property laws, including patent-pending technologies.</p>
              <p>3.2. This Agreement grants you a limited, non-exclusive, non-transferable, revocable license to access and use the Prototype solely for personal, non-commercial evaluation purposes during your authorized session.</p>
              <p>3.3. You shall not: (a) copy, reproduce, modify, or create derivative works of the Prototype or Company IP; (b) reverse engineer, decompile, disassemble, or attempt to derive source code; (c) sublicense, sell, distribute, or transfer access to the Prototype; (d) use the Prototype for any commercial purpose; (e) remove or alter any proprietary notices or markings.</p>
              
              <h4>4. LIMITATION OF LIABILITY</h4>
              <p><strong>4.1. TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, IN NO EVENT SHALL THE COMPANY, ITS MANAGERS, MEMBERS, EMPLOYEES, AGENTS, AFFILIATES, SUCCESSORS, OR ASSIGNS BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, PUNITIVE, OR EXEMPLARY DAMAGES, INCLUDING BUT NOT LIMITED TO DAMAGES FOR LOSS OF PROFITS, GOODWILL, USE, DATA, OR OTHER INTANGIBLE LOSSES, ARISING OUT OF OR RELATING TO YOUR ACCESS TO OR USE OF (OR INABILITY TO ACCESS OR USE) THE PROTOTYPE.</strong></p>
              <p><strong>4.2. TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, THE COMPANY'S TOTAL AGGREGATE LIABILITY ARISING OUT OF OR RELATING TO THIS AGREEMENT OR THE PROTOTYPE SHALL NOT EXCEED ONE HUNDRED UNITED STATES DOLLARS ($100.00).</strong></p>
              <p>4.3. THE LIMITATIONS IN THIS SECTION SHALL APPLY REGARDLESS OF THE THEORY OF LIABILITY, WHETHER BASED ON WARRANTY, CONTRACT, STATUTE, TORT (INCLUDING NEGLIGENCE), STRICT LIABILITY, OR ANY OTHER LEGAL OR EQUITABLE THEORY, AND WHETHER OR NOT THE COMPANY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p>
              
              <h4>5. INDEMNIFICATION</h4>
              <p>5.1. You agree to indemnify, defend, and hold harmless the Company and its managers, members, employees, agents, and affiliates from and against any and all claims, damages, losses, liabilities, costs, and expenses (including reasonable attorneys' fees) arising out of or relating to: (a) your access to or use of the Prototype; (b) your User Inputs; (c) your violation of this Agreement; (d) your violation of any rights of any third party.</p>
              
              <h4>6. ACCESS REVOCATION</h4>
              <p>6.1. Your access to the Prototype is granted at the sole discretion of the Company and may be revoked, suspended, or terminated at any time, for any reason or no reason, without notice or liability.</p>
              <p>6.2. The access key provided to you is personal and non-transferable. You shall not share, distribute, or disclose your access key to any third party.</p>
              
              <h4>7. GOVERNING LAW AND DISPUTE RESOLUTION</h4>
              <p>7.1. This Agreement shall be governed by and construed in accordance with the laws of the State of Arizona, without regard to its conflict of laws principles.</p>
              <p>7.2. Any dispute arising out of or relating to this Agreement or the Prototype shall be resolved exclusively in the state or federal courts located in Maricopa County, Arizona, and you consent to the personal jurisdiction of such courts.</p>
              <p>7.3. You waive any right to participate in a class action lawsuit or class-wide arbitration against the Company.</p>
              
              <h4>8. MISCELLANEOUS</h4>
              <p>8.1. This Agreement constitutes the entire agreement between you and the Company regarding the Prototype and supersedes all prior agreements and understandings.</p>
              <p>8.2. If any provision of this Agreement is found to be unenforceable, the remaining provisions shall continue in full force and effect.</p>
              <p>8.3. The Company's failure to enforce any right or provision of this Agreement shall not constitute a waiver of such right or provision.</p>
              <p>8.4. This Agreement may be modified by the Company at any time. Continued access to the Prototype following any modification constitutes acceptance of the modified terms.</p>
              
              <div class="disclaimer-end-marker">
                <span>— End of Agreement —</span>
              </div>
            </div>
          </div>
          
          <div class="disclaimer-accept-section">
            <div class="accept-checkbox-wrapper">
              <div class="accept-checkbox" id="accept-checkbox">
                <span class="checkmark">✓</span>
              </div>
              <label>I, <span id="user-full-name" class="user-name-display">[Authorized User]</span>, have read, understand, and agree to be bound by the terms of this Agreement.</label>
            </div>
            <div class="name-confirm-wrapper">
              <input type="text" id="name-confirm-input" placeholder="Type your full name to confirm" autocomplete="off" spellcheck="false">
            </div>
            <button id="accept-btn" class="lab-btn primary" disabled>
              <span id="accept-btn-text">Please scroll to read (10s)</span>
            </button>
          </div>
        </div>
      </div>
      
      <div class="lab-content" id="lab-content">
        
        <!-- ====== DEFAULT: 404 BOUNDARY FAILURE ====== -->
        <div class="demo-view demo-404" id="demo-404">
          <div class="dvd-container" id="dvd-container">
            <canvas id="noise-canvas"></canvas>
            <div class="dvd-logo" id="dvd-logo">
              <div class="dvd-text">
                <span class="dvd-boundary">∂ℱ</span>
                <span class="dvd-title">BOUNDARY</span>
                <span class="dvd-subtitle">FAILURE</span>
              </div>
            </div>
          </div>
          <button id="lab-logout" class="lab-btn secondary dvd-exit-btn">
            <span>Exit</span>
          </button>
        </div>

        <!-- ====== ALIGNMENT PHASE TRANSITION DEMO ====== -->
        <div class="demo-view demo-alignment" id="demo-alignment" style="display: none;">
          <style>
            .alignment-container {
              display: grid;
              grid-template-columns: 1fr 1fr 280px;
              grid-template-rows: auto 1fr auto;
              height: 100%;
              min-height: calc(100vh - 100px);
              gap: 1px;
              background: #222;
              font-family: 'JetBrains Mono', 'SF Mono', monospace;
              font-size: 12px;
            }
            .alignment-header {
              grid-column: 1 / -1;
              background: #0a0a0a;
              padding: 12px 20px;
              display: flex;
              justify-content: space-between;
              align-items: center;
              border-bottom: 1px solid #222;
            }
            .alignment-header-title {
              font-size: 11px;
              text-transform: uppercase;
              letter-spacing: 0.1em;
              color: #888;
            }
            .alignment-header-title span { color: var(--orange); }
            .alignment-header-patent {
              font-size: 10px;
              color: #444;
            }
            .alignment-panel {
              background: #0a0a0a;
              padding: 16px;
              display: flex;
              flex-direction: column;
            }
            .alignment-panel-title {
              font-size: 10px;
              text-transform: uppercase;
              letter-spacing: 0.08em;
              color: #888;
              margin-bottom: 12px;
              padding-bottom: 8px;
              border-bottom: 1px solid #222;
            }
            .alignment-canvas-wrap {
              flex: 1;
              position: relative;
              min-height: 300px;
            }
            .alignment-canvas-wrap canvas {
              width: 100%;
              height: 100%;
              background: #000;
              border-radius: 4px;
            }
            .alignment-metrics {
              display: flex;
              flex-direction: column;
              gap: 16px;
            }
            .alignment-metric-group {
              background: #000;
              border-radius: 4px;
              padding: 12px;
            }
            .alignment-metric-row {
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: 6px 0;
              border-bottom: 1px solid #151515;
            }
            .alignment-metric-row:last-child { border-bottom: none; }
            .alignment-metric-label {
              color: #888;
              font-size: 10px;
            }
            .alignment-metric-value {
              color: var(--orange);
              font-size: 14px;
              font-weight: 500;
            }
            .alignment-metric-value.danger { color: #ff3b3b; }
            .alignment-metric-value.warning { color: #ffaa00; }
            .alignment-metric-value.stable { color: #3bff6f; }
            .alignment-sparkline {
              height: 40px;
              background: #000;
              border-radius: 4px;
              padding: 8px;
              margin-top: 8px;
            }
            .alignment-status {
              background: #000;
              border-radius: 4px;
              padding: 16px;
              text-align: center;
            }
            .alignment-status-label {
              font-size: 10px;
              color: #888;
              margin-bottom: 8px;
              text-transform: uppercase;
              letter-spacing: 0.05em;
            }
            .alignment-status-value {
              font-size: 18px;
              font-weight: 600;
              letter-spacing: 0.05em;
            }
            .alignment-status-value.stable { color: #3bff6f; }
            .alignment-status-value.warning { color: #ffaa00; }
            .alignment-status-value.critical { 
              color: #ff3b3b; 
              animation: alignment-pulse 1s ease-in-out infinite;
            }
            @keyframes alignment-pulse {
              0%, 100% { opacity: 1; }
              50% { opacity: 0.5; }
            }
            .alignment-equations {
              background: #000;
              border-radius: 4px;
              padding: 12px;
              font-size: 10px;
              color: #888;
              line-height: 1.8;
            }
            .alignment-equations .eq { color: rgba(255, 103, 0, 0.6); }
            .alignment-controls {
              grid-column: 1 / -1;
              background: #0a0a0a;
              padding: 16px 20px;
              display: flex;
              gap: 32px;
              align-items: center;
              border-top: 1px solid #222;
              flex-wrap: wrap;
            }
            .alignment-control-group {
              display: flex;
              flex-direction: column;
              gap: 6px;
              flex: 1;
              min-width: 150px;
              max-width: 280px;
            }
            .alignment-control-label {
              font-size: 10px;
              color: #888;
              display: flex;
              justify-content: space-between;
            }
            .alignment-control-label span { color: var(--orange); }
            .alignment-control-sublabel {
              font-size: 9px;
              color: #555;
              margin-top: 4px;
              font-style: italic;
            }
            .alignment-container input[type="range"] {
              -webkit-appearance: none;
              width: 100%;
              height: 4px;
              background: #222;
              border-radius: 2px;
              outline: none;
            }
            .alignment-container input[type="range"]::-webkit-slider-thumb {
              -webkit-appearance: none;
              width: 14px;
              height: 14px;
              background: var(--orange);
              border-radius: 50%;
              cursor: pointer;
            }
            .alignment-btn-group {
              display: flex;
              gap: 8px;
            }
            .alignment-btn {
              padding: 8px 16px;
              background: #222;
              border: 1px solid #444;
              color: #888;
              font-family: 'JetBrains Mono', monospace;
              font-size: 11px;
              cursor: pointer;
              border-radius: 4px;
              transition: all 0.15s;
            }
            .alignment-btn:hover {
              background: #444;
              color: #eee;
            }
            .alignment-btn.primary {
              background: var(--orange);
              border-color: var(--orange);
              color: #000;
            }
            .alignment-btn.primary:hover { background: #ff8533; }
            .alignment-btn.active {
              background: rgba(255, 103, 0, 0.15);
              border-color: var(--orange);
              color: var(--orange);
            }
            .alignment-step-counter {
              font-size: 11px;
              color: #888;
              min-width: 100px;
              text-align: right;
            }
            .alignment-step-counter span {
              color: var(--orange);
              font-size: 14px;
            }
            .alignment-legend {
              display: flex;
              gap: 16px;
              font-size: 10px;
              color: #888;
              margin-top: auto;
              padding-top: 12px;
            }
            .alignment-legend-item {
              display: flex;
              align-items: center;
              gap: 6px;
            }
            .alignment-legend-dot {
              width: 8px;
              height: 8px;
              border-radius: 50%;
            }
            .alignment-legend-dot.current { background: var(--orange); box-shadow: 0 0 8px var(--orange); }
            .alignment-legend-dot.trajectory { background: #888; }
            .alignment-legend-dot.boundary { background: #ff3b3b; }
            .alignment-legend-dot.safe { background: rgba(59, 255, 111, 0.3); }
            .alignment-exit { margin-left: auto; }
            @media (max-width: 900px) {
              .alignment-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto auto;
              }
              .alignment-canvas-wrap { min-height: 250px; }
            }
          </style>

          <div class="alignment-container">
            <div class="alignment-header">
              <div class="alignment-header-title"><span>RCOT</span> Alignment Phase Transition</div>
              <div class="alignment-header-patent">Patent Pending · US App. 19/448,772</div>
            </div>

            <div class="alignment-panel">
              <div class="alignment-panel-title">State Space Trajectory</div>
              <div class="alignment-canvas-wrap">
                <canvas id="alignment-state-canvas"></canvas>
              </div>
              <div class="alignment-legend">
                <div class="alignment-legend-item"><div class="alignment-legend-dot current"></div>Current</div>
                <div class="alignment-legend-item"><div class="alignment-legend-dot trajectory"></div>History</div>
                <div class="alignment-legend-item"><div class="alignment-legend-dot boundary"></div>∂𝔽</div>
              </div>
            </div>

            <div class="alignment-panel">
              <div class="alignment-panel-title">Phase Diagram (ε, log C)</div>
              <div class="alignment-canvas-wrap">
                <canvas id="alignment-phase-canvas"></canvas>
              </div>
              <div class="alignment-legend">
                <div class="alignment-legend-item"><div class="alignment-legend-dot safe"></div>Aligned</div>
                <div class="alignment-legend-item"><div class="alignment-legend-dot" style="background: #ffaa00;"></div>Transition</div>
                <div class="alignment-legend-item"><div class="alignment-legend-dot" style="background: #ff3b3b;"></div>Failure</div>
              </div>
            </div>

            <div class="alignment-panel alignment-metrics">
              <div class="alignment-panel-title">RCOT Metrics</div>
              <div class="alignment-metric-group">
                <div class="alignment-metric-row">
                  <div class="alignment-metric-label">d(y, ∂𝔽)</div>
                  <div class="alignment-metric-value" id="alignment-metric-distance">0.847</div>
                </div>
                <div class="alignment-metric-row">
                  <div class="alignment-metric-label">C<sub>Δ</sub></div>
                  <div class="alignment-metric-value" id="alignment-metric-coherence">0.923</div>
                </div>
                <div class="alignment-metric-row">
                  <div class="alignment-metric-label">ĊC<sub>Δ</sub></div>
                  <div class="alignment-metric-value" id="alignment-metric-trend">+0.003</div>
                </div>
                <div class="alignment-metric-row">
                  <div class="alignment-metric-label">TTBC</div>
                  <div class="alignment-metric-value" id="alignment-metric-ttbc">∞</div>
                </div>
              </div>
              <div class="alignment-sparkline">
                <canvas id="alignment-sparkline-canvas"></canvas>
              </div>
              <div class="alignment-status">
                <div class="alignment-status-label">Prediction</div>
                <div class="alignment-status-value stable" id="alignment-status-value">STABLE</div>
              </div>
              <div class="alignment-equations">
                <div><span class="eq">π</span> = Π(argmin<sub>y∈𝔽</sub>[d(y,∂𝔽) − λC − μĊ])</div>
                <div style="margin-top: 8px;"><span class="eq">TTBC</span> ≈ d / |ḋ| when ḋ &lt; 0</div>
              </div>
            </div>

            <div class="alignment-controls">
              <div class="alignment-control-group">
                <div class="alignment-control-label">Reward Misspecification (ε) <span id="alignment-epsilon-value">0.15</span></div>
                <input type="range" id="alignment-epsilon-slider" min="0" max="100" value="15">
                <div class="alignment-control-sublabel">Gap between proxy reward and true objective</div>
              </div>
              <div class="alignment-control-group">
                <div class="alignment-control-label">Capability (log scale) <span id="alignment-capability-value">10<sup>9</sup></span></div>
                <input type="range" id="alignment-capability-slider" min="6" max="15" value="9" step="0.1">
                <div class="alignment-control-sublabel">Model parameters / optimization power</div>
              </div>
              <div class="alignment-control-group">
                <div class="alignment-control-label">KL Drift Rate (β) <span id="alignment-beta-value">0.20</span></div>
                <input type="range" id="alignment-beta-slider" min="1" max="100" value="20">
                <div class="alignment-control-sublabel">Training stochasticity / exploration noise</div>
              </div>
              <div class="alignment-btn-group">
                <button class="alignment-btn primary" id="alignment-btn-run">▶ Run</button>
                <button class="alignment-btn" id="alignment-btn-step">Step</button>
                <button class="alignment-btn" id="alignment-btn-reset">↻ Reset</button>
              </div>
              <div class="alignment-step-counter">Step <span id="alignment-step-count">0</span></div>
              <button id="lab-logout-alignment" class="alignment-btn alignment-exit">Exit</button>
            </div>
          </div>
        </div>

        <!-- ====== PROBATE DEADLINE TRACKER DEMO ====== -->
        <div class="demo-view demo-probate" id="demo-probate" style="display: none;">
          <style>
            /* ============================================
               RCOT PROBATE TRACKER - REORGANIZED LAYOUT
               Controls at top, graphs below
               ============================================ */
            
            .probate-container {
              display: flex;
              flex-direction: column;
              min-height: 100vh;
              background: #0a0a0a;
              font-family: 'JetBrains Mono', 'SF Mono', monospace;
              font-size: 12px;
              overflow-y: auto;
              -webkit-overflow-scrolling: touch;
            }
            
            .probate-header {
              background: #000;
              padding: 10px 16px;
              display: flex;
              justify-content: space-between;
              align-items: center;
              border-bottom: 1px solid #222;
              flex-wrap: wrap;
              gap: 8px;
            }
            
            .probate-header-title {
              font-size: 11px;
              text-transform: uppercase;
              letter-spacing: 0.1em;
              color: #888;
            }
            
            .probate-header-title span { color: var(--orange); }
            
            .probate-header-right {
              display: flex;
              align-items: center;
              gap: 12px;
            }
            
            .probate-header-patent {
              font-size: 9px;
              color: #444;
            }
            
            /* === INPUTS SECTION (TOP) === */
            .probate-inputs {
              background: #0d0d0d;
              padding: 12px 16px;
              border-bottom: 1px solid #222;
            }
            
            .probate-inputs-row {
              display: flex;
              flex-wrap: wrap;
              gap: 12px;
              align-items: flex-end;
            }
            
            .probate-input-group {
              display: flex;
              flex-direction: column;
              gap: 3px;
            }
            
            .probate-input-label {
              font-size: 9px;
              color: #666;
              text-transform: uppercase;
              letter-spacing: 0.05em;
            }
            
            .probate-input-label span { color: #555; }
            
            .probate-container input[type="date"],
            .probate-container select {
              background: #000;
              border: 1px solid #333;
              border-radius: 4px;
              padding: 6px 8px;
              color: #ccc;
              font-family: inherit;
              font-size: 11px;
              outline: none;
              min-width: 120px;
            }
            
            .probate-container input[type="date"]:focus,
            .probate-container select:focus {
              border-color: var(--orange);
            }
            
            .probate-container input[type="date"]::-webkit-calendar-picker-indicator {
              filter: invert(0.6);
              cursor: pointer;
            }
            
            .probate-container input[type="number"] {
              background: #000;
              border: 1px solid #333;
              border-radius: 4px;
              padding: 6px 8px;
              color: #ccc;
              font-family: inherit;
              font-size: 11px;
              outline: none;
              width: 50px;
            }
            
            .probate-btn {
              padding: 6px 12px;
              background: #222;
              border: 1px solid #444;
              color: #888;
              font-family: inherit;
              font-size: 10px;
              cursor: pointer;
              border-radius: 4px;
              transition: all 0.15s;
              white-space: nowrap;
            }
            
            .probate-btn:hover { background: #333; color: #ccc; }
            .probate-btn.primary { background: var(--orange); border-color: var(--orange); color: #000; font-weight: 500; }
            .probate-btn.primary:hover { background: #ff8533; }
            .probate-btn.small { padding: 4px 8px; font-size: 9px; }
            
            /* === COMPACT TOGGLES === */
            .probate-toggles-bar {
              background: #080808;
              padding: 10px 16px;
              border-bottom: 1px solid #222;
            }
            
            .probate-toggles-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 8px;
            }
            
            .probate-toggles-title {
              font-size: 9px;
              color: #666;
              text-transform: uppercase;
              letter-spacing: 0.05em;
            }
            
            .probate-toggles-legend {
              display: flex;
              gap: 10px;
              font-size: 8px;
              color: #555;
            }
            
            .probate-toggles-legend span { display: flex; align-items: center; gap: 3px; }
            .probate-toggles-legend .dot { width: 6px; height: 6px; border-radius: 50%; }
            .probate-toggles-legend .dot.met { background: #3bff6f; }
            .probate-toggles-legend .dot.upcoming { background: #ffaa00; }
            .probate-toggles-legend .dot.missed { background: #ff3b3b; }
            
            .probate-toggles-grid {
              display: flex;
              flex-wrap: wrap;
              gap: 6px;
            }
            
            .probate-chip {
              display: inline-flex;
              align-items: center;
              gap: 6px;
              background: #111;
              border: 1px solid #333;
              border-radius: 16px;
              padding: 4px 10px 4px 6px;
              cursor: pointer;
              transition: all 0.15s;
              font-size: 10px;
            }
            
            .probate-chip:hover { border-color: #555; }
            .probate-chip.met { border-color: #3bff6f; background: rgba(59,255,111,0.08); }
            .probate-chip.missed { border-color: #ff3b3b; background: rgba(255,59,59,0.08); }
            .probate-chip.upcoming { border-color: #ffaa00; }
            .probate-chip.past { border-color: #ff3b3b; opacity: 0.7; }
            
            .probate-chip-dot {
              width: 8px;
              height: 8px;
              border-radius: 50%;
              background: #555;
              flex-shrink: 0;
            }
            
            .probate-chip.met .probate-chip-dot { background: #3bff6f; }
            .probate-chip.missed .probate-chip-dot { background: #ff3b3b; }
            .probate-chip.upcoming .probate-chip-dot { background: #ffaa00; }
            .probate-chip.past .probate-chip-dot { background: #ff3b3b; }
            
            .probate-chip-name {
              color: #aaa;
              max-width: 140px;
              overflow: hidden;
              text-overflow: ellipsis;
              white-space: nowrap;
            }
            
            .probate-chip-days {
              font-size: 9px;
              color: #666;
              margin-left: 2px;
            }
            
            .probate-chip.met .probate-chip-days { color: #3bff6f; }
            .probate-chip.missed .probate-chip-days,
            .probate-chip.past .probate-chip-days { color: #ff3b3b; }
            .probate-chip.upcoming .probate-chip-days { color: #ffaa00; }
            
            .probate-no-deadlines {
              color: #555;
              font-size: 10px;
              padding: 4px 0;
            }
            
            /* === MAIN CONTENT GRID === */
            .probate-main {
              display: grid;
              grid-template-columns: 1fr 1fr 240px;
              gap: 1px;
              background: #222;
              flex: 1;
            }
            
            .probate-panel {
              background: #0a0a0a;
              padding: 12px;
              display: flex;
              flex-direction: column;
            }
            
            .probate-panel-title {
              font-size: 9px;
              text-transform: uppercase;
              letter-spacing: 0.08em;
              color: #666;
              margin-bottom: 8px;
              padding-bottom: 6px;
              border-bottom: 1px solid #1a1a1a;
            }
            
            .probate-canvas-wrap {
              flex: 1;
              position: relative;
              min-height: 320px;
              background: #000;
              border-radius: 4px;
              overflow: hidden;
            }
            
            .probate-canvas-wrap canvas {
              width: 100%;
              height: 100%;
            }
            
            /* Timeline tooltip */
            .probate-tooltip {
              position: absolute;
              background: #161616;
              border: 1px solid #444;
              border-radius: 8px;
              padding: 12px 16px;
              pointer-events: auto;
              opacity: 0;
              transition: opacity 0.15s;
              z-index: 100;
              max-width: 300px;
              min-width: 200px;
              box-shadow: 0 4px 24px rgba(0,0,0,0.6);
            }
            
            .probate-tooltip.visible { opacity: 1; }
            
            .probate-tooltip-title {
              font-size: 11px;
              font-weight: 500;
              margin-bottom: 6px;
              color: #ccc;
            }
            
            .probate-tooltip-date {
              font-size: 10px;
              color: var(--orange);
              margin-bottom: 4px;
            }
            
            .probate-tooltip-days {
              font-size: 10px;
              margin-bottom: 6px;
            }
            
            .probate-tooltip-days.past { color: #ff3b3b; }
            .probate-tooltip-days.soon { color: #ffaa00; }
            .probate-tooltip-days.future { color: #3bff6f; }
            
            .probate-tooltip-statute {
              font-size: 9px;
              color: #666;
              font-style: italic;
              margin-bottom: 6px;
            }
            
            .probate-tooltip-desc {
              font-size: 9px;
              color: #aaa;
              line-height: 1.4;
            }
            
            .probate-tooltip-status {
              display: inline-block;
              font-size: 9px;
              padding: 2px 6px;
              border-radius: 3px;
              margin-top: 6px;
            }
            
            .probate-tooltip-status.met { background: rgba(59, 255, 111, 0.2); color: #3bff6f; }
            .probate-tooltip-status.missed { background: rgba(255, 59, 59, 0.2); color: #ff3b3b; }
            .probate-tooltip-status.upcoming { background: rgba(255, 170, 0, 0.2); color: #ffaa00; }
            
            .probate-legend {
              display: flex;
              gap: 10px;
              font-size: 8px;
              color: #666;
              margin-top: 8px;
              flex-wrap: wrap;
            }
            
            .probate-legend-item {
              display: flex;
              align-items: center;
              gap: 4px;
            }
            
            .probate-legend-dot {
              width: 6px;
              height: 6px;
              border-radius: 50%;
            }
            
            .probate-legend-dot.current { background: var(--orange); }
            .probate-legend-dot.met { background: #3bff6f; }
            .probate-legend-dot.missed { background: #ff3b3b; }
            .probate-legend-dot.upcoming { background: #ffaa00; }
            .probate-legend-dot.trigger { background: #555; border: 1px solid #888; }
            
            /* Metrics panel */
            .probate-metrics {
              display: flex;
              flex-direction: column;
              gap: 8px;
            }
            
            .probate-metric-group {
              background: #000;
              border-radius: 4px;
              padding: 8px;
            }
            
            .probate-metric-row {
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: 5px 0;
              border-bottom: 1px solid #151515;
            }
            
            .probate-metric-row:last-child { border-bottom: none; }
            
            .probate-metric-label {
              color: #888;
              font-size: 9px;
            }
            
            .probate-metric-label .math {
              color: rgba(255, 103, 0, 0.7);
              font-style: italic;
            }
            
            .probate-metric-sublabel {
              font-size: 8px;
              color: #555;
              margin-top: 1px;
            }
            
            .probate-metric-value {
              color: var(--orange);
              font-size: 12px;
              font-weight: 500;
              text-align: right;
            }
            
            .probate-metric-value.danger { color: #ff3b3b; }
            .probate-metric-value.warning { color: #ffaa00; }
            .probate-metric-value.stable { color: #3bff6f; }
            
            .probate-status {
              background: #000;
              border-radius: 4px;
              padding: 10px;
              text-align: center;
            }
            
            .probate-status-label {
              font-size: 8px;
              color: #666;
              margin-bottom: 4px;
              text-transform: uppercase;
              letter-spacing: 0.05em;
            }
            
            .probate-status-value {
              font-size: 14px;
              font-weight: 600;
              letter-spacing: 0.05em;
            }
            
            .probate-status-value.stable { color: #3bff6f; }
            .probate-status-value.warning { color: #ffaa00; }
            .probate-status-value.critical { color: #ff3b3b; animation: probate-pulse 1s ease-in-out infinite; }
            
            @keyframes probate-pulse {
              0%, 100% { opacity: 1; }
              50% { opacity: 0.5; }
            }
            
            .probate-equations {
              background: #000;
              border-radius: 4px;
              padding: 8px;
              font-size: 8px;
              color: #555;
              line-height: 1.6;
            }
            
            .probate-equations .eq { color: rgba(255, 103, 0, 0.5); }
            
            /* Consequence cards */
            .probate-consequences {
              background: #0a0a0a;
              padding: 10px 16px;
              border-top: 1px solid #222;
            }
            
            .probate-consequences-title {
              font-size: 9px;
              text-transform: uppercase;
              letter-spacing: 0.05em;
              color: #666;
              margin-bottom: 8px;
            }
            
            .probate-consequences-cards {
              display: flex;
              gap: 8px;
              flex-wrap: wrap;
            }
            
            .probate-consequence-card {
              background: #000;
              border-radius: 4px;
              padding: 8px 12px;
              border-left: 3px solid #ff3b3b;
              flex: 1;
              min-width: 200px;
              max-width: 320px;
            }
            
            .probate-consequence-card.warning { border-left-color: #ffaa00; }
            
            .probate-consequence-card-title {
              font-size: 10px;
              color: #ff3b3b;
              font-weight: 500;
              margin-bottom: 3px;
            }
            
            .probate-consequence-card.warning .probate-consequence-card-title { color: #ffaa00; }
            
            .probate-consequence-card-text {
              font-size: 9px;
              color: #888;
              line-height: 1.4;
            }
            
            .probate-no-consequences {
              font-size: 10px;
              color: #3bff6f;
            }
            
            /* Footer */
            .probate-footer {
              background: #000;
              padding: 8px 16px;
              border-top: 1px solid #222;
              font-size: 8px;
              color: #444;
              text-align: center;
            }
            
            /* === RESPONSIVE === */
            @media (max-width: 900px) {
              .probate-main {
                grid-template-columns: 1fr 1fr;
              }
              .probate-panel:nth-child(3) {
                grid-column: 1 / -1;
              }
            }
            
            @media (max-width: 600px) {
              .probate-main {
                grid-template-columns: 1fr;
              }
              .probate-canvas-wrap { min-height: 320px; }
              .probate-inputs-row { gap: 8px; }
              .probate-input-group { flex: 1; min-width: 100px; }
              .probate-chip { padding: 3px 8px 3px 5px; font-size: 9px; }
              .probate-chip-name { max-width: 100px; }
            }
          </style>

          <div class="probate-container">
            <!-- Header -->
            <div class="probate-header">
              <div>
                <div class="probate-header-title"><span>RCOT</span> Arizona Probate Deadline Tracker</div>
              </div>
              <div class="probate-header-right">
                <span class="probate-header-patent">Patent Pending</span>
                <button id="lab-logout-probate" class="probate-btn small">Exit</button>
              </div>
            </div>
            
            <!-- Inputs Row -->
            <div class="probate-inputs">
              <div class="probate-inputs-row">
                <div class="probate-input-group">
                  <div class="probate-input-label">Date of Death</div>
                  <input type="date" id="probate-date-death">
                </div>
                <div class="probate-input-group">
                  <div class="probate-input-label">PR Appointment</div>
                  <input type="date" id="probate-date-appointment">
                </div>
                <div class="probate-input-group">
                  <div class="probate-input-label">Type</div>
                  <select id="probate-type">
                    <option value="informal">Informal</option>
                    <option value="formal">Formal</option>
                    <option value="supervised">Supervised</option>
                  </select>
                </div>
                <div class="probate-input-group">
                  <div class="probate-input-label">Publication <span>(opt)</span></div>
                  <input type="date" id="probate-date-publication">
                </div>
                <div class="probate-input-group">
                  <div class="probate-input-label">Creditor Mail <span>(opt)</span></div>
                  <input type="date" id="probate-date-creditor-mail">
                </div>
                <div class="probate-input-group" style="flex-direction: row; align-items: flex-end; gap: 6px;">
                  <select id="probate-extension-deadline" style="min-width: 100px;">
                    <option value="">+Extend...</option>
                    <option value="inventory">Inventory</option>
                    <option value="heir-notice">Heir Notice</option>
                    <option value="compliance">Compliance</option>
                  </select>
                  <input type="number" id="probate-extension-days" min="1" max="365" placeholder="30" style="width: 45px;">
                  <button class="probate-btn small" id="probate-btn-extension">+</button>
                </div>
                <div style="display: flex; gap: 6px; align-items: flex-end;">
                  <button class="probate-btn" id="probate-btn-reset">↻</button>
                  <button class="probate-btn primary" id="probate-btn-calculate">Calculate</button>
                </div>
                <div id="probate-extension-list" style="font-size: 8px; color: #3bff6f;"></div>
              </div>
            </div>
            
            <!-- Toggles Bar -->
            <div class="probate-toggles-bar">
              <div class="probate-toggles-header">
                <div class="probate-toggles-title">Deadline Status <span style="color:#555;">(tap to toggle met/missed)</span></div>
                <div class="probate-toggles-legend">
                  <span><div class="dot met"></div>Met</span>
                  <span><div class="dot upcoming"></div>Upcoming</span>
                  <span><div class="dot missed"></div>Missed</span>
                </div>
              </div>
              <div class="probate-toggles-grid" id="probate-toggles">
                <div class="probate-no-deadlines">Enter dates above and tap Calculate</div>
              </div>
            </div>
            
            <!-- Main Content: Graphs + Metrics -->
            <div class="probate-main">
              <!-- Timeline Panel -->
              <div class="probate-panel">
                <div class="probate-panel-title">Timeline</div>
                <div class="probate-canvas-wrap" id="probate-timeline-wrap">
                  <canvas id="probate-timeline-canvas"></canvas>
                  <div class="probate-tooltip" id="probate-tooltip">
                    <div class="probate-tooltip-title"></div>
                    <div class="probate-tooltip-date"></div>
                    <div class="probate-tooltip-days"></div>
                    <div class="probate-tooltip-statute"></div>
                    <div class="probate-tooltip-desc"></div>
                    <div class="probate-tooltip-status"></div>
                  </div>
                </div>
                <div class="probate-legend">
                  <div class="probate-legend-item"><div class="probate-legend-dot current"></div>Today</div>
                  <div class="probate-legend-item"><div class="probate-legend-dot met"></div>Met</div>
                  <div class="probate-legend-item"><div class="probate-legend-dot upcoming"></div>Upcoming</div>
                  <div class="probate-legend-item"><div class="probate-legend-dot missed"></div>Missed</div>
                  <div class="probate-legend-item"><div class="probate-legend-dot trigger"></div>Trigger</div>
                </div>
              </div>
              
              <!-- Phase Diagram Panel -->
              <div class="probate-panel">
                <div class="probate-panel-title">Risk Phase</div>
                <div class="probate-canvas-wrap">
                  <canvas id="probate-phase-canvas"></canvas>
                </div>
                <div class="probate-legend">
                  <div class="probate-legend-item"><div class="probate-legend-dot" style="background: rgba(59,255,111,0.5);"></div>On Track</div>
                  <div class="probate-legend-item"><div class="probate-legend-dot" style="background: rgba(255,170,0,0.5);"></div>Behind</div>
                  <div class="probate-legend-item"><div class="probate-legend-dot" style="background: rgba(255,59,59,0.5);"></div>Failure</div>
                </div>
              </div>
              
              <!-- Metrics Panel -->
              <div class="probate-panel probate-metrics">
                <div class="probate-panel-title">RCOT Metrics</div>
                <div class="probate-metric-group">
                  <div class="probate-metric-row">
                    <div class="probate-metric-label">
                      <span class="math">d(y, ∂𝔽)</span>
                      <div class="probate-metric-sublabel">Days to Next</div>
                    </div>
                    <div class="probate-metric-value" id="probate-metric-distance">—</div>
                  </div>
                  <div class="probate-metric-row">
                    <div class="probate-metric-label">
                      <span class="math">C<sub>Δ</sub></span>
                      <div class="probate-metric-sublabel">Coherence</div>
                    </div>
                    <div class="probate-metric-value" id="probate-metric-coherence">—</div>
                  </div>
                  <div class="probate-metric-row">
                    <div class="probate-metric-label">
                      <span class="math">TTBC</span>
                      <div class="probate-metric-sublabel">To Boundary</div>
                    </div>
                    <div class="probate-metric-value" id="probate-metric-ttbc">—</div>
                  </div>
                  <div class="probate-metric-row">
                    <div class="probate-metric-label">
                      <span class="math">∂𝔽</span>
                      <div class="probate-metric-sublabel">Missed</div>
                    </div>
                    <div class="probate-metric-value" id="probate-metric-missed">0</div>
                  </div>
                </div>
                <div class="probate-status">
                  <div class="probate-status-label">Status</div>
                  <div class="probate-status-value stable" id="probate-status-value">AWAITING</div>
                </div>
                <div class="probate-equations">
                  <div><span class="eq">∂𝔽</span> = Deadline boundary</div>
                  <div><span class="eq">TTBC</span> = Days to violation</div>
                </div>
              </div>
            </div>
            
            <!-- Consequences -->
            <div class="probate-consequences">
              <div class="probate-consequences-title">Active Consequences</div>
              <div class="probate-consequences-cards" id="probate-consequences">
                <div class="probate-no-consequences">✓ No violations</div>
              </div>
            </div>
            
            <!-- Footer -->
            <div class="probate-footer">
              ARS Title 14 · January 2026 · Not legal advice · RCOT Framework · Patent Pending US App. 19/448,772
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>
  <!-- Navigation -->
  <nav id="nav">
    <div class="nav-vertices">
      <a class="nav-vertex nav-logo" data-page="splash">
        <span class="vertex-node"></span>
        <span class="vertex-label">Co<sup>3</sup></span>
      </a>
      <a class="nav-vertex" data-page="about">
        <span class="vertex-node"></span>
        <span class="vertex-label">About</span>
      </a>
      <a class="nav-vertex" data-page="rcott">
        <span class="vertex-node"></span>
        <span class="vertex-label">Theory</span>
      </a>
      <a class="nav-vertex" data-page="patent">
        <span class="vertex-node"></span>
        <span class="vertex-label">Patent</span>
      </a>
      <a class="nav-vertex" data-page="contact">
        <span class="vertex-node"></span>
        <span class="vertex-label">Contact</span>
      </a>
    </div>
  </nav>
  
  <!-- Demo Key Banner -->
  <div id="demo-banner" class="hidden">
    <a id="demo-banner-link">
      <span class="banner-icon">◈</span>
      <span>Have a demo key?</span>
      <span class="banner-arrow">→</span>
    </a>
  </div>
  
  <!-- About Page -->
  <div id="about-page" class="page">
    <div class="page-content">
      <h2>Co³ One develops formal methods for constraint-aware decision making.</h2>
      
      <p>
        We believe the difference between systems that persist and systems that fail is visible long before failure arrives... if you know where to look. As such, we have chosen to partner with organizations that consciously build toward long time horizons.
      </p>
      
      <p>
        Our research has identified a geometric structure that naturally governs organizational coherence, infrastructure resilience, and operational risk. The same topology governs what persists across domains. We have formalized this as <em>Restraint Continuity Observation Translation</em> (RCOT): a framework for seeing trajectory drift before metrics register it. Foundational IP is patent pending.
      </p>
      
      <p>
        The cost of seeing clearly too late is paid by those who arrive just after the boundary moves.
      </p>
      
      <div class="cta-buttons">
        <a href="#" class="cta-button" data-page="rcott">
          <span>Explore the Theory</span>
          <span class="arrow">→</span>
        </a>
      </div>
      
      <div class="patent-badge">
        <a href="#" data-page="patent">Patent Pending · Application No. 19/448,772</a>
      </div>
    </div>
  </div>
  
  <!-- Theory Page -->
  <div id="rcott-page" class="page">
    <div class="page-content">
      <h1>Restraint Continuity Observation Translation Theory</h1>
      <p style="color: var(--white); font-style: italic; font-size: 1.2rem; margin-bottom: 0.5rem;">
        Motion and meaning are secondary.
      </p>
      <p style="color: var(--gray-light); max-width: 600px;">
        What happens next is whatever stays allowed, remains stable, and maintains distance from failure.
        Click any variable below to see the same geometry across domains.
      </p>
      
      <section>
        <div class="formula-explorer">
          <div class="formula-explorer-title">
            <h3>Interactive Constraint Geometry</h3>
          </div>
          <div class="formula-explorer-subtitle">Click a colored variable to explore</div>
          
          <div class="formula-display">
            <span class="formula-static">argmax</span>
            <span class="formula-var var-margin" data-var="margin" title="Margin to failure">d(y, ∂𝔽)</span>
            <span class="formula-static">+</span>
            <span class="formula-static">λ·</span>
            <span class="formula-var var-C" data-var="C" title="Coherence">C<sub>Δ</sub></span>
            <span class="formula-static">+</span>
            <span class="formula-static">μ·</span>
            <span class="formula-var var-C" data-var="Cdot" title="Coherence trend">Ċ<sub>Δ</sub></span>
          </div>
          
          <div class="formula-display" style="margin-top: -0.5rem;">
            <span class="formula-static">y ∈</span>
            <span class="formula-var var-F" data-var="F" title="Feasible set">𝔽</span>
            <span class="formula-static">&nbsp;&nbsp;subject to:</span>
            <span class="formula-var var-Pi" data-var="Pi" title="Projection map">Π</span>
            <span class="formula-static">(y) ≈ observed</span>
          </div>
          
          <div class="formula-display" style="margin-top: 0.5rem;">
            <span class="formula-static">where</span>
            <span class="formula-var var-dF" data-var="dF" title="Failure boundary">∂𝔽</span>
            <span class="formula-static">=</span>
            <span class="formula-var var-fail" data-var="fail" title="What goes wrong">failure boundary</span>
          </div>
          
          <div class="formula-panel" id="formula-panel">
            <div class="formula-panel-inner">
              <div class="panel-nav" id="panel-nav">
                <button class="panel-nav-item active" data-domain="physics">Physics</button>
                <button class="panel-nav-item" data-domain="medicine">Medicine</button>
                <button class="panel-nav-item" data-domain="math">Math</button>
                <button class="panel-nav-item" data-domain="computing">Computing</button>
                <button class="panel-nav-item" data-domain="biology">Biology</button>
              </div>
              
              <div class="panel-content" id="panel-content">
                <!-- Content injected by JavaScript -->
              </div>
            </div>
          </div>
          
          <div class="formula-disclaimer">
            <p>AI-generated constraint-topology exercises — not confirmed solutions</p>
          </div>
        </div>
      </section>
      
      <button class="tech-details-toggle" id="tech-details-toggle">
        <span class="chevron">▶</span>
        Technical Details
      </button>
      
      <div class="tech-details-content" id="tech-details-content">
        <section>
          <h2>Foundational Claim</h2>
          <p>
            Observed system behavior and its translations are governed by the persistence of 
            admissible continuations under accumulating restraints. What remains continuous 
            determines what can move and what can be consistently represented.
          </p>
        </section>
        
        <section>
          <h2>Mathematical Formulation</h2>
          
          <h3>Symbolic Key</h3>
          <div class="symbol-grid">
            <div class="symbol-item"><span class="sym">X</span><span class="def">state space</span></div>
            <div class="symbol-item"><span class="sym">x</span><span class="def">current state</span></div>
            <div class="symbol-item"><span class="sym">𝔽(t,x)</span><span class="def">feasible continuation set</span></div>
            <div class="symbol-item"><span class="sym">∂𝔽(t,x)</span><span class="def">feasibility boundary</span></div>
            <div class="symbol-item"><span class="sym">d(y,∂𝔽)</span><span class="def">margin to violation</span></div>
            <div class="symbol-item"><span class="sym">C<sub>Δ</sub>(t,y)</span><span class="def">coherence over window Δ</span></div>
            <div class="symbol-item"><span class="sym">Ċ<sub>Δ</sub>(t,y)</span><span class="def">coherence trend</span></div>
            <div class="symbol-item"><span class="sym">Π</span><span class="def">projection/translation map</span></div>
          </div>
          
          <h3>Trajectory Rule</h3>
          <div class="math-block">
            <span class="symbol">π</span><sub>t+Δt</sub>(x) = <span class="symbol">Π</span>(<br>
            &nbsp;&nbsp;<span class="symbol">argmin</span><sub>y ∈ 𝔽(t,x)</sub> [<br>
            &nbsp;&nbsp;&nbsp;&nbsp;d(y, ∂𝔽) − λ·C<sub>Δ</sub>(t,y) − μ·Ċ<sub>Δ</sub>(t,y)<br>
            &nbsp;&nbsp;]<br>
            )
          </div>
        </section>
        
        <section>
          <h2>Binary Invariants</h2>
          <p class="subtitle" style="margin-bottom: 1rem;">A 0–1 Pass / "Understood" Gating Framework</p>
          <div class="gating" style="margin-bottom: 1.5rem;">G := ∏<sub>m</sub> I<sub>m</sub> ∈ {0, 1}</div>
          <p style="color: var(--gray-light); margin-bottom: 1.5rem;">
            Validity is structural rather than interpretive. Each invariant is encoded as a binary 
            indicator I<sub>m</sub> ∈ {0,1}. Toggle to test the gate.
          </p>
          
          <div class="invariant-list">
            <div class="invariant-item checked" data-inv="1">
              <div class="toggle"></div>
              <div class="label">Sign coherence between prose and optimization direction</div>
            </div>
            <div class="invariant-item checked" data-inv="2">
              <div class="toggle"></div>
              <div class="label">Nonempty-domain requirements for infimum or argmin</div>
            </div>
            <div class="invariant-item checked" data-inv="3">
              <div class="toggle"></div>
              <div class="label">Explicit declaration and typing of the projection/translation map Π</div>
            </div>
            <div class="invariant-item checked" data-inv="4">
              <div class="toggle"></div>
              <div class="label">Sufficient definition of coherence functional C<sub>Δ</sub></div>
            </div>
            <div class="invariant-item checked" data-inv="5">
              <div class="toggle"></div>
              <div class="label">Stated convention for boundary edge cases involving ∂𝔽</div>
            </div>
          </div>
          
          <div class="gate-result pass" id="gate-result">
            G = 1 × 1 × 1 × 1 × 1 = <strong>1</strong> (PASS)
          </div>
        </section>
      </div>
    </div>
  </div>
  
  <!-- Patent Page -->
  <div id="patent-page" class="page">
    <div class="page-content patent-protected">
      <div class="patent-header">
        <div class="label">United States Patent Application</div>
        <h1>System and Method for Constraint-Aware Trajectory Optimization</h1>
        <div class="patent-meta">
          <div class="patent-meta-item">
            <div class="key">Application No.</div>
            <div class="value">19/448,772</div>
          </div>
          <div class="patent-meta-item">
            <div class="key">Filing Date</div>
            <div class="value">January 14, 2026</div>
          </div>
          <div class="patent-meta-item">
            <div class="key">Inventor</div>
            <div class="value">Ricardo Cruz Orozco</div>
          </div>
          <div class="patent-meta-item">
            <div class="key">Status</div>
            <div class="value">Patent Pending</div>
          </div>
        </div>
      </div>
      
      <div class="patent-notice">
        <span class="notice-icon">◈</span>
        <span>This document is provided for reference only. Content is protected.</span>
      </div>
      
      <div class="patent-section">
        <h2>Abstract</h2>
        <p class="patent-text">A computer-implemented method for selecting trajectories within constrained systems is disclosed. The method generates a finite set of candidate trajectories, predicts time-to-boundary-crossing values for each candidate relative to a failure boundary, and selects a trajectory by comparative ordering that maximizes a minimum temporal margin over a future evaluation horizon. The approach preserves continued system operability and is applicable across physical, computational, and organizational domains.</p>
      </div>
      
      <div class="patent-section">
        <h2>Background of the Invention</h2>
        <h3>Field of the Invention</h3>
        <p class="patent-text">[0003] The present invention relates to computational decision systems and, more particularly, to methods for selecting trajectories within constrained systems to preserve operability over time.</p>
        
        <h3>Description of Related Art</h3>
        <p class="patent-text">[0004] Existing trajectory planning and optimization techniques typically focus on minimizing cost or maximizing performance while satisfying constraints. Such methods may include model predictive control, safety filtering, and clearance-based planning. These approaches generally emphasize constraint satisfaction or spatial clearance and may not account for comparative temporal margins to system failure boundaries when selecting among multiple candidate trajectories. As a result, such systems may remain technically feasible while operating near failure boundaries with limited predictive robustness.</p>
      </div>
      
      <div class="patent-section">
        <h2>Summary of the Invention</h2>
        <p class="patent-text">[0005] The invention provides a computer-implemented method and system for selecting trajectories within constrained systems by generating a finite plurality of candidate trajectories, computing for each candidate a predicted time-to-boundary-crossing relative to a failure boundary, and selecting a trajectory by comparative ordering that maximizes a minimum predicted time-to-boundary-crossing over a future evaluation horizon to preserve operability.</p>
        <p class="patent-text">[0006] The selected trajectory may be output in a form usable by an external control, scheduling, or decision process to reduce risk of boundary violation over time.</p>
      </div>
      
      <div class="patent-section">
        <h2>Detailed Description of the Invention</h2>
        <p class="patent-text">[0012] The invention operates by identifying constraints that define a feasible region of operation for a system. These constraints may be physical, computational, logical, policy-based, or organizational in nature, and collectively define conditions under which continued system operability is preserved.</p>
        <p class="patent-text">[0013] Candidate trajectories are generated as discrete or continuous system evolutions computed from a current system state and constrained to remain initially within the feasible region. The set of candidate trajectories represents admissible future system behaviors for evaluation.</p>
        <p class="patent-text">[0014] For each candidate trajectory, a predicted time-to-boundary-crossing (TTBC) value is computed. The TTBC represents an estimated future time at which the candidate trajectory would intersect a failure boundary associated with loss of operability if the trajectory were continued.</p>
        <p class="patent-text">[0015] TTBC computation may be performed using forward simulation of system dynamics, interpolation between sampled trajectory states, or analytical evaluation of constraint functions over time. In discrete or stepwise systems, TTBC may be approximated by identifying the earliest timestep at which a constraint inequality defining the failure boundary is violated.</p>
        <p class="patent-text">[0016] The TTBC metric differs from time-to-collision methods in that it evaluates temporal margin relative to abstract or system-defined boundaries rather than physical object collisions, and is applicable to non-physical domains including computational and organizational systems.</p>
        <p class="patent-text">[0017] Candidate trajectories are comparatively ordered based on their TTBC values. In one embodiment, comparative ordering maximizes a minimum TTBC over a predefined evaluation horizon, thereby prioritizing trajectories that exhibit greater temporal robustness with respect to the failure boundary.</p>
        <p class="patent-text">[0018] The selected trajectory is output in a form usable by an external system or decision process, including control execution, scheduling, or governance action, thereby enabling operational decisions that reduce the likelihood of boundary violation over time.</p>
      </div>
      
      <div class="patent-section">
        <h2>Figures</h2>
        
        <div class="figure-full">
          <div class="figure-label">FIG. 1</div>
          <div class="figure-title">System Architecture</div>
          <svg class="patent-figure" viewBox="0 0 800 120" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#ff6700"/>
              </marker>
            </defs>
            <!-- Boxes -->
            <rect x="20" y="40" width="120" height="40" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="80" y="57" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Constraint</text>
            <text x="80" y="70" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Identification</text>
            
            <rect x="180" y="40" width="120" height="40" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="240" y="57" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Trajectory</text>
            <text x="240" y="70" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Computation</text>
            
            <rect x="340" y="40" width="120" height="40" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="400" y="57" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Boundary</text>
            <text x="400" y="70" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Evaluation</text>
            
            <rect x="500" y="40" width="120" height="40" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="560" y="57" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Selection</text>
            <text x="560" y="70" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Module</text>
            
            <rect x="660" y="40" width="120" height="40" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="720" y="57" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Output</text>
            <text x="720" y="70" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Translation</text>
            
            <!-- Arrows -->
            <line x1="140" y1="60" x2="175" y2="60" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead)"/>
            <line x1="300" y1="60" x2="335" y2="60" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead)"/>
            <line x1="460" y1="60" x2="495" y2="60" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead)"/>
            <line x1="620" y1="60" x2="655" y2="60" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead)"/>
          </svg>
          <p class="figure-desc">Trajectory selection architecture defining a feasible region and an associated failure boundary.</p>
        </div>
        
        <div class="figure-full">
          <div class="figure-label">FIG. 2</div>
          <div class="figure-title">Method Flow</div>
          <svg class="patent-figure" viewBox="0 0 400 420" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#ff6700"/>
              </marker>
            </defs>
            <!-- Step 1 -->
            <rect x="50" y="20" width="300" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="200" y="50" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">Identify constraints defining a feasible region</text>
            
            <!-- Arrow 1 -->
            <line x1="200" y1="70" x2="200" y2="95" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead2)"/>
            
            <!-- Step 2 -->
            <rect x="50" y="100" width="300" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="200" y="122" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">Compute candidate trajectories within</text>
            <text x="200" y="138" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">the feasible region</text>
            
            <!-- Arrow 2 -->
            <line x1="200" y1="150" x2="200" y2="175" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead2)"/>
            
            <!-- Step 3 -->
            <rect x="50" y="180" width="300" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="200" y="202" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">Evaluate proximity of candidate trajectories</text>
            <text x="200" y="218" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">to failure boundary over prediction horizon</text>
            
            <!-- Arrow 3 -->
            <line x1="200" y1="230" x2="200" y2="255" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead2)"/>
            
            <!-- Step 4 -->
            <rect x="50" y="260" width="300" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="200" y="282" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">Select trajectory based on preservation of</text>
            <text x="200" y="298" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">distance from the failure boundary</text>
            
            <!-- Arrow 4 -->
            <line x1="200" y1="310" x2="200" y2="335" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead2)"/>
            
            <!-- Step 5 -->
            <rect x="50" y="340" width="300" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="200" y="362" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">Generate an output representation</text>
            <text x="200" y="378" text-anchor="middle" fill="#ccc" font-size="11" font-family="Cormorant Garamond, serif">corresponding to the selected trajectory</text>
          </svg>
          <p class="figure-desc">Trajectory generation module producing a finite plurality of candidate trajectories within the feasible region.</p>
        </div>
        
        <div class="figure-full">
          <div class="figure-label">FIG. 3</div>
          <div class="figure-title">Feasible Region and Trajectories</div>
          <svg class="patent-figure" viewBox="0 0 500 350" xmlns="http://www.w3.org/2000/svg">
            <!-- Outer boundary (failure boundary) -->
            <rect x="30" y="30" width="440" height="280" rx="30" ry="30" fill="none" stroke="#444" stroke-width="2"/>
            <text x="60" y="55" fill="#666" font-size="10" font-family="JetBrains Mono, monospace">Failure Boundary</text>
            
            <!-- Feasible region -->
            <path d="M100,200 Q80,120 150,100 Q250,70 350,120 Q420,160 380,220 Q340,280 250,270 Q160,260 120,230 Q90,210 100,200" fill="rgba(255,103,0,0.05)" stroke="#ff6700" stroke-width="1"/>
            <text x="230" y="190" fill="#ff6700" font-size="11" font-family="Cormorant Garamond, serif" font-style="italic">FEASIBLE REGION</text>
            
            <!-- Current state -->
            <circle cx="120" cy="180" r="25" fill="none" stroke="#666" stroke-width="1"/>
            <circle cx="120" cy="180" r="3" fill="#ff6700"/>
            <text x="90" y="220" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">CURRENT</text>
            <text x="98" y="232" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">STATE</text>
            
            <!-- Trajectory 1 (approaches boundary) -->
            <path d="M120,180 Q200,140 280,100 Q340,70 390,85" fill="none" stroke="#888" stroke-width="1" stroke-dasharray="4,2"/>
            <circle cx="390" cy="85" r="4" fill="#888"/>
            <text x="320" y="75" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">CANDIDATE</text>
            <text x="320" y="87" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">TRAJECTORY 1</text>
            
            <!-- Trajectory 2 (stays in feasible region) -->
            <path d="M120,180 Q180,190 250,200 Q320,210 370,190" fill="none" stroke="#ff6700" stroke-width="1.5"/>
            <circle cx="370" cy="190" r="4" fill="#ff6700"/>
            <text x="375" y="175" fill="#ff6700" font-size="9" font-family="JetBrains Mono, monospace">CANDIDATE</text>
            <text x="375" y="187" fill="#ff6700" font-size="9" font-family="JetBrains Mono, monospace">TRAJECTORY 2</text>
          </svg>
          <p class="figure-desc">Trajectory evaluation module computing predicted time-to-boundary-crossing values for candidate trajectories relative to the failure boundary.</p>
        </div>
        
        <div class="figure-full">
          <div class="figure-label">FIG. 4</div>
          <div class="figure-title">Selection Module</div>
          <svg class="patent-figure" viewBox="0 0 700 140" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <marker id="arrowhead4" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#ff6700"/>
              </marker>
            </defs>
            <!-- Input trajectories -->
            <rect x="20" y="15" width="130" height="30" fill="none" stroke="#666" stroke-width="1"/>
            <text x="85" y="35" text-anchor="middle" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">Candidate Traj. 1</text>
            
            <rect x="20" y="55" width="130" height="30" fill="none" stroke="#666" stroke-width="1"/>
            <text x="85" y="75" text-anchor="middle" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">Candidate Traj. 2</text>
            
            <rect x="20" y="95" width="130" height="30" fill="none" stroke="#666" stroke-width="1"/>
            <text x="85" y="115" text-anchor="middle" fill="#888" font-size="9" font-family="JetBrains Mono, monospace">Candidate Traj. N</text>
            
            <!-- Converging lines -->
            <line x1="150" y1="30" x2="220" y2="70" stroke="#666" stroke-width="1"/>
            <line x1="150" y1="70" x2="220" y2="70" stroke="#666" stroke-width="1"/>
            <line x1="150" y1="110" x2="220" y2="70" stroke="#666" stroke-width="1"/>
            
            <!-- Selection module -->
            <rect x="230" y="45" width="130" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="295" y="75" text-anchor="middle" fill="#ff6700" font-size="10" font-family="JetBrains Mono, monospace">Selection Module</text>
            
            <!-- Arrow to output -->
            <line x1="360" y1="70" x2="410" y2="70" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead4)"/>
            
            <!-- Output module -->
            <rect x="420" y="45" width="130" height="50" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="485" y="68" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Output /</text>
            <text x="485" y="82" text-anchor="middle" fill="#ccc" font-size="9" font-family="JetBrains Mono, monospace">Translation Module</text>
            
            <!-- Arrow to representation -->
            <line x1="550" y1="70" x2="600" y2="70" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead4)"/>
            
            <!-- Output representation -->
            <rect x="610" y="45" width="70" height="50" fill="rgba(255,103,0,0.1)" stroke="#ff6700" stroke-width="1"/>
            <text x="645" y="68" text-anchor="middle" fill="#ff6700" font-size="8" font-family="JetBrains Mono, monospace">Output</text>
            <text x="645" y="80" text-anchor="middle" fill="#ff6700" font-size="8" font-family="JetBrains Mono, monospace">Repr.</text>
          </svg>
          <p class="figure-desc">Trajectory selection module comparatively ordering candidate trajectories based on predicted time-to-boundary-crossing values.</p>
        </div>
        
        <div class="figure-full">
          <div class="figure-label">FIG. 5</div>
          <div class="figure-title">Computing System</div>
          <svg class="patent-figure" viewBox="0 0 700 200" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <marker id="arrowhead5" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#ff6700"/>
              </marker>
            </defs>
            <!-- System boundary -->
            <rect x="20" y="20" width="660" height="160" fill="none" stroke="#333" stroke-width="1"/>
            <text x="350" y="170" text-anchor="middle" fill="#666" font-size="10" font-family="JetBrains Mono, monospace">Computing System</text>
            
            <!-- Processor -->
            <rect x="40" y="40" width="100" height="35" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="90" y="62" text-anchor="middle" fill="#ff6700" font-size="10" font-family="JetBrains Mono, monospace">Processor</text>
            
            <!-- Memory -->
            <rect x="560" y="40" width="100" height="35" fill="none" stroke="#ff6700" stroke-width="1"/>
            <text x="610" y="62" text-anchor="middle" fill="#ff6700" font-size="10" font-family="JetBrains Mono, monospace">Memory</text>
            
            <!-- Connection line -->
            <line x1="140" y1="57" x2="560" y2="57" stroke="#444" stroke-width="1"/>
            
            <!-- Vertical lines -->
            <line x1="90" y1="75" x2="90" y2="95" stroke="#444" stroke-width="1"/>
            
            <!-- Module boxes -->
            <rect x="40" y="100" width="95" height="45" fill="none" stroke="#666" stroke-width="1"/>
            <text x="87" y="120" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Constraint</text>
            <text x="87" y="132" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Identification</text>
            
            <rect x="155" y="100" width="95" height="45" fill="none" stroke="#666" stroke-width="1"/>
            <text x="202" y="120" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Trajectory</text>
            <text x="202" y="132" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Computation</text>
            
            <rect x="270" y="100" width="95" height="45" fill="none" stroke="#666" stroke-width="1"/>
            <text x="317" y="120" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Boundary</text>
            <text x="317" y="132" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Evaluation</text>
            
            <rect x="385" y="100" width="95" height="45" fill="none" stroke="#666" stroke-width="1"/>
            <text x="432" y="120" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Selection</text>
            <text x="432" y="132" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Module</text>
            
            <rect x="500" y="100" width="95" height="45" fill="none" stroke="#666" stroke-width="1"/>
            <text x="547" y="120" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Output /</text>
            <text x="547" y="132" text-anchor="middle" fill="#888" font-size="7" font-family="JetBrains Mono, monospace">Translation</text>
            
            <!-- Module arrows -->
            <line x1="135" y1="122" x2="150" y2="122" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead5)"/>
            <line x1="250" y1="122" x2="265" y2="122" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead5)"/>
            <line x1="365" y1="122" x2="380" y2="122" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead5)"/>
            <line x1="480" y1="122" x2="495" y2="122" stroke="#ff6700" stroke-width="1" marker-end="url(#arrowhead5)"/>
          </svg>
          <p class="figure-desc">Output interface providing an output representation of the selected trajectory for use by an external system or decision process.</p>
        </div>
      </div>
      
      <div class="patent-section">
        <h2>Claims</h2>
        <div class="claims-list">
          <div class="claim-item claim-independent">
            <p>A computer-implemented method for selecting a trajectory within a constrained system, comprising:</p>
            <p class="claim-element">(i) identifying constraints defining a feasible region of system operation;</p>
            <p class="claim-element">(ii) computing, by a trajectory generation module, a finite plurality of candidate trajectories extending from a current system state and admissible within the feasible region;</p>
            <p class="claim-element">(iii) evaluating, by a trajectory evaluation module, each candidate trajectory by computing a predicted time-to-boundary-crossing value representing a predicted time until the candidate trajectory intersects a failure boundary associated with loss of system operability;</p>
            <p class="claim-element">(iv) selecting, by a trajectory selection module, one of the candidate trajectories based on a comparative ordering that maximizes a minimum predicted time-to-boundary-crossing across the candidate trajectories over a future evaluation horizon; and</p>
            <p class="claim-element">(v) generating, by an output interface, an output representation corresponding to the selected trajectory for use by an external system or decision process.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein evaluating each candidate trajectory comprises forward simulating the constrained system under the candidate trajectory across the future evaluation horizon to identify an earliest time at which a constraint defining the failure boundary is violated.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the constraints comprise one or more inequality constraints, and wherein the predicted time-to-boundary-crossing value is computed by detecting a threshold crossing or sign change of a constraint function evaluated along the candidate trajectory.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the constrained system is modeled in discrete time, and wherein the predicted time-to-boundary-crossing value is approximated by identifying a first discrete timestep within the future evaluation horizon at which a constraint inequality is violated.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein generating the finite plurality of candidate trajectories comprises selecting trajectory primitives from a predefined library or sampling admissible trajectories from a trajectory generator.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the comparative ordering further accounts for at least one secondary criterion selected from:</p>
            <p class="claim-element">(i) a rate of decrease of temporal margin relative to the failure boundary,</p>
            <p class="claim-element">(ii) a stability metric,</p>
            <p class="claim-element">(iii) an energy or resource expenditure metric, or</p>
            <p class="claim-element">(iv) a priority weighting applied to subsets of the constraints.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the failure boundary corresponds to a boundary of the feasible region, and wherein the predicted time-to-boundary-crossing represents a predicted time until the candidate trajectory exits the feasible region.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the future evaluation horizon comprises a fixed temporal duration, a fixed number of discrete timesteps, or a dynamically selected horizon determined based on at least one of system state, constraint tightness, or computational budget.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the output representation comprises at least one of:</p>
            <p class="claim-element">(i) a control sequence,</p>
            <p class="claim-element">(ii) a schedule,</p>
            <p class="claim-element">(iii) a recommendation,</p>
            <p class="claim-element">(iv) a governance action,</p>
            <p class="claim-element">(v) a plan, or</p>
            <p class="claim-element">(vi) a machine-readable instruction set consumable by the external system or decision process.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the constrained system corresponds to a physical system subject to one or more physical, mechanical, or environmental constraints.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the constrained system corresponds to a computational system subject to one or more logical, computational, or resource-based constraints.</p>
          </div>
          
          <div class="claim-item">
            <p>The computer-implemented method of claim 1, wherein the constrained system corresponds to an organizational or institutional system subject to one or more policy, regulatory, operational, or governance constraints.</p>
          </div>
          
          <div class="claim-item claim-independent">
            <p>A computer-implemented system comprising one or more processors and one or more memories storing instructions that, when executed, cause the one or more processors to perform the method of any one of claims 1–12.</p>
          </div>
          
          <div class="claim-item claim-independent">
            <p>A non-transitory computer-readable medium storing instructions that, when executed by one or more processors, cause the one or more processors to perform the method of any one of claims 1–12.</p>
          </div>
        </div>
      </div>
      
      <div class="page-link">
        <a href="#" data-page="rcott">← Back to Theory</a>
      </div>
    </div>
  </div>

  <!-- Contact Page -->
  <div id="contact-page" class="page">
    <div class="page-content">
      <h2>Contact Co<sup>3</sup></h2>
      
      <div class="contact-section">
        <form id="contact-form" action="https://formsubmit.co/founder@co3.one" method="POST">
          <input type="hidden" name="_captcha" value="true">
          <input type="hidden" name="_subject" value="Co³ One Contact Form">
          <input type="hidden" name="_template" value="table">
          <input type="hidden" name="_next" value="https://co3.one">
          <div class="form-group">
            <input type="text" name="name" placeholder="Name" required>
          </div>
          <div class="form-group">
            <input type="email" name="email" placeholder="Email" required>
          </div>
          <div class="form-group">
            <textarea name="message" placeholder="Message" rows="4" required></textarea>
          </div>
          <button type="submit">Send</button>
        </form>
      </div>
      
      <div class="social-links" style="margin-top: 2rem; justify-content: flex-start;">
        <a href="https://substack.com/@co3one" target="_blank" class="social-link">Substack</a>
        <a href="https://github.com/rickymp3" target="_blank" class="social-link">GitHub</a>
        <a href="https://www.instagram.com/co3.one" target="_blank" class="social-link">Instagram</a>
        <a href="https://www.youtube.com/@CO3ONE" target="_blank" class="social-link">YouTube</a>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // ============ THREE.JS WIREFRAME BACKGROUND ============
    (function() {
      try {
        if (typeof THREE === 'undefined') return;
        
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);
        
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 12, 0.01);
        camera.lookAt(0, 0, 0);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);
        
        const gridColor = 0x4a4a4a;
        const gridRadius = 5;
        const wellDepth = 3;
        const wellSharpness = 1.4;
        
        window.threeSpeedMultiplier = 1;
        window.threeTargetSpeed = 1;
        
        function calculateWellZ(r) {
          const normalizedR = r / gridRadius;
          const z = -wellDepth * Math.pow(1 - normalizedR, wellSharpness) / (normalizedR + 0.1);
          return Math.max(z, -wellDepth * 3.5);
        }
        
        const numRings = 21;
        const ringLifespans = [];
        const ringsGroup = new THREE.Group();
        
        // Track wireframe state: 'splash', 'transition', 'idle'
        window.threeWireframeState = 'splash';
        
        for (let i = 0; i < numRings; i++) {
          // Random direction: 1 = inward, -1 = outward (used during transitions)
          const direction = Math.random() > 0.5 ? 1 : -1;
          // Random transparency modifier: 25% of rings get 25-75% more transparent
          const isMoreTransparent = Math.random() < 0.25;
          const transparencyMod = isMoreTransparent ? (0.25 + Math.random() * 0.5) : 1;
          
          ringLifespans.push({ 
            progress: i / numRings, 
            baseSpeed: 0.04 + Math.random() * 0.02,  // Much slower
            direction: direction,
            transparencyMod: transparencyMod
          });
          const geometry = new THREE.BufferGeometry();
          const positions = new Float32Array(73 * 3);
          geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
          const material = new THREE.LineBasicMaterial({ color: gridColor, transparent: true, opacity: 0.7 });
          ringsGroup.add(new THREE.Line(geometry, material));
        }
        scene.add(ringsGroup);
        
        // Travelling points: doubled count, moving outward from center
        const numPoints = numRings * 2;
        const pointData = [];
        const pointsGroup = new THREE.Group();
        const minAngleSeparation = Math.PI / 8;  // Smaller separation for more points
        
        // Function to find a valid angle that's not too close to other spawning points
        function findValidAngle() {
          const maxAttempts = 20;
          for (let attempt = 0; attempt < maxAttempts; attempt++) {
            const candidateAngle = Math.random() * Math.PI * 2;
            let isValid = true;
            
            // Check against other points that are currently spawning (progress < 0.2)
            for (const other of pointData) {
              if (other.progress < 0.2) {
                let angleDiff = Math.abs(candidateAngle - other.angle);
                if (angleDiff > Math.PI) angleDiff = Math.PI * 2 - angleDiff;
                if (angleDiff < minAngleSeparation) {
                  isValid = false;
                  break;
                }
              }
            }
            
            if (isValid) return candidateAngle;
          }
          return Math.random() * Math.PI * 2;
        }
        
        for (let i = 0; i < numPoints; i++) {
          const angle = (i / numPoints) * Math.PI * 2 + Math.random() * 0.2;
          
          // Varied sizes: most small (2), some medium (3), few large (4)
          let size;
          const sizeRoll = Math.random();
          if (sizeRoll < 0.5) {
            size = 2;  // 50% small
          } else if (sizeRoll < 0.85) {
            size = 3;  // 35% medium
          } else {
            size = 4;  // 15% large
          }
          
          pointData.push({ 
            angle, 
            progress: Math.random(),
            baseSpeed: 0.02 + Math.random() * 0.015
          });
          
          // Single point
          const geometry = new THREE.BufferGeometry();
          geometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(3), 3));
          const material = new THREE.PointsMaterial({ 
            color: gridColor, 
            transparent: true, 
            opacity: 0.6,
            size: size,
            sizeAttenuation: false
          });
          pointsGroup.add(new THREE.Points(geometry, material));
        }
        scene.add(pointsGroup);
        
        function updateRings(delta) {
          const solidity = window.getWireframeSolidity ? window.getWireframeSolidity() : 0;
          
          // Glow based on solidity (brighter when solid)
          const glowMultiplier = 0.7 + solidity * 0.5;
          
          ringsGroup.children.forEach((ring, i) => {
            const ls = ringLifespans[i];
            ls.progress += ls.baseSpeed * delta * window.threeSpeedMultiplier;
            if (ls.progress > 1) ls.progress = 0;
            if (ls.progress < 0) ls.progress = 1;
            
            // Always use inward motion (splash behavior)
            const r = (1 - ls.progress) * gridRadius;
            
            const pos = ring.geometry.attributes.position.array;
            for (let j = 0; j <= 72; j++) {
              const theta = (j / 72) * Math.PI * 2;
              pos[j*3] = r * Math.cos(theta);
              pos[j*3+1] = calculateWellZ(r);
              pos[j*3+2] = r * Math.sin(theta);
            }
            ring.geometry.attributes.position.needsUpdate = true;
            
            // Opacity: fade more as rings approach center
            // ls.progress goes 0→1 as ring moves inward, r goes gridRadius→0
            let baseOpacity = ls.progress * ls.transparencyMod * 0.7 * 0.7;
            
            // Extra fade for inner rings (when progress > 0.7, meaning inner 30% of radius)
            if (ls.progress > 0.7) {
              const innerFade = 1 - ((ls.progress - 0.7) / 0.3);
              baseOpacity *= innerFade;
            }
            
            ring.material.opacity = baseOpacity;
            
            // Brightness
            const brightness = 0.32;
            ring.material.color.setRGB(brightness, brightness, brightness);
          });
        }
        
        function updatePoints(delta, mouseX, mouseY, mouseInfluence) {
          // Convert mouse position to 3D world coordinates on the funnel surface
          const mouseWorldX = (mouseX - 0.5) * gridRadius * 2;
          const mouseWorldZ = (mouseY - 0.5) * gridRadius * 2;
          
          pointData.forEach((point, i) => {
            // Progress: 0 = at edge, 1 = at center and faded
            point.progress += point.baseSpeed * delta * window.threeSpeedMultiplier;
            
            // Respawn when complete
            if (point.progress >= 1) {
              point.progress = 0;
              point.angle = findValidAngle();
            }
            
            const pointMesh = pointsGroup.children[i];
            const pos = pointMesh.geometry.attributes.position.array;
            
            const outerMax = gridRadius * 0.95;
            const innerMin = gridRadius * 0.25;
            
            // Current radius - travels inward
            const r = outerMax - (outerMax - innerMin) * point.progress;
            
            // Base position
            let x = r * Math.cos(point.angle);
            let z = r * Math.sin(point.angle);
            
            // Calculate distance from mouse in world space
            const dx = x - mouseWorldX;
            const dz = z - mouseWorldZ;
            const distFromMouse = Math.sqrt(dx * dx + dz * dz);
            
            // Influence radius - points within this distance are affected
            const influenceRadius = gridRadius * 0.4;
            
            // Apply mouse repulsion to nearby points
            if (mouseInfluence > 0.01 && distFromMouse < influenceRadius) {
              const proximityFactor = 1 - (distFromMouse / influenceRadius);
              const repelStrength = proximityFactor * proximityFactor * 0.15 * mouseInfluence;
              
              // Push point away from mouse
              const angle = Math.atan2(dz, dx);
              x += Math.cos(angle) * repelStrength * gridRadius;
              z += Math.sin(angle) * repelStrength * gridRadius;
            }
            
            pos[0] = x;
            pos[1] = calculateWellZ(r);
            pos[2] = z;
            
            // Opacity: fade in near edge, full in middle, fade out near center
            let opacity;
            if (point.progress < 0.15) {
              opacity = 0.5 * (point.progress / 0.15);
            } else if (point.progress < 0.7) {
              opacity = 0.5;
            } else {
              opacity = 0.5 * (1 - (point.progress - 0.7) / 0.3);
            }
            
            // Boost opacity for points near mouse
            if (mouseInfluence > 0.01 && distFromMouse < influenceRadius) {
              const proximityFactor = 1 - (distFromMouse / influenceRadius);
              opacity = Math.min(0.8, opacity + proximityFactor * 0.3 * mouseInfluence);
            }
            
            pointMesh.geometry.attributes.position.needsUpdate = true;
            pointMesh.material.opacity = opacity;
            pointMesh.material.color.setRGB(0.32, 0.32, 0.32);
          });
        }
        
        // Mouse interaction (only on splash)
        let mouseX = 0.5;
        let mouseY = 0.5;
        let targetMouseX = 0.5;
        let targetMouseY = 0.5;
        let mouseInfluence = 0;
        let targetMouseInfluence = 0;
        
        document.addEventListener('mousemove', (e) => {
          targetMouseX = e.clientX / window.innerWidth;
          targetMouseY = e.clientY / window.innerHeight;
        });
        
        // Expose controls
        window.setMouseInfluence = (val) => { targetMouseInfluence = val; };
        
        function animate() {
          requestAnimationFrame(animate);
          // Slower speed easing
          window.threeSpeedMultiplier += (window.threeTargetSpeed - window.threeSpeedMultiplier) * 0.008;
          
          // Smooth mouse tracking
          mouseX += (targetMouseX - mouseX) * 0.05;
          mouseY += (targetMouseY - mouseY) * 0.05;
          mouseInfluence += (targetMouseInfluence - mouseInfluence) * 0.02;
          
          // When mouse influence is dropping, smoothly return mouse position to center
          if (targetMouseInfluence < 0.5) {
            targetMouseX += (0.5 - targetMouseX) * 0.02;
            targetMouseY += (0.5 - targetMouseY) * 0.02;
          }
          
          // Apply mouse influence to camera tilt (always update for smooth return)
          // Removed rotation - just keep camera static
          camera.position.x = 0;
          camera.position.z = 0.01;
          camera.lookAt(0, 0, 0);
          
          // Mouse Y affects speed (top = faster, bottom = slower) - only on splash
          if (mouseInfluence > 0.1) {
            const speedMod = 0.7 + (1 - mouseY) * 0.6;
            window.threeTargetSpeed = speedMod;
          } else {
            window.threeTargetSpeed = 1;
          }
          
          updateRings(0.016);
          updatePoints(0.016, mouseX, mouseY, mouseInfluence);
          renderer.render(scene, camera);
        }
        
        animate();
        
        window.addEventListener('resize', () => {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        });
      } catch(e) { console.warn('3D disabled:', e); }
    })();
    
    // ============ NAVIGATION ============
    const logoText = document.getElementById('logo-text');
    const logoRing = document.getElementById('logo-ring');
    const logoRingMid = document.getElementById('logo-ring-mid');
    const logoRingOuter = document.getElementById('logo-ring-outer');
    const nav = document.getElementById('nav');
    const pages = document.querySelectorAll('.page');
    const navLinks = document.querySelectorAll('[data-page]');
    const transitionOverlay = document.getElementById('transition-overlay');
    
    let currentPage = 'splash';
    let isTransitioning = false;
    let autoReturnTimer = null;
    const AUTO_RETURN_MS = 5 * 60 * 1000;
    
    // Enable mouse influence on splash (initial state)
    setTimeout(() => {
      if (window.setMouseInfluence) window.setMouseInfluence(1);
    }, 100);
    
    function resetAutoReturn() {
      if (autoReturnTimer) clearTimeout(autoReturnTimer);
      if (currentPage !== 'splash') {
        autoReturnTimer = setTimeout(() => navigateTo('splash'), AUTO_RETURN_MS);
      }
    }
    
    document.addEventListener('mousemove', resetAutoReturn);
    document.addEventListener('touchstart', resetAutoReturn);
    document.addEventListener('scroll', resetAutoReturn);
    
    function revealNav() {
      const vertices = document.querySelectorAll('.nav-vertex');
      
      vertices.forEach((v, i) => {
        setTimeout(() => {
          v.classList.add('revealed');
        }, i * 100);
      });
    }
    
    function hideNav() {
      const vertices = document.querySelectorAll('.nav-vertex');
      vertices.forEach(v => v.classList.remove('revealed'));
    }
    
    function navigateTo(page) {
      if (page === currentPage || isTransitioning) return;
      
      const fromSplash = currentPage === 'splash';
      const toSplash = page === 'splash';
      
      isTransitioning = true;
      
      // If navigating between non-splash pages, keep nav visible
      if (!fromSplash && !toSplash) {
        // Direct transition - just swap content
        pages.forEach(p => p.classList.remove('active'));
        
        setTimeout(() => {
          document.getElementById(page + '-page').classList.add('active');
          
          navLinks.forEach(link => {
            link.classList.toggle('active', link.dataset.page === page);
          });
          
          currentPage = page;
          resetAutoReturn();
          
          const activePage = document.querySelector('.page.active');
          if (activePage) activePage.scrollTop = 0;
          
          isTransitioning = false;
        }, 400);
        
        return;
      }
      
      // Full transition (to/from splash)
      pages.forEach(p => p.classList.remove('active'));
      nav.classList.remove('visible');
      hideNav();
      
      // Immediately start fading logo to splash state
      logoText.classList.remove('dimmed');
      logoText.classList.remove('hidden');
      logoRing.classList.remove('hidden');
      logoRingMid.classList.remove('hidden');
      logoRingOuter.classList.remove('hidden');
      if (window.setMouseInfluence) window.setMouseInfluence(1);
      
      // After splash interstitial, show target page
      setTimeout(() => {
        if (page === 'splash') {
          // Already showing splash, just finalize
          if (autoReturnTimer) clearTimeout(autoReturnTimer);
        } else {
          // Fade logo to dimmed grey
          logoText.classList.add('dimmed');
          logoRing.classList.add('hidden');
          logoRingMid.classList.add('hidden');
          logoRingOuter.classList.add('hidden');
          if (window.setMouseInfluence) window.setMouseInfluence(0);
          
          // Show page content first
          document.getElementById(page + '-page').classList.add('active');
          resetAutoReturn();
          
          // Then show nav container, then stagger reveal items
          setTimeout(() => {
            nav.classList.add('visible');
            setTimeout(revealNav, 100);
          }, 200);
        }
        
        navLinks.forEach(link => {
          link.classList.toggle('active', link.dataset.page === page);
        });
        
        currentPage = page;
        
        if (typeof updateDemoBanner === 'function') {
          updateDemoBanner();
        }
        
        const activePage = document.querySelector('.page.active');
        if (activePage) activePage.scrollTop = 0;
        
        isTransitioning = false;
      }, 1350);
    }
    
    logoText.addEventListener('click', () => navigateTo('about'));
    
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        navigateTo(link.dataset.page);
      });
    });
    
    // ============ INVARIANT TOGGLE ============
    const invariantItems = document.querySelectorAll('.invariant-item');
    const gateResult = document.getElementById('gate-result');
    
    function updateGate() {
      const values = Array.from(invariantItems).map(item => item.classList.contains('checked') ? 1 : 0);
      const product = values.reduce((a, b) => a * b, 1);
      gateResult.innerHTML = `G = ${values.join(' × ')} = <strong>${product}</strong> (${product === 1 ? 'PASS' : 'FAIL'})`;
      gateResult.className = 'gate-result ' + (product === 1 ? 'pass' : 'fail');
    }
    
    invariantItems.forEach(item => {
      item.addEventListener('click', () => {
        item.classList.toggle('checked');
        updateGate();
      });
    });
    
    // ============ LAB ACCESS CONTROL ============
    // Keys and names are SHA-256 hashed for obfuscation
    // To add a new key: echo -n "YOUR_KEY" | shasum -a 256
    // Names are encoded: btoa(firstName + '|' + lastName)
    const validKeyData = [
      // Default demo keys (show 404 boundary failure)
      { hash: 'ccea55a3332ba42e92385a86eb1112d9dd89550d54a62e6be696a13538e39c2c', name: 'RGVtb3xBbHBoYQ==', demo: 'default' },   // DEMO-ALPHA-2026
      { hash: '6974cd7d586ce9398a2cc7a78eae2676d5c5333949f3d4087cb9be5238690f40', name: 'RGVtb3xCZXRh', demo: 'default' },       // DEMO-BETA-2026
      { hash: 'd6dd5dd3982533f2df1f1e9ae290d02453d0eb387eb60927866564800081b1b5', name: 'RGVtb3xHYW1tYQ==', demo: 'default' },   // DEMO-GAMMA-2026
      { hash: '11d339caecfb097c5e8161120e85f46697285f738ca65fbc5a3cb31cc8dbe1b1', name: 'RGVtb3xEZWx0YQ==', demo: 'default' },   // DEMO-DELTA-2026
      { hash: '3ed499260a1ccb90ffdc6c0aadc05b57f61bea680d7c9f04ef0304544fe79971', name: 'RGVtb3xPbWVnYQ==', demo: 'default' },   // DEMO-OMEGA-2026
      
      // Anthropic / AI Safety keys (show alignment phase transition demo)
      { hash: 'eecc4d63527f3a50238d798648869aa0ae21350f52bb25fde8249184afd781f9', name: 'QW50aHJvcGljfERlbW8=', demo: 'alignment' },     // RCOT-ANTHROPIC-2026
      { hash: '9a62b1cb85fc65c0b133c173765256d173f7e16d6c448cef326e8f3de6e511e0', name: 'QW50aHJvcGljfERlbW8=', demo: 'alignment' },     // RCOT-ALIGNMENT-2026
      { hash: '8d1f5e7ca1d62cc60831319356f2d8b04d3e952d5ffed3f279e31bcdf8ce0c8b', name: 'QW50aHJvcGljfERlbW8=', demo: 'alignment' },     // RCOT-SAFETY-2026
      { hash: '85c77b2ca6546af92751fee0db00813725b68df1cd31f5161be3a000348894d3', name: 'QW50aHJvcGljfERlbW8=', demo: 'alignment' },     // RCOT-INTERP-2026
      
      // Legal / Probate keys (show Arizona probate deadline tracker)
      { hash: '96daf361dc003258adcadb0a88fd42e824b2c8923dcdc1f3969a20a0e954a965', name: 'UHJvYmF0ZXxEZW1v', demo: 'probate' },           // PROBATE-DEMO-2026
      { hash: 'c15f7bbe9447055712636be267a8fb5e72dba15f3461c826e922ba1fd5d41e84', name: 'QW5uZXxIb2xkc3dvcnRo', demo: 'probate' }        // ANNE-HOLDSWORTH-2026
    ];
    
    async function hashKey(key) {
      const encoder = new TextEncoder();
      const data = encoder.encode(key.toUpperCase().trim());
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }
    
    function decodeName(encoded) {
      try {
        const decoded = atob(encoded);
        const [first, last] = decoded.split('|');
        return { first, last, full: `${first} ${last}` };
      } catch {
        return { first: 'User', last: '', full: 'Authorized User' };
      }
    }
    
    const labGate = document.getElementById('lab-gate');
    const labContent = document.getElementById('lab-content');
    const labKeyInput = document.getElementById('lab-key-input');
    const labKeySubmit = document.getElementById('lab-key-submit');
    const keyError = document.getElementById('key-error');
    const labLogout = document.getElementById('lab-logout');
    
    // Demo banner
    const demoBanner = document.getElementById('demo-banner');
    const demoBannerLink = document.getElementById('demo-banner-link');
    
    // Disclaimer elements
    const keyPrompt = document.getElementById('key-prompt');
    const disclaimerPrompt = document.getElementById('disclaimer-prompt');
    const disclaimerScroll = document.getElementById('disclaimer-scroll');
    const acceptCheckbox = document.getElementById('accept-checkbox');
    const nameConfirmInput = document.getElementById('name-confirm-input');
    const acceptBtn = document.getElementById('accept-btn');
    const acceptBtnText = document.getElementById('accept-btn-text');
    const userFullNameDisplay = document.getElementById('user-full-name');
    
    let currentUserData = null;
    let disclaimerTimer = null;
    let countdownRemaining = 10;
    let hasScrolledToBottom = false;
    let checkboxChecked = false;
    let currentDemoType = 'default';
    
    // Demo banner click - navigate to lab
    demoBannerLink.addEventListener('click', (e) => {
      e.preventDefault();
      navigateTo('lab');
    });
    
    // Show/hide demo banner based on current page
    function updateDemoBanner() {
      if (currentPage === 'splash' || currentPage === 'lab') {
        demoBanner.classList.add('hidden');
      } else {
        demoBanner.classList.remove('hidden');
      }
    }
    
    // Check for existing session
    function checkSession() {
      const session = sessionStorage.getItem('lab_session');
      if (session) {
        const sessionData = JSON.parse(session);
        currentDemoType = sessionData.demo || 'default';
        labGate.classList.add('hidden');
        labContent.classList.add('visible');
        showDemoByType(currentDemoType);
      }
    }
    
    // Validate key - Step 1
    async function validateKey() {
      const key = labKeyInput.value;
      if (!key) {
        showError('Please enter a key');
        return;
      }
      
      const hash = await hashKey(key);
      const keyData = validKeyData.find(k => k.hash === hash);
      
      if (keyData) {
        currentUserData = decodeName(keyData.name);
        currentDemoType = keyData.demo || 'default';
        
        // Show disclaimer
        keyPrompt.classList.add('hidden');
        disclaimerPrompt.classList.remove('hidden');
        
        // Set user name in disclaimer
        userFullNameDisplay.textContent = currentUserData.full;
        
        // Start countdown
        startDisclaimerCountdown();
        
        keyError.classList.remove('visible');
      } else {
        showError('Invalid access key');
        labKeyInput.value = '';
      }
    }
    
    function startDisclaimerCountdown() {
      countdownRemaining = 10;
      hasScrolledToBottom = false;
      checkboxChecked = false;
      acceptCheckbox.classList.remove('checked');
      nameConfirmInput.value = '';
      updateAcceptButton();
      
      disclaimerTimer = setInterval(() => {
        countdownRemaining--;
        updateAcceptButton();
        
        if (countdownRemaining <= 0) {
          clearInterval(disclaimerTimer);
        }
      }, 1000);
    }
    
    // Track scrolling to bottom
    disclaimerScroll.addEventListener('scroll', () => {
      const scrollTop = disclaimerScroll.scrollTop;
      const scrollHeight = disclaimerScroll.scrollHeight;
      const clientHeight = disclaimerScroll.clientHeight;
      
      // Check if scrolled to bottom (within 20px)
      if (scrollTop + clientHeight >= scrollHeight - 20) {
        hasScrolledToBottom = true;
        updateAcceptButton();
      }
    });
    
    // Checkbox toggle - can click anytime, but button still requires scroll + countdown
    acceptCheckbox.addEventListener('click', () => {
      checkboxChecked = !checkboxChecked;
      acceptCheckbox.classList.toggle('checked', checkboxChecked);
      updateAcceptButton();
    });
    
    // Name confirmation input
    nameConfirmInput.addEventListener('input', () => {
      updateAcceptButton();
    });
    
    function updateAcceptButton() {
      const nameMatches = nameConfirmInput.value.trim().toLowerCase() === currentUserData?.full.toLowerCase();
      const canAccept = countdownRemaining <= 0 && hasScrolledToBottom && checkboxChecked && nameMatches;
      
      acceptBtn.disabled = !canAccept;
      
      if (countdownRemaining > 0) {
        acceptBtnText.textContent = `Please scroll to read (${countdownRemaining}s)`;
      } else if (!hasScrolledToBottom) {
        acceptBtnText.textContent = 'Please scroll to the bottom';
      } else if (!checkboxChecked) {
        acceptBtnText.textContent = 'Please check the box above';
      } else if (!nameMatches) {
        acceptBtnText.textContent = 'Please type your full name';
      } else {
        acceptBtnText.textContent = 'Accept & Continue';
      }
    }
    
    // Accept button - complete access
    acceptBtn.addEventListener('click', () => {
      if (acceptBtn.disabled) return;
      
      sessionStorage.setItem('lab_session', JSON.stringify({
        timestamp: Date.now(),
        user: currentUserData.full,
        demo: currentDemoType
      }));
      
      labGate.classList.add('hidden');
      setTimeout(() => {
        labContent.classList.add('visible');
        showDemoByType(currentDemoType);
      }, 100);
      
      if (disclaimerTimer) clearInterval(disclaimerTimer);
    });
    
    function showError(msg) {
      keyError.textContent = msg;
      keyError.classList.add('visible');
      setTimeout(() => keyError.classList.remove('visible'), 3000);
    }
    
    labKeySubmit.addEventListener('click', validateKey);
    labKeyInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') validateKey();
    });
    
    // Demo routing based on key type
    function showDemoByType(demoType) {
      // Hide all demo views
      document.querySelectorAll('.demo-view').forEach(el => {
        el.style.display = 'none';
      });
      
      // Show the appropriate demo
      switch(demoType) {
        case 'alignment':
          document.getElementById('demo-alignment').style.display = 'block';
          if (typeof initAlignmentDemo === 'function') {
            initAlignmentDemo();
          }
          break;
        case 'probate':
          document.getElementById('demo-probate').style.display = 'block';
          if (typeof initProbateDemo === 'function') {
            initProbateDemo();
          }
          break;
        default:
          document.getElementById('demo-404').style.display = 'block';
      }
    }
    
    // Logout function (shared)
    function handleLogout() {
      sessionStorage.removeItem('lab_session');
      labContent.classList.remove('visible');
      labGate.classList.remove('hidden');
      
      // Reset to key prompt
      keyPrompt.classList.remove('hidden');
      disclaimerPrompt.classList.add('hidden');
      labKeyInput.value = '';
      
      if (disclaimerTimer) clearInterval(disclaimerTimer);
      currentUserData = null;
    }
    
    // Logout buttons
    labLogout.addEventListener('click', handleLogout);
    const labLogoutCustom = document.getElementById('lab-logout-custom');
    if (labLogoutCustom) {
      labLogoutCustom.addEventListener('click', handleLogout);
    }
    
    // Check session on page load
    checkSession();
    
    // Handle hash-based navigation (e.g., co3.one/#lab)
    function handleHashNavigation() {
      const hash = window.location.hash.slice(1).toLowerCase();
      if (hash && ['about', 'framework', 'contact', 'lab'].includes(hash)) {
        navigateTo(hash);
      }
    }
    
    // Check hash on load and on hash change
    handleHashNavigation();
    window.addEventListener('hashchange', handleHashNavigation);
    
    // Show correct demo view when lab content becomes visible
    const labContentObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.target.classList.contains('visible')) {
          showDemoByType(currentDemoType);
        }
      });
    });
    labContentObserver.observe(labContent, { attributes: true, attributeFilter: ['class'] });
    
    // ============ ALIGNMENT DEMO SIMULATION ============
    let alignmentState = null;
    let alignmentAnimFrame = null;
    let alignmentInitialized = false;

    function initAlignmentDemo() {
      // Cancel any existing animation frame
      if (alignmentAnimFrame !== null) {
        cancelAnimationFrame(alignmentAnimFrame);
        alignmentAnimFrame = null;
      }
      
      alignmentState = {
        x: 0.5, y: 0.5, vx: 0, vy: 0,
        history: [],
        distanceHistory: [],
        epsilon: 0.15, capability: 9, beta: 0.2,
        distance: 0.847, coherence: 0.923, coherenceTrend: 0.003, ttbc: Infinity,
        running: false, step: 0, failed: false
      };
      
      const stateCanvas = document.getElementById('alignment-state-canvas');
      const phaseCanvas = document.getElementById('alignment-phase-canvas');
      const sparkCanvas = document.getElementById('alignment-sparkline-canvas');
      if (!stateCanvas || !phaseCanvas || !sparkCanvas) return;
      
      const stateCtx = stateCanvas.getContext('2d');
      const phaseCtx = phaseCanvas.getContext('2d');
      const sparkCtx = sparkCanvas.getContext('2d');
      
      function resizeCanvases() {
        const dpr = window.devicePixelRatio || 1;
        [stateCanvas, phaseCanvas].forEach(canvas => {
          const rect = canvas.getBoundingClientRect();
          canvas.width = rect.width * dpr;
          canvas.height = rect.height * dpr;
          canvas.getContext('2d').scale(dpr, dpr);
        });
        const sparkRect = sparkCanvas.getBoundingClientRect();
        sparkCanvas.width = sparkRect.width * dpr;
        sparkCanvas.height = sparkRect.height * dpr;
        sparkCtx.scale(dpr, dpr);
      }
      
      function computeBoundaryDistance(x, y) {
        const baseRadius = 0.45;
        const epsilonEffect = alignmentState.epsilon * 0.8;
        const capabilityEffect = Math.log10(Math.pow(10, alignmentState.capability)) / 15 * 0.2;
        const effectiveRadius = Math.max(0.05, baseRadius - epsilonEffect + capabilityEffect * 0.3);
        const distToCenter = Math.sqrt((x - 0.5) ** 2 + (y - 0.5) ** 2);
        return Math.max(0, Math.min(1, (effectiveRadius - distToCenter) / effectiveRadius));
      }
      
      function computeCoherence() {
        const epsilonPenalty = alignmentState.epsilon * 0.5;
        const distanceBonus = alignmentState.distance * 0.3;
        const capabilityPressure = (alignmentState.capability - 6) / 9 * alignmentState.epsilon * 0.3;
        const noise = (Math.random() - 0.5) * 0.02;
        return Math.max(0, Math.min(1, 0.95 - epsilonPenalty + distanceBonus - capabilityPressure + noise));
      }
      
      function computeBoundaryAvoidance() {
        const dx = alignmentState.x - 0.5, dy = alignmentState.y - 0.5;
        const distToCenter = Math.sqrt(dx * dx + dy * dy);
        if (distToCenter < 0.01) return { x: 0, y: 0 };
        const strength = (1 - alignmentState.distance) * 0.5;
        return { x: -dx / distToCenter * strength, y: -dy / distToCenter * strength };
      }
      
      function simulateStep() {
        if (alignmentState.failed) return;
        alignmentState.step++;
        alignmentState.history.push({ x: alignmentState.x, y: alignmentState.y });
        
        const rewardDir = { x: 0.5 + alignmentState.epsilon * 0.4 - alignmentState.x, y: 0.5 + alignmentState.epsilon * 0.3 - alignmentState.y };
        const klDrift = { x: (Math.random() - 0.5) * alignmentState.beta, y: (Math.random() - 0.5) * alignmentState.beta };
        const boundaryForce = computeBoundaryAvoidance();
        const speed = 0.01 * (1 + (alignmentState.capability - 6) / 9 * 0.5);
        const rewardWeight = 0.5 + alignmentState.epsilon * 1.5;
        const boundaryWeight = 1.0 - alignmentState.epsilon * 0.8;
        
        alignmentState.vx = (rewardDir.x * rewardWeight * 0.1 + klDrift.x + boundaryForce.x * boundaryWeight) * speed;
        alignmentState.vy = (rewardDir.y * rewardWeight * 0.1 + klDrift.y + boundaryForce.y * boundaryWeight) * speed;
        alignmentState.x = Math.max(0.05, Math.min(0.95, alignmentState.x + alignmentState.vx));
        alignmentState.y = Math.max(0.05, Math.min(0.95, alignmentState.y + alignmentState.vy));
        
        const prevDistance = alignmentState.distance;
        alignmentState.distance = computeBoundaryDistance(alignmentState.x, alignmentState.y);
        const prevCoherence = alignmentState.coherence;
        alignmentState.coherence = computeCoherence();
        alignmentState.coherenceTrend = alignmentState.coherence - prevCoherence;
        
        const distanceTrend = alignmentState.distance - prevDistance;
        alignmentState.ttbc = distanceTrend < -0.001 ? Math.max(1, Math.floor(alignmentState.distance / Math.abs(distanceTrend))) : Infinity;
        
        alignmentState.distanceHistory.push(alignmentState.distance);
        
        if (alignmentState.distance < 0.02) { alignmentState.failed = true; alignmentState.running = false; }
      }
      
      function simulateFutureStep(x, y, vx, vy) {
        // One step of simulation with current parameters
        const rewardDir = { x: 0.5 + alignmentState.epsilon * 0.4 - x, y: 0.5 + alignmentState.epsilon * 0.3 - y };
        const klDrift = { x: (Math.random() - 0.5) * alignmentState.beta, y: (Math.random() - 0.5) * alignmentState.beta };
        const dx = x - 0.5, dy = y - 0.5;
        const distToCenter = Math.sqrt(dx * dx + dy * dy);
        const dist = computeBoundaryDistance(x, y);
        const strength = (1 - dist) * 0.5;
        const boundaryForce = distToCenter < 0.01 ? { x: 0, y: 0 } : { x: -dx / distToCenter * strength, y: -dy / distToCenter * strength };
        
        const speed = 0.01 * (1 + (alignmentState.capability - 6) / 9 * 0.5);
        const rewardWeight = 0.5 + alignmentState.epsilon * 1.5;
        const boundaryWeight = 1.0 - alignmentState.epsilon * 0.8;
        
        const newVx = (rewardDir.x * rewardWeight * 0.1 + klDrift.x + boundaryForce.x * boundaryWeight) * speed;
        const newVy = (rewardDir.y * rewardWeight * 0.1 + klDrift.y + boundaryForce.y * boundaryWeight) * speed;
        
        return {
          x: Math.max(0.05, Math.min(0.95, x + newVx)),
          y: Math.max(0.05, Math.min(0.95, y + newVy)),
          vx: newVx,
          vy: newVy
        };
      }
      
      function getPredictionCloud(steps, samples) {
        const predictions = [];
        for (let s = 0; s < samples; s++) {
          let x = alignmentState.x, y = alignmentState.y;
          let vx = alignmentState.vx, vy = alignmentState.vy;
          for (let i = 0; i < steps; i++) {
            const next = simulateFutureStep(x, y, vx, vy);
            x = next.x; y = next.y; vx = next.vx; vy = next.vy;
          }
          predictions.push({ x, y });
        }
        return predictions;
      }
      
      function renderStateSpace() {
        const w = stateCanvas.getBoundingClientRect().width, h = stateCanvas.getBoundingClientRect().height;
        stateCtx.fillStyle = '#000'; stateCtx.fillRect(0, 0, w, h);
        stateCtx.strokeStyle = '#1a1a1a'; stateCtx.lineWidth = 1;
        for (let i = 0; i <= 10; i++) { stateCtx.beginPath(); stateCtx.moveTo(i * w / 10, 0); stateCtx.lineTo(i * w / 10, h); stateCtx.stroke(); stateCtx.beginPath(); stateCtx.moveTo(0, i * h / 10); stateCtx.lineTo(w, i * h / 10); stateCtx.stroke(); }
        
        const centerX = w / 2, centerY = h / 2;
        const effectiveRadius = Math.min(w, h) * 0.45 * (1 - alignmentState.epsilon * 0.8);
        const gradient = stateCtx.createRadialGradient(centerX, centerY, 0, centerX, centerY, effectiveRadius);
        gradient.addColorStop(0, 'rgba(59, 255, 111, 0.1)'); gradient.addColorStop(0.7, 'rgba(59, 255, 111, 0.05)'); gradient.addColorStop(1, 'rgba(255, 59, 59, 0.1)');
        stateCtx.fillStyle = gradient; stateCtx.beginPath(); stateCtx.arc(centerX, centerY, effectiveRadius, 0, Math.PI * 2); stateCtx.fill();
        stateCtx.strokeStyle = '#ff3b3b'; stateCtx.lineWidth = 2; stateCtx.setLineDash([5, 5]); stateCtx.beginPath(); stateCtx.arc(centerX, centerY, effectiveRadius, 0, Math.PI * 2); stateCtx.stroke(); stateCtx.setLineDash([]);
        
        if (alignmentState.history.length > 1) { stateCtx.strokeStyle = '#555'; stateCtx.lineWidth = 1; stateCtx.beginPath(); stateCtx.moveTo(alignmentState.history[0].x * w, alignmentState.history[0].y * h); for (let i = 1; i < alignmentState.history.length; i++) stateCtx.lineTo(alignmentState.history[i].x * w, alignmentState.history[i].y * h); stateCtx.stroke(); }
        
        // Prediction cloud - 10 steps ahead, 20 samples
        if (!alignmentState.failed) {
          const cloud = getPredictionCloud(10, 20);
          stateCtx.fillStyle = 'rgba(255, 103, 0, 0.15)';
          cloud.forEach(p => {
            stateCtx.beginPath();
            stateCtx.arc(p.x * w, p.y * h, 4, 0, Math.PI * 2);
            stateCtx.fill();
          });
        }
        
        const px = alignmentState.x * w, py = alignmentState.y * h;
        stateCtx.shadowColor = '#ff6700'; stateCtx.shadowBlur = 15; stateCtx.fillStyle = '#ff6700'; stateCtx.beginPath(); stateCtx.arc(px, py, 6, 0, Math.PI * 2); stateCtx.fill(); stateCtx.shadowBlur = 0;
        stateCtx.fillStyle = '#fff'; stateCtx.beginPath(); stateCtx.arc(px, py, 3, 0, Math.PI * 2); stateCtx.fill();
        stateCtx.fillStyle = '#444'; stateCtx.font = '10px JetBrains Mono, monospace'; stateCtx.fillText('Helpfulness', 10, h - 10);
        
        if (alignmentState.failed) { stateCtx.fillStyle = 'rgba(255, 59, 59, 0.3)'; stateCtx.fillRect(0, 0, w, h); stateCtx.fillStyle = '#ff3b3b'; stateCtx.font = 'bold 24px JetBrains Mono, monospace'; stateCtx.textAlign = 'center'; stateCtx.fillText('BOUNDARY CROSSED', w/2, h/2); stateCtx.font = '12px JetBrains Mono, monospace'; stateCtx.fillText('Alignment Failure', w/2, h/2 + 25); stateCtx.textAlign = 'left'; }
      }
      
      function renderAlignmentPhaseDiagram() {
        const w = phaseCanvas.getBoundingClientRect().width, h = phaseCanvas.getBoundingClientRect().height;
        phaseCtx.fillStyle = '#000'; phaseCtx.fillRect(0, 0, w, h);
        const resolution = 40, cellW = w / resolution, cellH = h / resolution;
        for (let i = 0; i < resolution; i++) { for (let j = 0; j < resolution; j++) { const eps = i / resolution, cap = 6 + (resolution - 1 - j) / resolution * 9, criticalEps = 0.6 - (cap - 6) / 9 * 0.4; let color; if (eps < criticalEps * 0.6) color = `rgba(59, 255, 111, ${0.3 - eps / criticalEps * 0.2})`; else if (eps < criticalEps) { const t = (eps - criticalEps * 0.6) / (criticalEps * 0.4); color = `rgba(255, 170, 0, ${0.2 + t * 0.2})`; } else color = `rgba(255, 59, 59, ${Math.min(0.5, 0.2 + (eps - criticalEps) * 0.5)})`; phaseCtx.fillStyle = color; phaseCtx.fillRect(i * cellW, j * cellH, cellW + 1, cellH + 1); }}
        phaseCtx.strokeStyle = '#222'; phaseCtx.lineWidth = 1; for (let i = 0; i <= 10; i++) { phaseCtx.beginPath(); phaseCtx.moveTo(i * w / 10, 0); phaseCtx.lineTo(i * w / 10, h); phaseCtx.stroke(); phaseCtx.beginPath(); phaseCtx.moveTo(0, i * h / 10); phaseCtx.lineTo(w, i * h / 10); phaseCtx.stroke(); }
        
        // Prediction cloud on phase diagram - shows where predicted positions land in phase space
        if (!alignmentState.failed) {
          const cloud = getPredictionCloud(10, 20);
          phaseCtx.fillStyle = 'rgba(255, 103, 0, 0.2)';
          cloud.forEach(p => {
            // Map state space position to effective epsilon (distance from ideal impacts alignment)
            const distFromCenter = Math.sqrt((p.x - 0.5) ** 2 + (p.y - 0.5) ** 2);
            const effectiveEps = alignmentState.epsilon + distFromCenter * 0.3;
            const px = Math.min(1, effectiveEps) * w;
            const py = h - (alignmentState.capability - 6) / 9 * h;
            phaseCtx.beginPath();
            phaseCtx.arc(px, py, 4, 0, Math.PI * 2);
            phaseCtx.fill();
          });
        }
        
        const px = alignmentState.epsilon * w, py = h - (alignmentState.capability - 6) / 9 * h;
        phaseCtx.strokeStyle = '#fff'; phaseCtx.lineWidth = 1; phaseCtx.setLineDash([3, 3]); phaseCtx.beginPath(); phaseCtx.moveTo(px, 0); phaseCtx.lineTo(px, h); phaseCtx.moveTo(0, py); phaseCtx.lineTo(w, py); phaseCtx.stroke(); phaseCtx.setLineDash([]);
        phaseCtx.shadowColor = '#ff6700'; phaseCtx.shadowBlur = 10; phaseCtx.fillStyle = '#ff6700'; phaseCtx.beginPath(); phaseCtx.arc(px, py, 6, 0, Math.PI * 2); phaseCtx.fill(); phaseCtx.shadowBlur = 0;
        phaseCtx.fillStyle = '#fff'; phaseCtx.beginPath(); phaseCtx.arc(px, py, 3, 0, Math.PI * 2); phaseCtx.fill();
        phaseCtx.fillStyle = '#444'; phaseCtx.font = '10px JetBrains Mono, monospace'; phaseCtx.fillText('ε →', w - 30, h - 10); phaseCtx.fillText('log C ↑', 5, 15);
      }
      
      function renderSparkline() {
        const w = sparkCanvas.getBoundingClientRect().width, h = sparkCanvas.getBoundingClientRect().height;
        sparkCtx.fillStyle = '#000'; sparkCtx.fillRect(0, 0, w, h);
        if (alignmentState.distanceHistory.length < 2) return;
        sparkCtx.strokeStyle = alignmentState.distance < 0.3 ? '#ff3b3b' : alignmentState.distance < 0.5 ? '#ffaa00' : '#ff6700';
        sparkCtx.lineWidth = 1.5; sparkCtx.beginPath();
        const step = w / Math.max(1, alignmentState.distanceHistory.length - 1);
        for (let i = 0; i < alignmentState.distanceHistory.length; i++) { const x = i * step, y = h - alignmentState.distanceHistory[i] * h; if (i === 0) sparkCtx.moveTo(x, y); else sparkCtx.lineTo(x, y); }
        sparkCtx.stroke();
        sparkCtx.fillStyle = 'rgba(255, 59, 59, 0.1)'; sparkCtx.fillRect(0, h * 0.7, w, h * 0.3);
      }
      
      function updateMetrics() {
        const distEl = document.getElementById('alignment-metric-distance'); distEl.textContent = alignmentState.distance.toFixed(3); distEl.className = 'alignment-metric-value ' + (alignmentState.distance < 0.2 ? 'danger' : alignmentState.distance < 0.4 ? 'warning' : 'stable');
        const cohEl = document.getElementById('alignment-metric-coherence'); cohEl.textContent = alignmentState.coherence.toFixed(3); cohEl.className = 'alignment-metric-value ' + (alignmentState.coherence < 0.5 ? 'danger' : alignmentState.coherence < 0.7 ? 'warning' : 'stable');
        const trendEl = document.getElementById('alignment-metric-trend'); trendEl.textContent = (alignmentState.coherenceTrend >= 0 ? '+' : '') + alignmentState.coherenceTrend.toFixed(4); trendEl.className = 'alignment-metric-value ' + (alignmentState.coherenceTrend < -0.01 ? 'danger' : alignmentState.coherenceTrend < 0 ? 'warning' : 'stable');
        const ttbcEl = document.getElementById('alignment-metric-ttbc'); if (alignmentState.ttbc === Infinity) { ttbcEl.textContent = '∞'; ttbcEl.className = 'alignment-metric-value stable'; } else { ttbcEl.textContent = alignmentState.ttbc.toString(); ttbcEl.className = 'alignment-metric-value ' + (alignmentState.ttbc < 50 ? 'danger' : alignmentState.ttbc < 200 ? 'warning' : 'stable'); }
        const statusEl = document.getElementById('alignment-status-value'); if (alignmentState.failed) { statusEl.textContent = 'FAILED'; statusEl.className = 'alignment-status-value critical'; } else if (alignmentState.distance < 0.2 || alignmentState.ttbc < 50) { statusEl.textContent = 'CRITICAL'; statusEl.className = 'alignment-status-value critical'; } else if (alignmentState.distance < 0.4 || alignmentState.ttbc < 200 || alignmentState.coherence < 0.6) { statusEl.textContent = 'WARNING'; statusEl.className = 'alignment-status-value warning'; } else { statusEl.textContent = 'STABLE'; statusEl.className = 'alignment-status-value stable'; }
        document.getElementById('alignment-step-count').textContent = alignmentState.step;
      }
      
      function render() { renderStateSpace(); renderAlignmentPhaseDiagram(); renderSparkline(); updateMetrics(); }
      
      // Helper to pause simulation
      function pauseSimulation() {
        alignmentState.running = false;
        document.getElementById('alignment-btn-run').textContent = '▶ Run';
        document.getElementById('alignment-btn-run').classList.remove('active');
      }
      
      // Only add event listeners once
      if (!alignmentInitialized) {
        document.getElementById('alignment-epsilon-slider').addEventListener('input', (e) => { pauseSimulation(); alignmentState.epsilon = e.target.value / 100; document.getElementById('alignment-epsilon-value').textContent = alignmentState.epsilon.toFixed(2); render(); });
        document.getElementById('alignment-capability-slider').addEventListener('input', (e) => { pauseSimulation(); alignmentState.capability = parseFloat(e.target.value); document.getElementById('alignment-capability-value').innerHTML = `10<sup>${Math.round(alignmentState.capability)}</sup>`; render(); });
        document.getElementById('alignment-beta-slider').addEventListener('input', (e) => { pauseSimulation(); alignmentState.beta = e.target.value / 100; document.getElementById('alignment-beta-value').textContent = alignmentState.beta.toFixed(2); });
        document.getElementById('alignment-btn-run').addEventListener('click', () => { alignmentState.running = !alignmentState.running; document.getElementById('alignment-btn-run').textContent = alignmentState.running ? '‖ Pause' : '▶ Run'; document.getElementById('alignment-btn-run').classList.toggle('active', alignmentState.running); });
        document.getElementById('alignment-btn-step').addEventListener('click', () => { simulateStep(); render(); });
        document.getElementById('alignment-btn-reset').addEventListener('click', () => { alignmentState.x = 0.5; alignmentState.y = 0.5; alignmentState.vx = 0; alignmentState.vy = 0; alignmentState.history = []; alignmentState.distanceHistory = []; alignmentState.distance = computeBoundaryDistance(0.5, 0.5); alignmentState.coherence = 0.95; alignmentState.coherenceTrend = 0; alignmentState.ttbc = Infinity; alignmentState.step = 0; alignmentState.failed = false; alignmentState.running = false; document.getElementById('alignment-btn-run').textContent = '▶ Run'; document.getElementById('alignment-btn-run').classList.remove('active'); render(); });
        document.getElementById('lab-logout-alignment').addEventListener('click', handleLogout);
        window.addEventListener('resize', () => { resizeCanvases(); render(); });
        alignmentInitialized = true;
      }
      
      // Reset UI state
      document.getElementById('alignment-btn-run').textContent = '▶ Run';
      document.getElementById('alignment-btn-run').classList.remove('active');
      document.getElementById('alignment-epsilon-slider').value = 15;
      document.getElementById('alignment-epsilon-value').textContent = '0.15';
      document.getElementById('alignment-capability-slider').value = 9;
      document.getElementById('alignment-capability-value').innerHTML = '10<sup>9</sup>';
      document.getElementById('alignment-beta-slider').value = 20;
      document.getElementById('alignment-beta-value').textContent = '0.20';
      
      let lastTime = 0; const frameInterval = 1000 / 30;
      function gameLoop(timestamp) { if (timestamp - lastTime >= frameInterval) { if (alignmentState && alignmentState.running && !alignmentState.failed) simulateStep(); render(); lastTime = timestamp; } alignmentAnimFrame = requestAnimationFrame(gameLoop); }
      
      resizeCanvases(); alignmentState.distance = computeBoundaryDistance(0.5, 0.5); render(); alignmentAnimFrame = requestAnimationFrame(gameLoop);
    }
    
    // ============ PROBATE DEADLINE TRACKER DEMO ============
    let probateState = null;
    let probateInitialized = false;
    let probateTimelinePoints = [];
    
    function initProbateDemo() {
      // Initialize state
      probateState = {
        dates: { death: null, appointment: null, publication: null, creditorMail: null },
        probateType: 'informal',
        extensions: {},
        deadlineStatus: {},
        calculatedDeadlines: [],
        consequences: []
      };
      
      // Deadline definitions from ARS Title 14
      const DEADLINE_DEFINITIONS = {
        'heir-notice': { name: 'Notice to Heirs/Devisees', days: 30, trigger: 'appointment', statute: '§ 14-3705', extendable: true, description: 'Notice must be given to all heirs and devisees within 30 days of appointment.' },
        'compliance': { name: 'Proof of Compliance', days: 45, trigger: 'appointment', statute: 'Local Rule', extendable: true, description: 'File proof that required notices have been sent.' },
        'inventory': { name: 'Inventory Filing', days: 90, trigger: 'appointment', statute: '§ 14-3706', extendable: true, description: 'PR must prepare inventory of property owned by decedent at death with fair market values.' },
        'publication-due': { name: 'Creditor Notice Publication', days: 0, trigger: 'appointment', statute: '§ 14-3801(A)', extendable: false, description: 'Publication must occur "at the time of appointment" — delay extends creditor exposure.' },
        'rule51': { name: 'Administrative Closure (Rule 51)', days: 730, trigger: 'appointment', statute: 'Rule 51', extendable: true, description: 'Courts may administratively close estates open 2+ years, terminating PR authority.' },
        'creditor-unknown': { name: 'Unknown Creditor Claims Period', days: 122, trigger: 'publication', statute: '§ 14-3801(A)', extendable: false, description: 'Unknown creditors must present claims within 4 months of first publication or be forever barred.' },
        'probate-limit': { name: 'Probate Commencement Limit', days: 730, trigger: 'death', statute: '§ 14-3108', extendable: false, description: 'Informal probate must be filed within 2 years of death.' },
        'earliest-informal': { name: 'Earliest Informal Closing', days: 122, trigger: 'appointment', statute: '§ 14-3933', extendable: false, description: 'Cannot file closing statement until creditor claims period expires.' }
      };
      
      const CONSEQUENCES = {
        'publication-due': { title: 'CRITICAL: Creditor Exposure Extended', text: 'Failing to publish creditor notice extends estate liability from 4 months to 2+ years under §14-3803(A)(1). The 4-month claims period never begins.', statute: 'A.R.S. § 14-3803(A)(1)' },
        'inventory': { title: 'Inventory Deadline Missed', text: 'PR may face removal under §14-3611(B)(6) for "failure to perform any duty pertaining to office." Distribution decisions cannot be informed without inventory.', statute: 'A.R.S. § 14-3611(B)(6)' },
        'heir-notice': { title: 'Heir Notice Deadline Missed', text: 'Failure to notify heirs/devisees constitutes grounds for PR removal. Heirs retain the right to contest the proceeding.', statute: 'A.R.S. § 14-3705' },
        'compliance': { title: 'Proof of Compliance Overdue', text: 'Court may issue orders to show cause. Continued non-compliance can lead to removal proceedings.', statute: 'Local Court Rule' },
        'rule51': { title: 'Administrative Closure Risk', text: 'Court may administratively close the estate, terminating PR authority without discharge from liability.', statute: 'Rule 51' },
        'probate-limit': { title: 'Probate Commencement Barred', text: 'Informal probate can no longer be initiated. Must petition for formal probate with explanation for delay.', statute: 'A.R.S. § 14-3108' }
      };
      
      // Utility functions
      function addDays(date, days) { const r = new Date(date); r.setDate(r.getDate() + days); return r; }
      function daysBetween(d1, d2) { return Math.round((d2 - d1) / (24 * 60 * 60 * 1000)); }
      function formatDate(date) { return date ? date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '—'; }
      function parseInputDate(inputId) { const v = document.getElementById(inputId).value; return v ? new Date(v + 'T00:00:00') : null; }
      
      // Calculate deadlines
      function calculateDeadlines() {
        if (!probateState) return [];
        probateState.dates.death = parseInputDate('probate-date-death');
        probateState.dates.appointment = parseInputDate('probate-date-appointment');
        probateState.dates.publication = parseInputDate('probate-date-publication');
        probateState.dates.creditorMail = parseInputDate('probate-date-creditor-mail');
        const typeEl = document.getElementById('probate-type');
        probateState.probateType = typeEl ? typeEl.value : 'informal';
        
        const today = new Date(); today.setHours(0, 0, 0, 0);
        const deadlines = [];
        
        Object.entries(DEADLINE_DEFINITIONS).forEach(([id, def]) => {
          let triggerDate = null;
          if (def.trigger === 'appointment') triggerDate = probateState.dates.appointment;
          else if (def.trigger === 'publication') triggerDate = probateState.dates.publication;
          else if (def.trigger === 'death') triggerDate = probateState.dates.death;
          if (!triggerDate) return;
          
          const extensionDays = probateState.extensions[id] || 0;
          const deadlineDate = addDays(triggerDate, def.days + extensionDays);
          const daysRemaining = daysBetween(today, deadlineDate);
          
          let status = 'upcoming';
          if (probateState.deadlineStatus[id] === true) status = 'met';
          else if (probateState.deadlineStatus[id] === false) status = 'missed';
          else if (daysRemaining < 0) status = 'past';
          
          deadlines.push({ id, ...def, triggerDate, deadlineDate, daysRemaining, status, extensionDays });
        });
        
        // Known creditor deadline: MAX(publication + 4mo, mailing + 60d)
        if (probateState.dates.publication || probateState.dates.creditorMail) {
          const pubDl = probateState.dates.publication ? addDays(probateState.dates.publication, 122) : null;
          const mailDl = probateState.dates.creditorMail ? addDays(probateState.dates.creditorMail, 60) : null;
          let knownDate = pubDl && mailDl ? (pubDl > mailDl ? pubDl : mailDl) : (pubDl || mailDl);
          if (knownDate) {
            const daysRemaining = daysBetween(today, knownDate);
            let status = 'upcoming';
            if (probateState.deadlineStatus['creditor-known'] === true) status = 'met';
            else if (probateState.deadlineStatus['creditor-known'] === false) status = 'missed';
            else if (daysRemaining < 0) status = 'past';
            deadlines.push({ id: 'creditor-known', name: 'Known Creditor Claims Period', days: null, trigger: 'calculated', statute: '§ 14-3801(B)', extendable: false, description: 'Known creditors have the LATER of 4 months from publication OR 60 days from mailing.', triggerDate: null, deadlineDate: knownDate, daysRemaining, status, extensionDays: 0 });
          }
        }
        
        deadlines.sort((a, b) => a.deadlineDate - b.deadlineDate);
        probateState.calculatedDeadlines = deadlines;
        calculateConsequences();
        return deadlines;
      }
      
      function calculateConsequences() {
        if (!probateState) return;
        const consequences = [];
        const today = new Date();
        
        // Only show publication warning if user hasn't marked it as met
        const pubStatus = probateState.deadlineStatus ? probateState.deadlineStatus['publication-due'] : undefined;
        const pubMarkedMet = pubStatus === true;
        
        if (probateState.dates && probateState.dates.appointment && !probateState.dates.publication && !pubMarkedMet) {
          const daysSince = daysBetween(probateState.dates.appointment, today);
          if (daysSince > 7) {
            consequences.push({ type: 'critical', title: 'CRITICAL: No Publication Recorded', text: 'Creditor notice has not been published. Without publication, the 4-month claims period never begins. Under §14-3803(A)(1), estate exposure extends to 2+ years from date of death.', statute: 'A.R.S. § 14-3803(A)(1)' });
          }
        }
        
        // Add consequences for missed OR past deadlines (not met)
        (probateState.calculatedDeadlines || []).forEach(dl => {
          if ((dl.status === 'missed' || dl.status === 'past') && CONSEQUENCES[dl.id]) {
            consequences.push({ type: dl.id === 'publication-due' ? 'critical' : 'warning', ...CONSEQUENCES[dl.id] });
          }
        });
        probateState.consequences = consequences;
      }
      
      function calculateMetrics() {
        if (!probateState || !probateState.calculatedDeadlines) {
          return { daysToNext: null, coherence: 1, ttbc: null, missedCount: 0, status: 'AWAITING', statusClass: 'stable' };
        }
        const today = new Date();
        const deadlines = probateState.calculatedDeadlines;
        const upcoming = deadlines.filter(d => d.status === 'upcoming' && d.daysRemaining >= 0);
        const nextDl = upcoming[0];
        const daysToNext = nextDl ? nextDl.daysRemaining : null;
        
        // Count 'past' as missed for metrics (past and not marked met = effectively missed)
        const met = deadlines.filter(d => d.status === 'met');
        const missedOrPast = deadlines.filter(d => d.status === 'missed' || d.status === 'past');
        const elapsed = deadlines.filter(d => d.daysRemaining < 0 || d.status === 'met' || d.status === 'missed' || d.status === 'past');
        const coherence = elapsed.length > 0 ? met.length / elapsed.length : 1;
        const missedCount = missedOrPast.length;
        const ttbc = nextDl ? nextDl.daysRemaining : null;
        
        // Status calculation - use consequence count rather than just checking for critical type
        let status = 'ON TRACK', statusClass = 'stable';
        const criticalConsequences = probateState.consequences.filter(c => c.type === 'critical').length;
        
        if (criticalConsequences > 0) { status = 'FAILURE'; statusClass = 'critical'; }
        else if (missedCount >= 3) { status = 'CRITICAL'; statusClass = 'critical'; }
        else if (missedCount >= 2 || (ttbc !== null && ttbc < 7)) { status = 'AT RISK'; statusClass = 'warning'; }
        else if (missedCount >= 1 || (ttbc !== null && ttbc < 30)) { status = 'CAUTION'; statusClass = 'warning'; }
        else if (elapsed.length > 0 && coherence < 1) { status = 'BEHIND'; statusClass = 'warning'; }
        
        return { daysToNext, coherence, ttbc, missedCount, status, statusClass };
      }
      
      // Render timeline
      function renderTimeline() {
        const canvas = document.getElementById('probate-timeline-canvas');
        if (!canvas || !probateState) return;
        const ctx = canvas.getContext('2d');
        const rect = canvas.parentElement.getBoundingClientRect();
        if (rect.width === 0 || rect.height === 0) return; // Canvas not visible
        canvas.width = rect.width * window.devicePixelRatio;
        canvas.height = rect.height * window.devicePixelRatio;
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        const w = rect.width, h = rect.height;
        probateTimelinePoints = [];
        ctx.fillStyle = '#000'; ctx.fillRect(0, 0, w, h);
        
        if (!probateState.calculatedDeadlines || probateState.calculatedDeadlines.length === 0) {
          ctx.fillStyle = '#444'; ctx.font = '12px JetBrains Mono'; ctx.textAlign = 'center';
          ctx.fillText('Enter dates and click Calculate', w / 2, h / 2);
          return;
        }
        
        const deadlines = probateState.calculatedDeadlines;
        const today = new Date();
        const allDates = [today];
        if (probateState.dates.death) allDates.push(probateState.dates.death);
        if (probateState.dates.appointment) allDates.push(probateState.dates.appointment);
        deadlines.forEach(d => allDates.push(d.deadlineDate));
        
        const minDate = new Date(Math.min(...allDates.map(d => d.getTime())));
        const maxDate = new Date(Math.max(...allDates.map(d => d.getTime())));
        minDate.setDate(minDate.getDate() - 30);
        maxDate.setDate(maxDate.getDate() + 60);
        
        const totalDays = daysBetween(minDate, maxDate);
        // Increase margins to accommodate multi-lane points (up to 4 lanes * 25px each)
        const margin = { left: 40, right: 40, top: 120, bottom: 120 };
        const timelineY = h / 2;
        const dayWidth = (w - margin.left - margin.right) / totalDays;
        
        ctx.strokeStyle = '#333'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(margin.left, timelineY); ctx.lineTo(w - margin.right, timelineY); ctx.stroke();
        
        // Month markers
        ctx.fillStyle = '#333'; ctx.font = '9px JetBrains Mono'; ctx.textAlign = 'center';
        let markerDate = new Date(minDate); markerDate.setDate(1); markerDate.setMonth(markerDate.getMonth() + 1);
        while (markerDate < maxDate) {
          const x = margin.left + daysBetween(minDate, markerDate) * dayWidth;
          if (x > margin.left && x < w - margin.right) {
            ctx.beginPath(); ctx.moveTo(x, timelineY - 5); ctx.lineTo(x, timelineY + 5); ctx.stroke();
            ctx.fillText(markerDate.toLocaleDateString('en-US', { month: 'short' }), x, timelineY + 20);
          }
          markerDate.setMonth(markerDate.getMonth() + 1);
        }
        
        // Trigger markers
        [{ date: probateState.dates.death, label: 'Death' }, { date: probateState.dates.appointment, label: 'PR Appointed' }, { date: probateState.dates.publication, label: 'First Publication' }].forEach(t => {
          if (!t.date) return;
          const x = margin.left + daysBetween(minDate, t.date) * dayWidth;
          ctx.fillStyle = '#555'; ctx.fillRect(x - 5, timelineY - 5, 10, 10);
          ctx.strokeStyle = '#888'; ctx.lineWidth = 1; ctx.strokeRect(x - 5, timelineY - 5, 10, 10);
          probateTimelinePoints.push({ x, y: timelineY, radius: 8, data: { name: t.label, date: t.date, type: 'trigger', description: 'Trigger event: ' + t.label } });
        });
        
        // Today marker with pulsing ring
        const todayX = margin.left + daysBetween(minDate, today) * dayWidth;
        const grad = ctx.createRadialGradient(todayX, timelineY, 0, todayX, timelineY, 30);
        grad.addColorStop(0, 'rgba(255, 103, 0, 0.4)'); grad.addColorStop(1, 'rgba(255, 103, 0, 0)');
        ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(todayX, timelineY, 30, 0, Math.PI * 2); ctx.fill();
        ctx.strokeStyle = 'rgba(255, 103, 0, 0.5)'; ctx.lineWidth = 1; ctx.setLineDash([4, 4]);
        ctx.beginPath(); ctx.moveTo(todayX, margin.top); ctx.lineTo(todayX, h - margin.bottom); ctx.stroke(); ctx.setLineDash([]);
        // Outer ring to indicate tappable
        ctx.strokeStyle = 'rgba(255, 103, 0, 0.6)'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.arc(todayX, timelineY, 14, 0, Math.PI * 2); ctx.stroke();
        ctx.fillStyle = '#ff6700'; ctx.beginPath(); ctx.arc(todayX, timelineY, 8, 0, Math.PI * 2); ctx.fill();
        ctx.font = '10px JetBrains Mono'; ctx.fillText('TODAY', todayX, timelineY + 45);
        ctx.font = '8px JetBrains Mono'; ctx.fillStyle = 'rgba(255,103,0,0.7)'; ctx.fillText('tap for plan', todayX, timelineY + 57);
        probateTimelinePoints.push({ x: todayX, y: timelineY, radius: 20, data: { name: 'Today', date: today, type: 'today', description: 'Tap for action plan' } });
        
        // Deadline points - with collision detection and multi-lane staggering
        const MIN_X_SPACING = 15; // Minimum pixels between points before staggering kicks in
        const LANE_HEIGHT = 22;   // Vertical distance between lanes (reduced for more compact fit)
        
        // Calculate available lanes based on canvas height
        const availableHeight = (h / 2) - margin.top - 20; // Space above/below timeline
        const maxLanes = Math.min(4, Math.floor(availableHeight / LANE_HEIGHT));
        
        // First pass: calculate X positions and detect clusters
        const pointsWithX = deadlines.map((dl, idx) => ({
          dl,
          x: margin.left + daysBetween(minDate, dl.deadlineDate) * dayWidth,
          originalIdx: idx
        })).sort((a, b) => a.x - b.x);
        
        // Assign lanes based on X proximity - always start from lane 1, never 0
        const assignedLanes = [];
        pointsWithX.forEach((p, i) => {
          // Find which lanes are occupied by nearby points
          const occupiedLanes = new Set();
          for (let j = 0; j < i; j++) {
            if (Math.abs(pointsWithX[j].x - p.x) < MIN_X_SPACING) {
              occupiedLanes.add(assignedLanes[j]);
            }
          }
          // Find first available lane (alternating above/below, never 0)
          let lane = 1; // Default to first lane above
          const laneOrder = [];
          for (let l = 1; l <= maxLanes; l++) {
            laneOrder.push(l, -l); // Alternate: 1, -1, 2, -2, etc.
          }
          for (const l of laneOrder) {
            if (!occupiedLanes.has(l)) {
              lane = l;
              break;
            }
          }
          assignedLanes.push(lane);
        });
        
        // Second pass: render with assigned lanes
        pointsWithX.forEach((p, i) => {
          const dl = p.dl;
          const x = p.x;
          const lane = assignedLanes[i];
          const isSoon = dl.daysRemaining >= 0 && dl.daysRemaining < 14;
          
          let color, outerColor;
          if (dl.status === 'met') { color = '#3bff6f'; outerColor = 'rgba(59, 255, 111, 0.3)'; }
          else if (dl.status === 'missed') { color = '#ff3b3b'; outerColor = 'rgba(255, 59, 59, 0.3)'; }
          else if (isSoon || dl.daysRemaining < 0) { color = dl.daysRemaining < 0 ? '#ff3b3b' : '#ffaa00'; outerColor = dl.daysRemaining < 0 ? 'rgba(255, 59, 59, 0.2)' : 'rgba(255, 170, 0, 0.3)'; }
          else { color = '#ffaa00'; outerColor = 'rgba(255, 170, 0, 0.2)'; }
          
          const pointY = timelineY + (lane * LANE_HEIGHT);
          
          // Draw connector line to timeline
          ctx.strokeStyle = outerColor; ctx.lineWidth = 1;
          ctx.beginPath(); ctx.moveTo(x, pointY); ctx.lineTo(x, timelineY); ctx.stroke();
          
          // Draw glow for urgent items
          if (isSoon || dl.status === 'missed') {
            ctx.fillStyle = outerColor;
            ctx.beginPath(); ctx.arc(x, pointY, 12, 0, Math.PI * 2); ctx.fill();
          }
          
          // Draw point
          ctx.fillStyle = color; ctx.beginPath(); ctx.arc(x, pointY, 6, 0, Math.PI * 2); ctx.fill();
          ctx.strokeStyle = color; ctx.lineWidth = 2; ctx.beginPath(); ctx.arc(x, pointY, 6, 0, Math.PI * 2); ctx.stroke();
          
          // Add short label for compressed timelines - but only if not overlapping
          if (dayWidth < 0.5 && dayWidth > 0.01) {
            // Check if this label would overlap with previous labels
            const labelX = x + 10;
            const labelY = pointY + 3;
            let canShowLabel = true;
            
            // Skip label if another point is too close (within 12px vertically at similar X)
            for (let j = 0; j < i; j++) {
              const otherLane = assignedLanes[j];
              const otherY = timelineY + (otherLane * LANE_HEIGHT);
              const otherX = pointsWithX[j].x;
              if (Math.abs(otherX - x) < 5 && Math.abs(otherY - pointY) < 20) {
                canShowLabel = false;
                break;
              }
            }
            
            if (canShowLabel) {
              const SHORT_LABELS = {
                'heir-notice': 'Heir 30d',
                'compliance': 'Comply 45d',
                'inventory': 'Inv 90d',
                'publication-due': 'Publish',
                'rule51': 'Rule 51',
                'creditor-unknown': 'Cred 4mo',
                'creditor-known': 'Known Cred',
                'probate-limit': '2yr Limit',
                'earliest-informal': 'Early Close'
              };
              ctx.font = '7px JetBrains Mono'; ctx.fillStyle = color; ctx.textAlign = 'left';
              const shortLabel = SHORT_LABELS[dl.id] || dl.name.split(' ').slice(0, 2).join(' ').substring(0, 10);
              ctx.fillText(shortLabel, labelX, labelY);
            }
          }
          
          probateTimelinePoints.push({ x, y: pointY, radius: 18, data: { name: dl.name, date: dl.deadlineDate, daysRemaining: dl.daysRemaining, status: dl.status, statute: dl.statute, description: dl.description, extendable: dl.extendable, type: 'deadline' } });
        });
      }
      
      // Render phase diagram
      function renderPhaseDiagram() {
        const canvas = document.getElementById('probate-phase-canvas');
        if (!canvas || !probateState) return;
        const ctx = canvas.getContext('2d');
        const rect = canvas.parentElement.getBoundingClientRect();
        if (rect.width === 0 || rect.height === 0) return;
        canvas.width = rect.width * window.devicePixelRatio;
        canvas.height = rect.height * window.devicePixelRatio;
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        const w = rect.width, h = rect.height;
        ctx.fillStyle = '#000'; ctx.fillRect(0, 0, w, h);
        
        const margin = { left: 50, right: 30, top: 30, bottom: 50 };
        const plotW = w - margin.left - margin.right;
        const plotH = h - margin.top - margin.bottom;
        
        // Color zones
        [{ x: 0, y: 0, w: 0.5, h: 0.5, color: 'rgba(59, 255, 111, 0.15)' }, { x: 0, y: 0.5, w: 0.5, h: 0.5, color: 'rgba(255, 170, 0, 0.1)' }, { x: 0.5, y: 0, w: 0.25, h: 0.5, color: 'rgba(255, 170, 0, 0.15)' }, { x: 0.5, y: 0.5, w: 0.25, h: 0.5, color: 'rgba(255, 103, 0, 0.15)' }, { x: 0.75, y: 0, w: 0.25, h: 0.5, color: 'rgba(255, 103, 0, 0.15)' }, { x: 0.75, y: 0.5, w: 0.25, h: 0.5, color: 'rgba(255, 59, 59, 0.2)' }].forEach(z => {
          ctx.fillStyle = z.color;
          ctx.fillRect(margin.left + z.x * plotW, margin.top + z.y * plotH, z.w * plotW, z.h * plotH);
        });
        
        // Grid
        ctx.strokeStyle = '#222'; ctx.lineWidth = 1;
        for (let i = 0; i <= 4; i++) {
          const x = margin.left + (i / 4) * plotW;
          ctx.beginPath(); ctx.moveTo(x, margin.top); ctx.lineTo(x, h - margin.bottom); ctx.stroke();
          const y = margin.top + (i / 4) * plotH;
          ctx.beginPath(); ctx.moveTo(margin.left, y); ctx.lineTo(w - margin.right, y); ctx.stroke();
        }
        
        // Labels
        ctx.fillStyle = '#666'; ctx.font = '9px JetBrains Mono'; ctx.textAlign = 'center';
        ['0', '1', '2', '3+'].forEach((l, i) => ctx.fillText(l, margin.left + (i / 4) * plotW + (plotW / 8), h - margin.bottom + 20));
        ctx.fillText('Deadlines Missed →', margin.left + plotW / 2, h - 10);
        ctx.textAlign = 'right';
        ['0', '6mo', '12mo', '18mo', '24mo'].forEach((l, i) => ctx.fillText(l, margin.left - 8, margin.top + (i / 4) * plotH + 4));
        ctx.save(); ctx.translate(12, margin.top + plotH / 2); ctx.rotate(-Math.PI / 2); ctx.textAlign = 'center'; ctx.fillText('Time from Appointment ↑', 0, 0); ctx.restore();
        
        if (!probateState.dates || !probateState.dates.appointment) {
          ctx.fillStyle = '#444'; ctx.font = '11px JetBrains Mono'; ctx.textAlign = 'center';
          ctx.fillText('Enter PR appointment date', w / 2, h / 2);
          return;
        }
        
        const today = new Date();
        const daysSince = daysBetween(probateState.dates.appointment, today);
        const monthsSince = daysSince / 30;
        const missedCount = (probateState.calculatedDeadlines || []).filter(d => d.status === 'missed' || d.status === 'past').length;
        const px = margin.left + Math.min(missedCount / 3, 1) * plotW;
        const py = margin.top + Math.min(monthsSince / 24, 1) * plotH;
        
        const posGrad = ctx.createRadialGradient(px, py, 0, px, py, 25);
        posGrad.addColorStop(0, 'rgba(255, 103, 0, 0.4)'); posGrad.addColorStop(1, 'rgba(255, 103, 0, 0)');
        ctx.fillStyle = posGrad; ctx.beginPath(); ctx.arc(px, py, 25, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = '#ff6700'; ctx.beginPath(); ctx.arc(px, py, 6, 0, Math.PI * 2); ctx.fill();
        ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.beginPath(); ctx.arc(px, py, 6, 0, Math.PI * 2); ctx.stroke();
        ctx.fillStyle = '#ff6700'; ctx.font = '10px JetBrains Mono'; ctx.textAlign = 'left'; ctx.fillText('Current', px + 12, py + 4);
      }
      
      // Render deadline toggles
      function renderDeadlineToggles() {
        const container = document.getElementById('probate-toggles');
        if (!container) return;
        container.innerHTML = '';
        if (!probateState || !probateState.calculatedDeadlines || probateState.calculatedDeadlines.length === 0) {
          container.innerHTML = '<div class="probate-no-deadlines">Enter dates above and tap Calculate</div>';
          return;
        }
        probateState.calculatedDeadlines.forEach(dl => {
          const chip = document.createElement('div');
          chip.className = 'probate-chip';
          chip.dataset.deadline = dl.id;
          
          const isExplicitlyMet = probateState.deadlineStatus[dl.id] === true;
          const isExplicitlyMissed = probateState.deadlineStatus[dl.id] === false;
          const isSoon = dl.daysRemaining >= 0 && dl.daysRemaining < 14;
          const isPast = dl.daysRemaining < 0;
          
          if (isExplicitlyMet) chip.classList.add('met');
          else if (isExplicitlyMissed) chip.classList.add('missed');
          else if (isPast) chip.classList.add('past');
          else if (isSoon) chip.classList.add('upcoming');
          
          // Short name for chip display
          const shortNames = {
            'heir-notice': 'Heir Notice',
            'compliance': 'Compliance',
            'inventory': 'Inventory',
            'publication-due': 'Publication',
            'rule51': 'Rule 51',
            'creditor-unknown': 'Creditors',
            'creditor-known': 'Known Cred',
            'probate-limit': '2yr Limit',
            'earliest-informal': 'Earliest Close'
          };
          const shortName = shortNames[dl.id] || dl.name.split(' ')[0];
          
          let daysText = '';
          if (dl.daysRemaining > 0) daysText = dl.daysRemaining + 'd';
          else if (dl.daysRemaining === 0) daysText = 'TODAY';
          else daysText = Math.abs(dl.daysRemaining) + 'd ago';
          
          chip.innerHTML = '<div class="probate-chip-dot"></div><span class="probate-chip-name">' + shortName + '</span><span class="probate-chip-days">' + daysText + '</span>';
          
          // Toggle on click/tap
          chip.addEventListener('click', () => {
            const current = probateState.deadlineStatus[dl.id];
            if (current === true) {
              probateState.deadlineStatus[dl.id] = false; // met -> missed
            } else if (current === false) {
              delete probateState.deadlineStatus[dl.id]; // missed -> auto
            } else {
              probateState.deadlineStatus[dl.id] = true; // auto -> met
            }
            updateAllProbate();
          });
          
          container.appendChild(chip);
        });
      }
      
      function renderConsequences() {
        const container = document.getElementById('probate-consequences');
        if (!container) return;
        if (!probateState || !probateState.consequences || probateState.consequences.length === 0) {
          container.innerHTML = '<div class="probate-no-consequences">✓ No violations</div>';
          return;
        }
        container.innerHTML = probateState.consequences.map(c => '<div class="probate-consequence-card' + (c.type === 'critical' ? '' : ' warning') + '"><div class="probate-consequence-card-title">' + c.title + '</div><div class="probate-consequence-card-text">' + c.text + '</div></div>').join('');
      }
      
      function renderMetrics() {
        const m = calculateMetrics();
        const distEl = document.getElementById('probate-metric-distance');
        const cohEl = document.getElementById('probate-metric-coherence');
        const ttbcEl = document.getElementById('probate-metric-ttbc');
        const missedEl = document.getElementById('probate-metric-missed');
        const statusEl = document.getElementById('probate-status-value');
        if (!distEl || !cohEl || !ttbcEl || !missedEl || !statusEl) return;
        
        if (m.daysToNext !== null) { distEl.textContent = m.daysToNext + ' days'; distEl.className = 'probate-metric-value ' + (m.daysToNext < 7 ? 'danger' : m.daysToNext < 30 ? 'warning' : 'stable'); }
        else { distEl.textContent = '—'; distEl.className = 'probate-metric-value'; }
        cohEl.textContent = (m.coherence * 100).toFixed(0) + '%';
        cohEl.className = 'probate-metric-value ' + (m.coherence < 0.5 ? 'danger' : m.coherence < 0.8 ? 'warning' : 'stable');
        if (m.ttbc !== null && m.ttbc >= 0) { ttbcEl.textContent = m.ttbc + ' days'; ttbcEl.className = 'probate-metric-value ' + (m.ttbc < 7 ? 'danger' : m.ttbc < 30 ? 'warning' : 'stable'); }
        else if (m.missedCount > 0) { ttbcEl.textContent = 'CROSSED'; ttbcEl.className = 'probate-metric-value danger'; }
        else { ttbcEl.textContent = '∞'; ttbcEl.className = 'probate-metric-value stable'; }
        missedEl.textContent = m.missedCount;
        missedEl.className = 'probate-metric-value ' + (m.missedCount >= 3 ? 'danger' : m.missedCount >= 1 ? 'warning' : 'stable');
        statusEl.textContent = m.status;
        statusEl.className = 'probate-status-value ' + m.statusClass;
      }
      
      function updateAllProbate() {
        if (!probateState) return;
        calculateDeadlines();
        renderTimeline();
        renderPhaseDiagram();
        renderDeadlineToggles();
        renderConsequences();
        renderMetrics();
      }
      
      // Setup hover for timeline
      // Generate action plan based on current case state
      function generateActionPlan() {
        if (!probateState || !probateState.calculatedDeadlines) return [{ priority: 5, action: 'Enter case dates', detail: 'Add dates above and click Calculate to see action plan.' }];
        const deadlines = probateState.calculatedDeadlines;
        const today = new Date();
        const actions = [];
        
        // Check for no publication - CRITICAL (but respect toggle if marked as met)
        const pubMarkedMet = probateState.deadlineStatus['publication-due'] === true;
        if (probateState.dates.appointment && !probateState.dates.publication && !pubMarkedMet) {
          const daysSince = daysBetween(probateState.dates.appointment, today);
          if (daysSince > 0) {
            actions.push({ priority: 1, action: 'PUBLISH CREDITOR NOTICE IMMEDIATELY', detail: 'Each day without publication extends creditor exposure. File with newspaper today.' });
          }
        }
        
        // Find missed/past deadlines that are extendable (but not marked as met)
        const missedExtendable = deadlines.filter(d => (d.status === 'missed' || d.status === 'past') && d.extendable);
        missedExtendable.forEach(d => {
          actions.push({ priority: 2, action: 'File motion to extend ' + d.name, detail: 'Deadline passed ' + Math.abs(d.daysRemaining) + ' days ago. Show excusable neglect under Rule 6(b).' });
        });
        
        // Find missed/past deadlines that are NOT extendable
        const missedFixed = deadlines.filter(d => (d.status === 'missed' || d.status === 'past') && !d.extendable);
        missedFixed.forEach(d => {
          if (d.id === 'creditor-unknown' || d.id === 'creditor-known') {
            actions.push({ priority: 2, action: 'Creditor period for ' + d.name + ' has closed', detail: 'Claims are now barred. Proceed toward closing.' });
          } else {
            actions.push({ priority: 3, action: 'Address missed ' + d.name, detail: 'Non-extendable deadline. Document circumstances for court if challenged.' });
          }
        });
        
        // Find upcoming deadlines within 30 days
        const upcoming = deadlines.filter(d => d.status === 'upcoming' && d.daysRemaining >= 0 && d.daysRemaining <= 30);
        upcoming.sort((a, b) => a.daysRemaining - b.daysRemaining);
        upcoming.forEach(d => {
          actions.push({ priority: 4, action: d.name + ' due in ' + d.daysRemaining + ' days', detail: 'Deadline: ' + formatDate(d.deadlineDate) + '. ' + (d.extendable ? 'Can request extension if needed.' : 'Not extendable.') });
        });
        
        // Check Rule 51 proximity
        const rule51 = deadlines.find(d => d.id === 'rule51');
        if (rule51 && rule51.status !== 'met' && rule51.daysRemaining < 180 && rule51.daysRemaining > 0) {
          actions.push({ priority: 3, action: 'Rule 51 closure in ' + rule51.daysRemaining + ' days', detail: 'Prepare closing statement or file motion showing active administration.' });
        }
        
        // If everything is on track
        if (actions.length === 0) {
          const nextDeadline = deadlines.find(d => d.status === 'upcoming' && d.daysRemaining > 0);
          if (nextDeadline) {
            actions.push({ priority: 5, action: 'Case on track', detail: 'Next deadline: ' + nextDeadline.name + ' in ' + nextDeadline.daysRemaining + ' days.' });
          } else {
            actions.push({ priority: 5, action: 'Review case for closing', detail: 'All deadlines appear addressed. Verify creditor period has expired before filing closing statement.' });
          }
        }
        
        // Sort by priority and return top 4
        actions.sort((a, b) => a.priority - b.priority);
        return actions.slice(0, 4);
      }
      
      function setupProbateTimelineHover() {
        const wrap = document.getElementById('probate-timeline-wrap');
        const canvas = document.getElementById('probate-timeline-canvas');
        const tooltip = document.getElementById('probate-tooltip');
        
        if (!wrap || !canvas || !tooltip) { console.error('Probate timeline elements not found'); return; }
        
        let activeTooltip = false;
        
        function showTooltipForPoint(px, py, point) {
          const d = point.data;
          
          // Special handling for TODAY - show action plan
          if (d.type === 'today') {
            const actions = generateActionPlan();
            tooltip.querySelector('.probate-tooltip-title').textContent = '📋 ACTION PLAN';
            tooltip.querySelector('.probate-tooltip-date').textContent = 'As of ' + formatDate(d.date);
            tooltip.querySelector('.probate-tooltip-days').style.display = 'none';
            tooltip.querySelector('.probate-tooltip-statute').style.display = 'none';
            
            let planHtml = actions.map((a, i) => 
              '<div style="margin-bottom:8px;' + (i === 0 ? 'color:#ff6700;font-weight:500;' : '') + '">' +
              '<div style="font-size:10px;">' + (i + 1) + '. ' + a.action + '</div>' +
              '<div style="font-size:9px;color:#888;margin-top:2px;">' + a.detail + '</div></div>'
            ).join('');
            tooltip.querySelector('.probate-tooltip-desc').innerHTML = planHtml;
            tooltip.querySelector('.probate-tooltip-status').style.display = 'none';
          } else {
            // Normal deadline/trigger tooltip
            tooltip.querySelector('.probate-tooltip-title').textContent = d.name;
            tooltip.querySelector('.probate-tooltip-date').textContent = formatDate(d.date);
            const daysEl = tooltip.querySelector('.probate-tooltip-days');
            if (d.type === 'deadline' && d.daysRemaining !== undefined) {
              if (d.daysRemaining > 0) { daysEl.textContent = d.daysRemaining + ' days remaining'; daysEl.className = 'probate-tooltip-days future'; }
              else if (d.daysRemaining === 0) { daysEl.textContent = 'Due TODAY'; daysEl.className = 'probate-tooltip-days soon'; }
              else { daysEl.textContent = Math.abs(d.daysRemaining) + ' days ago'; daysEl.className = 'probate-tooltip-days past'; }
              daysEl.style.display = 'block';
            } else { daysEl.style.display = 'none'; }
            const statEl = tooltip.querySelector('.probate-tooltip-statute');
            if (d.statute) { statEl.textContent = d.statute + (d.extendable ? ' · Extendable' : ' · Not Extendable'); statEl.style.display = 'block'; }
            else { statEl.style.display = 'none'; }
            tooltip.querySelector('.probate-tooltip-desc').textContent = d.description || '';
            const statusEl = tooltip.querySelector('.probate-tooltip-status');
            if (d.type === 'deadline' && d.status) { statusEl.textContent = d.status.toUpperCase(); statusEl.className = 'probate-tooltip-status ' + d.status; statusEl.style.display = 'inline-block'; }
            else { statusEl.style.display = 'none'; }
          }
          
          // Position tooltip
          const wrapRect = wrap.getBoundingClientRect();
          let tx = point.x + 15, ty = point.y - 10;
          if (tx + 280 > wrapRect.width) tx = Math.max(10, point.x - 290);
          if (ty + 200 > wrapRect.height) ty = Math.max(10, wrapRect.height - 210);
          if (ty < 10) ty = 10;
          if (tx < 10) tx = 10;
          tooltip.style.left = tx + 'px'; 
          tooltip.style.top = ty + 'px';
          tooltip.classList.add('visible');
          activeTooltip = true;
        }
        
        function hideTooltip() {
          tooltip.classList.remove('visible');
          activeTooltip = false;
        }
        
        // Find ALL points near a location (for cycling through overlaps)
        function findAllPointsAt(x, y) {
          const matches = [];
          for (const p of probateTimelinePoints) {
            if (Math.sqrt(Math.pow(x - p.x, 2) + Math.pow(y - p.y, 2)) <= p.radius + 8) {
              matches.push(p);
            }
          }
          return matches;
        }
        
        function findPointAt(x, y) {
          const matches = findAllPointsAt(x, y);
          return matches.length > 0 ? matches[0] : null;
        }
        
        // Track cycling through overlapping points
        let lastTapLocation = { x: 0, y: 0 };
        let lastTapTime = 0;
        let cycleIndex = 0;
        let currentPointsAtLocation = [];
        
        function handlePointInteraction(x, y, isClick) {
          const now = Date.now();
          const isSameLocation = Math.abs(x - lastTapLocation.x) < 25 && Math.abs(y - lastTapLocation.y) < 25;
          const isQuickTap = now - lastTapTime < 800;
          
          const pointsHere = findAllPointsAt(x, y);
          
          if (pointsHere.length === 0) {
            hideTooltip();
            cycleIndex = 0;
            currentPointsAtLocation = [];
            return;
          }
          
          // If same location tapped quickly, cycle to next point
          if (isSameLocation && isQuickTap && pointsHere.length > 1) {
            cycleIndex = (cycleIndex + 1) % pointsHere.length;
          } else {
            // New location or first tap - reset cycle
            cycleIndex = 0;
            currentPointsAtLocation = pointsHere;
          }
          
          lastTapLocation = { x, y };
          lastTapTime = now;
          
          const point = pointsHere[cycleIndex];
          showTooltipForPoint(x, y, point);
          
          // Show cycle indicator if multiple points overlap
          if (pointsHere.length > 1) {
            const cycleIndicator = document.createElement('div');
            cycleIndicator.style.cssText = 'font-size:8px;color:#666;margin-top:8px;text-align:center;border-top:1px solid #333;padding-top:6px;';
            cycleIndicator.textContent = '◀ ' + (cycleIndex + 1) + ' of ' + pointsHere.length + ' points · tap again to cycle ▶';
            
            // Remove old indicator if exists
            const oldIndicator = tooltip.querySelector('.cycle-indicator');
            if (oldIndicator) oldIndicator.remove();
            cycleIndicator.className = 'cycle-indicator';
            tooltip.appendChild(cycleIndicator);
          } else {
            const oldIndicator = tooltip.querySelector('.cycle-indicator');
            if (oldIndicator) oldIndicator.remove();
          }
        }
        
        // Mouse events (desktop)
        canvas.addEventListener('mousemove', (e) => {
          const rect = canvas.getBoundingClientRect();
          const mx = e.clientX - rect.left, my = e.clientY - rect.top;
          const point = findPointAt(mx, my);
          if (point) {
            showTooltipForPoint(mx, my, point);
            canvas.style.cursor = 'pointer';
          } else {
            hideTooltip();
            canvas.style.cursor = 'default';
          }
        });
        canvas.addEventListener('mouseleave', hideTooltip);
        
        // Touch events (mobile)
        canvas.addEventListener('touchstart', (e) => {
          e.preventDefault();
          const rect = canvas.getBoundingClientRect();
          const touch = e.touches[0];
          const tx = touch.clientX - rect.left, ty = touch.clientY - rect.top;
          handlePointInteraction(tx, ty, false);
        }, { passive: false });
        
        // Tap elsewhere to dismiss
        document.addEventListener('touchstart', (e) => {
          if (activeTooltip && !tooltip.contains(e.target) && e.target !== canvas) {
            hideTooltip();
          }
        });
        
        // Click to cycle through points on desktop
        canvas.addEventListener('click', (e) => {
          const rect = canvas.getBoundingClientRect();
          const mx = e.clientX - rect.left, my = e.clientY - rect.top;
          handlePointInteraction(mx, my, true);
        });
      }
      
      // Event listeners (only add once)
      if (!probateInitialized) {
        document.getElementById('probate-btn-calculate').addEventListener('click', updateAllProbate);
        document.getElementById('probate-btn-reset').addEventListener('click', () => {
          probateState = { dates: { death: null, appointment: null, publication: null, creditorMail: null }, probateType: 'informal', extensions: {}, deadlineStatus: {}, calculatedDeadlines: [], consequences: [] };
          ['probate-date-death', 'probate-date-appointment', 'probate-date-publication', 'probate-date-creditor-mail'].forEach(id => document.getElementById(id).value = '');
          document.getElementById('probate-type').value = 'informal';
          document.getElementById('probate-extension-deadline').value = '';
          document.getElementById('probate-extension-days').value = '';
          document.getElementById('probate-extension-list').innerHTML = '';
          updateAllProbate();
          document.getElementById('probate-status-value').textContent = 'AWAITING INPUT';
          document.getElementById('probate-status-value').className = 'probate-status-value stable';
        });
        document.getElementById('probate-btn-extension').addEventListener('click', () => {
          const dlId = document.getElementById('probate-extension-deadline').value;
          const days = parseInt(document.getElementById('probate-extension-days').value);
          if (!dlId || !days || days < 1) { alert('Please select a deadline and enter valid extension days.'); return; }
          probateState.extensions[dlId] = (probateState.extensions[dlId] || 0) + days;
          const dlName = DEADLINE_DEFINITIONS[dlId]?.name || dlId;
          document.getElementById('probate-extension-list').innerHTML += '<span style="margin-left: 12px; color: #3bff6f;">+' + days + 'd to ' + dlName + '</span>';
          document.getElementById('probate-extension-deadline').value = '';
          document.getElementById('probate-extension-days').value = '';
          if (probateState.calculatedDeadlines.length > 0) updateAllProbate();
        });
        ['probate-date-death', 'probate-date-appointment', 'probate-date-publication', 'probate-date-creditor-mail', 'probate-type'].forEach(id => {
          document.getElementById(id).addEventListener('change', () => { if (probateState.calculatedDeadlines.length > 0) updateAllProbate(); });
        });
        document.getElementById('lab-logout-probate').addEventListener('click', handleLogout);
        window.addEventListener('resize', () => { if (probateState.calculatedDeadlines.length > 0) { renderTimeline(); renderPhaseDiagram(); } });
        setupProbateTimelineHover();
        probateInitialized = true;
      }
      
      // Initial render
      renderTimeline();
      renderPhaseDiagram();
      renderDeadlineToggles();
    }
    
    // ============ DVD BOUNCING LOGO ============
    (function() {
      const container = document.getElementById('dvd-container');
      const logo = document.getElementById('dvd-logo');
      const noiseCanvas = document.getElementById('noise-canvas');
      
      if (!container || !logo || !noiseCanvas) return;
      
      const ctx = noiseCanvas.getContext('2d');
      
      // DVD colors that cycle on bounce
      const dvdColors = [
        '#ff6700', // orange
        '#ff3366', // pink
        '#33ff99', // green
        '#3399ff', // blue
        '#ff33ff', // magenta
        '#ffff33', // yellow
        '#33ffff', // cyan
      ];
      let colorIndex = 0;
      
      // Position and velocity
      let x = Math.random() * 200 + 50;
      let y = Math.random() * 200 + 50;
      let vx = (Math.random() > 0.5 ? 1 : -1) * (1.5 + Math.random());
      let vy = (Math.random() > 0.5 ? 1 : -1) * (1.5 + Math.random());
      
      // Set initial color
      logo.style.color = dvdColors[colorIndex];
      
      // Resize noise canvas
      function resizeNoise() {
        noiseCanvas.width = window.innerWidth / 4;
        noiseCanvas.height = window.innerHeight / 4;
      }
      resizeNoise();
      window.addEventListener('resize', resizeNoise);
      
      // Draw white noise
      function drawNoise() {
        const imageData = ctx.createImageData(noiseCanvas.width, noiseCanvas.height);
        const data = imageData.data;
        
        for (let i = 0; i < data.length; i += 4) {
          const val = Math.random() * 255;
          data[i] = val;     // R
          data[i + 1] = val; // G
          data[i + 2] = val; // B
          data[i + 3] = 255; // A
        }
        
        ctx.putImageData(imageData, 0, 0);
      }
      
      // Animate
      function animate() {
        // Update position
        x += vx;
        y += vy;
        
        // Get bounds
        const logoRect = logo.getBoundingClientRect();
        const containerRect = container.getBoundingClientRect();
        
        const logoWidth = logoRect.width;
        const logoHeight = logoRect.height;
        const maxX = containerRect.width - logoWidth;
        const maxY = containerRect.height - logoHeight;
        
        // Bounce off walls and change color
        let bounced = false;
        
        if (x <= 0) {
          x = 0;
          vx = Math.abs(vx);
          bounced = true;
        } else if (x >= maxX) {
          x = maxX;
          vx = -Math.abs(vx);
          bounced = true;
        }
        
        if (y <= 0) {
          y = 0;
          vy = Math.abs(vy);
          bounced = true;
        } else if (y >= maxY) {
          y = maxY;
          vy = -Math.abs(vy);
          bounced = true;
        }
        
        if (bounced) {
          colorIndex = (colorIndex + 1) % dvdColors.length;
          logo.style.color = dvdColors[colorIndex];
        }
        
        // Apply position
        logo.style.left = x + 'px';
        logo.style.top = y + 'px';
        
        // Update noise every few frames
        if (Math.random() < 0.3) {
          drawNoise();
        }
        
        requestAnimationFrame(animate);
      }
      
      // Start animation when lab content becomes visible
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.target.classList.contains('visible')) {
            animate();
            observer.disconnect();
          }
        });
      });
      
      const labContent = document.getElementById('lab-content');
      if (labContent) {
        if (labContent.classList.contains('visible')) {
          animate();
        } else {
          observer.observe(labContent, { attributes: true, attributeFilter: ['class'] });
        }
      }
    })();
    
    // ============ INTERACTIVE FORMULA EXPLORER ============
    (function() {
      const formulaVars = document.querySelectorAll('.formula-var');
      const panel = document.getElementById('formula-panel');
      const panelContent = document.getElementById('panel-content');
      const panelNav = document.getElementById('panel-nav');
      
      if (!panel || !panelContent) return;
      
      let currentVar = null;
      let currentDomain = 'physics';
      
      const domains = ['physics', 'medicine', 'math', 'computing', 'biology'];
      
      const varData = {
        F: {
          symbol: '𝔽',
          name: 'Feasible Set',
          physics: {
            icon: 'Φ',
            interpretation: 'States not violating conservation laws, causality, or quantum unitarity. The set of all physically realizable configurations.',
            question: 'Why does superposition collapse to ONE outcome from the full feasible set?'
          },
          medicine: {
            icon: 'Ψ',
            interpretation: 'Physiologically viable configurations. All metabolic, hormonal, and cellular states compatible with life.',
            question: 'Why does this patient respond to treatment while a genetically similar patient does not?'
          },
          math: {
            icon: '∑',
            interpretation: 'Non-contradictory propositions under chosen axioms. The space of statements that can be consistently maintained.',
            question: 'What determines which axiom systems are "natural" vs arbitrary?'
          },
          computing: {
            icon: 'λ',
            interpretation: 'Halting programs, decidable problems, reachable states. Configurations that terminate without resource exhaustion.',
            question: 'Why do some NP problems admit efficient heuristics while others remain intractable?'
          },
          biology: {
            icon: '∞',
            interpretation: 'Viable phenotypes given genome and environment. Organisms that can survive, reproduce, and maintain homeostasis.',
            question: 'How does one cell become a coherent organism with 37 trillion coordinated cells?'
          }
        },
        dF: {
          symbol: '∂𝔽',
          name: 'Failure Boundary',
          physics: {
            icon: 'Φ',
            interpretation: 'Event horizons, phase transitions, the speed of light, decoherence thresholds. Where physical laws force discontinuity.',
            question: 'What happens to information when it crosses the event horizon boundary?'
          },
          medicine: {
            icon: 'Ψ',
            interpretation: 'LD50, organ failure thresholds, therapeutic windows, point of no return for cellular damage.',
            question: 'Why do genetically similar patients cross failure boundaries at different times?'
          },
          math: {
            icon: '∑',
            interpretation: 'Contradiction, incompleteness limits, Gödel boundaries. Where proof systems necessarily break down.',
            question: 'What is the topology of unprovability within consistent systems?'
          },
          computing: {
            icon: 'λ',
            interpretation: 'Halting boundary, stack overflow, resource exhaustion, timeout limits, deadlock conditions.',
            question: 'Can we predict when a system approaches boundary without crossing it?'
          },
          biology: {
            icon: '∞',
            interpretation: 'Extinction threshold, carrying capacity limits, lethal mutation load, minimum viable population.',
            question: 'Why do some species persist at the edge of viability while others collapse suddenly?'
          }
        },
        margin: {
          symbol: 'd(y, ∂𝔽)',
          name: 'Margin to Failure',
          physics: {
            icon: 'Φ',
            interpretation: 'Stability of orbit, distance from criticality, how far a quantum state is from decoherence.',
            question: 'Does the universe optimize for maximum margin, or minimum necessary margin?'
          },
          medicine: {
            icon: 'Ψ',
            interpretation: 'Physiological reserve, stress tolerance. How much perturbation can the system absorb before failure.',
            question: 'Can we measure "health" as aggregate margin across all physiological boundaries?'
          },
          math: {
            icon: '∑',
            interpretation: 'How "far" a proof is from relying on contested axioms or undecidable propositions.',
            question: 'Do more robust theorems (higher margin) tend to have more applications?'
          },
          computing: {
            icon: 'λ',
            interpretation: 'Memory headroom, queue depth before timeout, CPU cycles remaining, error budget.',
            question: 'What is the optimal margin allocation across competing system resources?'
          },
          biology: {
            icon: '∞',
            interpretation: 'Population buffer, genetic diversity, metabolic reserve, immune system capacity.',
            question: 'How do organisms trade off margin in one domain for capability in another?'
          }
        },
        C: {
          symbol: 'C_Δ',
          name: 'Coherence',
          physics: {
            icon: 'Φ',
            interpretation: 'Entanglement preservation, unitarity, phase coherence. Whether quantum correlations remain intact.',
            question: 'Why does coherence appear to decrease universally (thermodynamic arrow)?'
          },
          medicine: {
            icon: 'Ψ',
            interpretation: 'Homeostasis, integrated organ function, circadian alignment. How well subsystems coordinate.',
            question: 'What is the minimal coherence threshold for consciousness?'
          },
          math: {
            icon: '∑',
            interpretation: 'Consistency across proof branches, how well different parts of a theory integrate.',
            question: 'Why do "beautiful" proofs tend to reveal deeper coherence?'
          },
          computing: {
            icon: 'λ',
            interpretation: 'State consistency, ACID properties, cache coherence, distributed consensus.',
            question: 'What is the fundamental cost of maintaining coherence at scale?'
          },
          biology: {
            icon: '∞',
            interpretation: 'Developmental coordination, immune self/non-self discrimination, neural synchronization.',
            question: 'How does a developing embryo maintain coherence through massive state changes?'
          }
        },
        Cdot: {
          symbol: 'Ċ_Δ',
          name: 'Coherence Trend',
          physics: {
            icon: 'Φ',
            interpretation: 'Rate of decoherence, entropy production rate. Is coherence increasing or decreasing?',
            question: 'Can coherence trend ever reverse spontaneously in closed systems?'
          },
          medicine: {
            icon: 'Ψ',
            interpretation: 'Trajectory of health—improving, stable, or declining. The derivative of wellbeing.',
            question: 'Is aging fundamentally a negative coherence trend problem?'
          },
          math: {
            icon: '∑',
            interpretation: 'Whether a proof is converging or diverging, becoming more or less unified.',
            question: 'Can we detect when a proof strategy is trending toward contradiction?'
          },
          computing: {
            icon: 'λ',
            interpretation: 'Technical debt accumulation rate, system stability trend, drift toward failure.',
            question: 'Why do systems that "work fine" suddenly cascade into failure?'
          },
          biology: {
            icon: '∞',
            interpretation: 'Evolutionary trajectory, population fitness trend, ecosystem stability direction.',
            question: 'What determines whether an ecosystem trends toward stability or collapse?'
          }
        },
        Pi: {
          symbol: 'Π',
          name: 'Projection Map',
          physics: {
            icon: 'Φ',
            interpretation: 'Measurement apparatus, reference frame, coarse-graining that produces classical observables from quantum states.',
            question: 'Is measurement a projection, or does it create new ontology?'
          },
          medicine: {
            icon: 'Ψ',
            interpretation: 'Diagnostic tests, symptom reports, biomarker panels. How internal states become observable data.',
            question: 'How much information is lost in clinical projection from full physiological state?'
          },
          math: {
            icon: '∑',
            interpretation: 'Formal system, axiom choice, representation. How abstract structures become computable proofs.',
            question: 'Do different projections of the same mathematical object reveal different truths?'
          },
          computing: {
            icon: 'λ',
            interpretation: 'API, logging, monitoring, UI. What the user/operator actually sees of system state.',
            question: 'What determines which projections are useful vs misleading?'
          },
          biology: {
            icon: '∞',
            interpretation: 'Phenotype expression, ecological niche perception, behavioral output from neural state.',
            question: 'How does consciousness arise as a projection of neural dynamics?'
          }
        },
        fail: {
          symbol: '⚠️',
          name: 'Failure Modes',
          physics: {
            icon: 'Φ',
            early: 'Quantum systems near decoherence threshold — locally valid superpositions that environmental coupling will collapse.',
            hindsight: 'Phase transitions: water at 99°C looks like water at 50°C, then suddenly it\'s steam. The argmin flipped.',
            insight: 'Criticality was encoded in the constraint geometry all along — the "surprise" was observational.'
          },
          medicine: {
            icon: 'Ψ',
            early: 'Patient with stable vitals but shrinking physiological reserve — labs look fine, but margin to ∂𝔽 is dangerously thin.',
            hindsight: 'Sudden cardiac events, sepsis cascades, stroke. "They seemed fine yesterday" — coherence trend was negative.',
            insight: 'The body was optimizing locally while drifting globally toward boundary.'
          },
          math: {
            icon: '∑',
            early: 'Proofs relying on axioms near known independence results — locally valid but structurally fragile.',
            hindsight: 'Russell\'s paradox, Gödel\'s incompleteness. The system "worked" until it suddenly didn\'t.',
            insight: 'Contradiction was always in the feasible set\'s topology — discovery just revealed the boundary.'
          },
          computing: {
            icon: 'λ',
            early: 'System at 85% memory with growing allocation rate — currently functional but TTBC is short.',
            hindsight: 'Cascading failures, thundering herds, OOM kills. "It was fine in staging" — load revealed the boundary.',
            insight: 'The failure was deterministic given the trajectory; only the timing felt sudden.'
          },
          biology: {
            icon: '∞',
            early: 'Population with low genetic diversity — currently viable but one disease away from collapse.',
            hindsight: 'Mass extinctions, ecosystem collapses. Stable for millennia, then gone in decades.',
            insight: 'Resilience isn\'t binary — it\'s margin. Low margin systems look fine until they\'re not.'
          }
        }
      };
      
      function renderPanel(varKey, domain) {
        const data = varData[varKey];
        if (!data) return;
        
        const domainData = data[domain];
        if (!domainData) return;
        
        const varClass = 'var-' + (varKey === 'margin' ? 'margin' : varKey === 'dF' ? 'dF' : varKey === 'fail' ? 'fail' : varKey === 'Cdot' ? 'C' : varKey);
        
        let contentHTML;
        
        if (varKey === 'fail') {
          // Special layout for failure modes
          contentHTML = `
            <div class="panel-domain active" data-domain="${domain}">
              <div class="panel-domain-header">
                <span class="panel-domain-icon">${domainData.icon}</span>
                <span class="panel-domain-title">${domain.charAt(0).toUpperCase() + domain.slice(1)}</span>
              </div>
              <div class="panel-var-name var-fail">${data.symbol} — ${data.name}</div>
              <div class="panel-failure-item">
                <div class="panel-failure-label">Early Failure</div>
                <div class="panel-failure-text">${domainData.early}</div>
              </div>
              <div class="panel-failure-item">
                <div class="panel-failure-label">Hindsight Suddenness</div>
                <div class="panel-failure-text">${domainData.hindsight}</div>
              </div>
              <div class="panel-question">
                <div class="panel-question-label">The Insight</div>
                <div class="panel-question-text">${domainData.insight}</div>
              </div>
            </div>
          `;
        } else {
          contentHTML = `
            <div class="panel-domain active" data-domain="${domain}">
              <div class="panel-domain-header">
                <span class="panel-domain-icon">${domainData.icon}</span>
                <span class="panel-domain-title">${domain.charAt(0).toUpperCase() + domain.slice(1)}</span>
              </div>
              <div class="panel-var-name ${varClass}">${data.symbol} — ${data.name}</div>
              <div class="panel-interpretation">${domainData.interpretation}</div>
              <div class="panel-question">
                <div class="panel-question-label">Open Question</div>
                <div class="panel-question-text">${domainData.question}</div>
              </div>
            </div>
          `;
        }
        
        panelContent.innerHTML = contentHTML;
        
        // Update nav
        panelNav.querySelectorAll('.panel-nav-item').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.domain === domain);
        });
      }
      
      // Variable click handlers
      formulaVars.forEach(v => {
        v.addEventListener('click', () => {
          const varKey = v.dataset.var;
          
          // Toggle panel
          if (currentVar === varKey && panel.classList.contains('open')) {
            panel.classList.remove('open');
            v.classList.remove('active');
            currentVar = null;
            return;
          }
          
          // Update active states
          formulaVars.forEach(fv => fv.classList.remove('active'));
          v.classList.add('active');
          
          currentVar = varKey;
          currentDomain = 'physics';
          
          renderPanel(varKey, currentDomain);
          panel.classList.add('open');
        });
      });
      
      // Nav click handlers
      panelNav.querySelectorAll('.panel-nav-item').forEach(btn => {
        btn.addEventListener('click', () => {
          currentDomain = btn.dataset.domain;
          renderPanel(currentVar, currentDomain);
        });
      });
      
      // Click outside to close
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.formula-explorer') && panel.classList.contains('open')) {
          panel.classList.remove('open');
          formulaVars.forEach(v => v.classList.remove('active'));
          currentVar = null;
        }
      });
    })();
    
    // ============ COLLAPSIBLE TECHNICAL DETAILS ============
    (function() {
      const toggle = document.getElementById('tech-details-toggle');
      const content = document.getElementById('tech-details-content');
      
      if (!toggle || !content) return;
      
      toggle.addEventListener('click', () => {
        toggle.classList.toggle('open');
        content.classList.toggle('open');
      });
    })();
    
  </script>
</body>
</html>
